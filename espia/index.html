<!DOCTYPE html>
<html>
    <!--
        Arrow
        HTML-JS Runtime
        Mor. H. Golkar
    -->
    <head>
        <title>Espia</title>
        <meta charset="utf-8">
        <meta name="color-scheme" content="dark light">
        <meta name="keywords" content="Arrow,adventure,Espia">
        <meta name="description" content="Espia: An adventure made with Arrow">
        <!-- @inline -->
        <script>
/*project.js*/

// Arrow HTML-JS Runtime: Project (JSON) data

const PROJECT = {
	"title": "Espia",
	"entry": 1,
	"meta": {

	},
	"resources": {
		"scenes": {
			"0": {
				"name": "scene_0",
				"entry": 1,
				"map": {
					"1": {
						"offset": [
							130,
							-70
						],
						"io": [
							[
								1,
								0,
								2,
								0
							]
						]
					},
					"2": {
						"offset": [
							240,
							-80
						],
						"io": [
							[
								2,
								0,
								6,
								0
							]
						]
					},
					"6": {
						"offset": [
							420,
							-60
						],
						"io": [
							[
								6,
								0,
								124,
								0
							]
						]
					},
					"7": {
						"offset": [
							870,
							-40
						],
						"io": [
							[
								7,
								0,
								42,
								0
							]
						]
					},
					"8": {
						"offset": [
							1220,
							-320
						],
						"io": [
							[
								8,
								0,
								63,
								0
							]
						]
					},
					"20": {
						"offset": [
							2770,
							-220
						]
					},
					"27": {
						"offset": [
							2260,
							-460
						],
						"io": [
							[
								27,
								0,
								40,
								0
							]
						]
					},
					"28": {
						"offset": [
							2170,
							-350
						],
						"io": [
							[
								28,
								0,
								40,
								0
							]
						]
					},
					"29": {
						"offset": [
							2210,
							-100
						],
						"io": [
							[
								29,
								0,
								40,
								0
							]
						]
					},
					"30": {
						"offset": [
							2190,
							-220
						],
						"io": [
							[
								30,
								0,
								40,
								0
							]
						]
					},
					"31": {
						"offset": [
							2230,
							60
						],
						"io": [
							[
								31,
								0,
								40,
								0
							]
						]
					},
					"40": {
						"offset": [
							2540,
							-210
						],
						"io": [
							[
								40,
								0,
								20,
								0
							]
						]
					},
					"42": {
						"offset": [
							1010,
							-80
						],
						"io": [
							[
								42,
								1,
								74,
								0
							],
							[
								42,
								0,
								8,
								0
							]
						]
					},
					"55": {
						"offset": [
							1930,
							-470
						],
						"io": [
							[
								55,
								0,
								27,
								0
							]
						]
					},
					"56": {
						"offset": [
							1940,
							-350
						],
						"io": [
							[
								56,
								0,
								28,
								0
							]
						]
					},
					"60": {
						"offset": [
							1720,
							-490
						],
						"io": [
							[
								60,
								0,
								55,
								0
							]
						]
					},
					"62": {
						"offset": [
							1590,
							-370
						],
						"io": [
							[
								62,
								0,
								56,
								0
							]
						]
					},
					"63": {
						"offset": [
							1390,
							-320
						],
						"io": [
							[
								63,
								0,
								60,
								0
							],
							[
								63,
								1,
								62,
								0
							],
							[
								63,
								2,
								64,
								0
							],
							[
								63,
								3,
								66,
								0
							],
							[
								63,
								4,
								68,
								0
							]
						]
					},
					"64": {
						"offset": [
							1630,
							-240
						],
						"io": [
							[
								64,
								0,
								65,
								0
							]
						]
					},
					"65": {
						"offset": [
							1910,
							-220
						],
						"io": [
							[
								65,
								0,
								30,
								0
							]
						]
					},
					"66": {
						"offset": [
							1650,
							-110
						],
						"io": [
							[
								66,
								0,
								67,
								0
							]
						]
					},
					"67": {
						"offset": [
							1930,
							-100
						],
						"io": [
							[
								67,
								0,
								29,
								0
							]
						]
					},
					"68": {
						"offset": [
							1660,
							20
						],
						"io": [
							[
								68,
								0,
								69,
								0
							]
						]
					},
					"69": {
						"offset": [
							1930,
							60
						],
						"io": [
							[
								69,
								0,
								31,
								0
							]
						]
					},
					"74": {
						"offset": [
							1210,
							220
						],
						"io": [
							[
								74,
								0,
								77,
								0
							]
						]
					},
					"75": {
						"offset": [
							220,
							160
						],
						"io": [
							[
								75,
								0,
								145,
								0
							]
						]
					},
					"77": {
						"offset": [
							1340,
							200
						],
						"io": [
							[
								77,
								0,
								79,
								0
							]
						]
					},
					"79": {
						"offset": [
							1490,
							200
						],
						"io": [
							[
								79,
								0,
								135,
								0
							]
						]
					},
					"83": {
						"offset": [
							1940,
							190
						],
						"io": [
							[
								83,
								1,
								95,
								0
							],
							[
								83,
								0,
								136,
								0
							]
						]
					},
					"88": {
						"offset": [
							2420,
							150
						],
						"io": [
							[
								88,
								0,
								91,
								0
							]
						]
					},
					"89": {
						"offset": [
							2740,
							100
						],
						"io": [
							[
								89,
								1,
								97,
								0
							]
						]
					},
					"90": {
						"offset": [
							2740,
							240
						],
						"io": [
							[
								90,
								1,
								99,
								0
							]
						]
					},
					"91": {
						"offset": [
							2610,
							180
						],
						"io": [
							[
								91,
								0,
								89,
								0
							],
							[
								91,
								1,
								90,
								0
							]
						]
					},
					"93": {
						"offset": [
							3080,
							120
						],
						"io": [
							[
								93,
								0,
								98,
								0
							]
						]
					},
					"95": {
						"offset": [
							2220,
							310
						],
						"io": [
							[
								95,
								0,
								88,
								0
							]
						]
					},
					"96": {
						"offset": [
							3370,
							120
						],
						"io": [
							[
								96,
								0,
								101,
								0
							]
						]
					},
					"97": {
						"offset": [
							2920,
							110
						],
						"io": [
							[
								97,
								0,
								93,
								0
							]
						]
					},
					"98": {
						"offset": [
							3200,
							110
						],
						"io": [
							[
								98,
								0,
								96,
								0
							]
						]
					},
					"99": {
						"offset": [
							3900,
							180
						],
						"io": [
							[
								99,
								0,
								104,
								0
							]
						]
					},
					"101": {
						"offset": [
							3500,
							110
						],
						"io": [
							[
								101,
								0,
								102,
								0
							]
						]
					},
					"102": {
						"offset": [
							3680,
							120
						],
						"io": [
							[
								102,
								0,
								99,
								0
							]
						]
					},
					"104": {
						"offset": [
							4100,
							130
						],
						"io": [
							[
								104,
								0,
								105,
								0
							],
							[
								104,
								1,
								106,
								0
							],
							[
								104,
								2,
								107,
								0
							]
						]
					},
					"105": {
						"offset": [
							4530,
							70
						],
						"io": [
							[
								105,
								0,
								108,
								0
							]
						]
					},
					"106": {
						"offset": [
							4530,
							150
						],
						"io": [
							[
								106,
								0,
								108,
								0
							]
						]
					},
					"107": {
						"offset": [
							4530,
							230
						],
						"io": [
							[
								107,
								0,
								108,
								0
							]
						]
					},
					"108": {
						"offset": [
							4830,
							160
						],
						"io": [
							[
								108,
								0,
								113,
								0
							]
						]
					},
					"109": {
						"offset": [
							5140,
							160
						],
						"io": [
							[
								109,
								0,
								115,
								0
							]
						]
					},
					"111": {
						"offset": [
							5480,
							140
						],
						"io": [
							[
								111,
								0,
								117,
								0
							]
						]
					},
					"113": {
						"offset": [
							4970,
							150
						],
						"io": [
							[
								113,
								0,
								109,
								0
							]
						]
					},
					"114": {
						"offset": [
							6110,
							160
						],
						"io": [
							[
								114,
								0,
								155,
								0
							]
						]
					},
					"115": {
						"offset": [
							5290,
							150
						],
						"io": [
							[
								115,
								0,
								111,
								0
							]
						]
					},
					"117": {
						"offset": [
							5640,
							150
						],
						"io": [
							[
								117,
								0,
								119,
								0
							]
						]
					},
					"119": {
						"offset": [
							5810,
							140
						],
						"io": [
							[
								119,
								0,
								138,
								0
							]
						]
					},
					"122": {
						"offset": [
							220,
							280
						],
						"io": [
							[
								122,
								0,
								147,
								0
							]
						]
					},
					"124": {
						"offset": [
							610,
							-40
						],
						"io": [
							[
								124,
								0,
								125,
								0
							]
						]
					},
					"125": {
						"offset": [
							730,
							-40
						],
						"io": [
							[
								125,
								0,
								7,
								0
							]
						]
					},
					"128": {
						"offset": [
							760,
							280
						]
					},
					"129": {
						"offset": [
							600,
							150
						],
						"io": [
							[
								129,
								0,
								140,
								0
							]
						]
					},
					"131": {
						"offset": [
							760,
							400
						]
					},
					"134": {
						"offset": [
							590,
							280
						],
						"io": [
							[
								134,
								0,
								128,
								0
							]
						]
					},
					"135": {
						"offset": [
							1650,
							180
						],
						"io": [
							[
								135,
								0,
								83,
								0
							]
						]
					},
					"136": {
						"offset": [
							2220,
							180
						]
					},
					"137": {
						"offset": [
							230,
							580
						],
						"io": [
							[
								137,
								0,
								165,
								0
							]
						]
					},
					"138": {
						"offset": [
							5960,
							150
						],
						"io": [
							[
								138,
								0,
								114,
								0
							]
						]
					},
					"139": {
						"offset": [
							590,
							390
						],
						"io": [
							[
								139,
								0,
								131,
								0
							]
						]
					},
					"140": {
						"offset": [
							740,
							150
						]
					},
					"143": {
						"offset": [
							690,
							590
						]
					},
					"145": {
						"offset": [
							430,
							160
						],
						"io": [
							[
								145,
								0,
								129,
								0
							]
						]
					},
					"147": {
						"offset": [
							410,
							290
						],
						"io": [
							[
								147,
								0,
								134,
								0
							],
							[
								147,
								1,
								139,
								0
							]
						]
					},
					"149": {
						"offset": [
							350,
							1680
						],
						"io": [
							[
								149,
								0,
								150,
								0
							]
						]
					},
					"150": {
						"offset": [
							570,
							1690
						],
						"io": [
							[
								150,
								0,
								173,
								0
							]
						]
					},
					"151": {
						"offset": [
							-60,
							1640
						],
						"io": [
							[
								151,
								0,
								149,
								0
							],
							[
								151,
								1,
								154,
								0
							]
						]
					},
					"154": {
						"offset": [
							170,
							1740
						],
						"io": [
							[
								154,
								0,
								149,
								0
							]
						]
					},
					"155": {
						"offset": [
							6260,
							150
						],
						"io": [
							[
								155,
								1,
								156,
								0
							],
							[
								155,
								0,
								157,
								0
							]
						]
					},
					"156": {
						"offset": [
							6500,
							170
						]
					},
					"157": {
						"offset": [
							6500,
							50
						]
					},
					"160": {
						"offset": [
							750,
							710
						]
					},
					"164": {
						"offset": [
							690,
							690
						]
					},
					"165": {
						"offset": [
							420,
							580
						],
						"io": [
							[
								165,
								0,
								143,
								0
							],
							[
								165,
								1,
								164,
								0
							],
							[
								165,
								2,
								170,
								0
							]
						]
					},
					"166": {
						"offset": [
							860,
							790
						]
					},
					"168": {
						"offset": [
							280,
							870
						]
					},
					"170": {
						"offset": [
							690,
							800
						],
						"io": [
							[
								170,
								0,
								166,
								0
							]
						]
					},
					"171": {
						"offset": [
							380,
							870
						]
					},
					"172": {
						"offset": [
							-40,
							3390
						],
						"io": [
							[
								172,
								0,
								187,
								0
							]
						]
					},
					"173": {
						"offset": [
							730,
							1690
						],
						"io": [
							[
								173,
								0,
								175,
								0
							]
						]
					},
					"175": {
						"offset": [
							910,
							1670
						]
					},
					"177": {
						"offset": [
							-90,
							1980
						],
						"io": [
							[
								177,
								0,
								180,
								0
							]
						]
					},
					"178": {
						"offset": [
							-250,
							1980
						],
						"io": [
							[
								178,
								0,
								177,
								0
							]
						]
					},
					"180": {
						"offset": [
							150,
							1990
						],
						"io": [
							[
								180,
								0,
								195,
								0
							]
						]
					},
					"182": {
						"offset": [
							-210,
							5490
						],
						"io": [
							[
								182,
								0,
								204,
								0
							]
						]
					},
					"183": {
						"offset": [
							-370,
							5480
						],
						"io": [
							[
								183,
								0,
								182,
								0
							]
						]
					},
					"186": {
						"offset": [
							300,
							3380
						]
					},
					"187": {
						"offset": [
							130,
							3400
						],
						"io": [
							[
								187,
								0,
								186,
								0
							],
							[
								187,
								1,
								189,
								0
							]
						]
					},
					"188": {
						"offset": [
							-40,
							3110
						],
						"io": [
							[
								188,
								0,
								193,
								0
							]
						]
					},
					"189": {
						"offset": [
							300,
							3490
						],
						"io": [
							[
								189,
								0,
								190,
								0
							]
						]
					},
					"190": {
						"offset": [
							470,
							3470
						]
					},
					"193": {
						"offset": [
							150,
							3100
						],
						"io": [
							[
								193,
								0,
								194,
								0
							],
							[
								193,
								2,
								341,
								0
							],
							[
								193,
								1,
								340,
								0
							]
						]
					},
					"194": {
						"offset": [
							400,
							3060
						]
					},
					"195": {
						"offset": [
							280,
							1990
						],
						"io": [
							[
								195,
								0,
								198,
								0
							]
						]
					},
					"196": {
						"offset": [
							600,
							1990
						],
						"io": [
							[
								196,
								0,
								210,
								0
							]
						]
					},
					"198": {
						"offset": [
							430,
							1960
						],
						"io": [
							[
								198,
								0,
								196,
								0
							]
						]
					},
					"199": {
						"offset": [
							1030,
							1960
						]
					},
					"201": {
						"offset": [
							-10,
							2220
						],
						"io": [
							[
								201,
								0,
								235,
								0
							]
						]
					},
					"202": {
						"offset": [
							880,
							1970
						],
						"io": [
							[
								202,
								0,
								199,
								0
							]
						]
					},
					"204": {
						"offset": [
							-40,
							5500
						],
						"io": [
							[
								204,
								1,
								211,
								0
							],
							[
								204,
								2,
								215,
								0
							],
							[
								204,
								0,
								228,
								0
							]
						]
					},
					"205": {
						"offset": [
							240,
							6600
						],
						"io": [
							[
								205,
								0,
								427,
								0
							]
						]
					},
					"206": {
						"offset": [
							70,
							6610
						],
						"io": [
							[
								206,
								0,
								205,
								0
							]
						]
					},
					"209": {
						"offset": [
							670,
							5560
						],
						"io": [
							[
								209,
								0,
								212,
								0
							]
						]
					},
					"210": {
						"offset": [
							730,
							1980
						],
						"io": [
							[
								210,
								0,
								202,
								0
							]
						]
					},
					"211": {
						"offset": [
							480,
							5540
						],
						"io": [
							[
								211,
								0,
								209,
								0
							]
						]
					},
					"212": {
						"offset": [
							800,
							5520
						],
						"io": [
							[
								212,
								0,
								222,
								0
							],
							[
								212,
								1,
								231,
								0
							]
						]
					},
					"214": {
						"offset": [
							800,
							5670
						],
						"io": [
							[
								214,
								0,
								218,
								0
							]
						]
					},
					"215": {
						"offset": [
							480,
							5670
						],
						"io": [
							[
								215,
								0,
								216,
								0
							]
						]
					},
					"216": {
						"offset": [
							650,
							5670
						],
						"io": [
							[
								216,
								0,
								214,
								0
							]
						]
					},
					"218": {
						"offset": [
							930,
							5660
						],
						"io": [
							[
								218,
								1,
								220,
								0
							],
							[
								218,
								0,
								228,
								0
							]
						]
					},
					"220": {
						"offset": [
							1420,
							5740
						]
					},
					"221": {
						"offset": [
							1640,
							5380
						],
						"io": [
							[
								221,
								0,
								226,
								0
							]
						]
					},
					"222": {
						"offset": [
							1140,
							5400
						],
						"io": [
							[
								222,
								0,
								223,
								0
							]
						]
					},
					"223": {
						"offset": [
							1320,
							5400
						],
						"io": [
							[
								223,
								0,
								225,
								0
							]
						]
					},
					"225": {
						"offset": [
							1470,
							5370
						],
						"io": [
							[
								225,
								0,
								221,
								0
							]
						]
					},
					"226": {
						"offset": [
							1810,
							5460
						],
						"io": [
							[
								226,
								1,
								227,
								0
							],
							[
								226,
								0,
								228,
								0
							]
						]
					},
					"227": {
						"offset": [
							2200,
							5440
						]
					},
					"228": {
						"offset": [
							1620,
							5580
						]
					},
					"230": {
						"offset": [
							1320,
							5540
						],
						"io": [
							[
								230,
								0,
								226,
								0
							]
						]
					},
					"231": {
						"offset": [
							1140,
							5530
						],
						"io": [
							[
								231,
								0,
								230,
								0
							]
						]
					},
					"235": {
						"offset": [
							290,
							2210
						],
						"io": [
							[
								235,
								1,
								237,
								0
							],
							[
								235,
								0,
								242,
								0
							],
							[
								235,
								2,
								239,
								0
							]
						]
					},
					"236": {
						"offset": [
							730,
							2140
						],
						"io": [
							[
								236,
								0,
								243,
								0
							]
						]
					},
					"237": {
						"offset": [
							580,
							2220
						]
					},
					"238": {
						"offset": [
							-50,
							2820
						],
						"io": [
							[
								238,
								0,
								245,
								0
							]
						]
					},
					"239": {
						"offset": [
							580,
							2340
						]
					},
					"242": {
						"offset": [
							570,
							2130
						],
						"io": [
							[
								242,
								0,
								236,
								0
							]
						]
					},
					"243": {
						"offset": [
							860,
							2120
						]
					},
					"244": {
						"offset": [
							-210,
							2820
						],
						"io": [
							[
								244,
								0,
								238,
								0
							]
						]
					},
					"245": {
						"offset": [
							140,
							2810
						],
						"io": [
							[
								245,
								0,
								247,
								0
							],
							[
								245,
								1,
								250,
								0
							],
							[
								245,
								2,
								253,
								0
							]
						]
					},
					"247": {
						"offset": [
							400,
							2700
						]
					},
					"248": {
						"offset": [
							-10,
							4600
						],
						"io": [
							[
								248,
								0,
								378,
								0
							]
						]
					},
					"249": {
						"offset": [
							-180,
							4600
						],
						"io": [
							[
								249,
								0,
								248,
								0
							]
						]
					},
					"250": {
						"offset": [
							370,
							2810
						]
					},
					"251": {
						"offset": [
							-50,
							2620
						],
						"io": [
							[
								251,
								0,
								255,
								0
							]
						]
					},
					"252": {
						"offset": [
							-210,
							2630
						],
						"io": [
							[
								252,
								0,
								251,
								0
							]
						]
					},
					"253": {
						"offset": [
							380,
							2900
						]
					},
					"255": {
						"offset": [
							130,
							2630
						],
						"io": [
							[
								255,
								0,
								256,
								0
							]
						]
					},
					"256": {
						"offset": [
							260,
							2630
						],
						"io": [
							[
								256,
								0,
								257,
								0
							]
						]
					},
					"257": {
						"offset": [
							400,
							2630
						],
						"io": [
							[
								257,
								0,
								258,
								0
							]
						]
					},
					"258": {
						"offset": [
							530,
							2630
						],
						"io": [
							[
								258,
								0,
								259,
								0
							]
						]
					},
					"259": {
						"offset": [
							680,
							2600
						],
						"io": [
							[
								259,
								0,
								260,
								0
							]
						]
					},
					"260": {
						"offset": [
							870,
							2620
						],
						"io": [
							[
								260,
								0,
								261,
								0
							],
							[
								260,
								1,
								262,
								0
							]
						]
					},
					"261": {
						"offset": [
							1010,
							2440
						],
						"io": [
							[
								261,
								1,
								266,
								0
							]
						]
					},
					"262": {
						"offset": [
							1010,
							2580
						],
						"io": [
							[
								262,
								1,
								277,
								0
							]
						]
					},
					"263": {
						"offset": [
							1370,
							2350
						],
						"io": [
							[
								263,
								0,
								267,
								0
							]
						]
					},
					"264": {
						"offset": [
							1370,
							2610
						],
						"io": [
							[
								264,
								0,
								278,
								0
							]
						]
					},
					"266": {
						"offset": [
							1180,
							2470
						],
						"io": [
							[
								266,
								0,
								263,
								0
							]
						]
					},
					"267": {
						"offset": [
							1520,
							2300
						],
						"io": [
							[
								267,
								3,
								275,
								0
							],
							[
								267,
								0,
								319,
								0
							],
							[
								267,
								1,
								321,
								0
							],
							[
								267,
								2,
								324,
								0
							]
						]
					},
					"268": {
						"offset": [
							2220,
							2130
						],
						"io": [
							[
								268,
								0,
								320,
								0
							]
						]
					},
					"270": {
						"offset": [
							2220,
							2250
						],
						"io": [
							[
								270,
								0,
								296,
								0
							]
						]
					},
					"275": {
						"offset": [
							2100,
							2460
						]
					},
					"277": {
						"offset": [
							1180,
							2600
						],
						"io": [
							[
								277,
								0,
								264,
								0
							]
						]
					},
					"278": {
						"offset": [
							1190,
							2710
						],
						"io": [
							[
								278,
								0,
								283,
								0
							],
							[
								278,
								1,
								295,
								0
							],
							[
								278,
								2,
								303,
								0
							]
						]
					},
					"281": {
						"offset": [
							1400,
							2870
						],
						"io": [
							[
								281,
								0,
								304,
								0
							]
						]
					},
					"282": {
						"offset": [
							1240,
							2870
						]
					},
					"283": {
						"offset": [
							1920,
							2580
						],
						"io": [
							[
								283,
								0,
								275,
								0
							],
							[
								283,
								1,
								285,
								0
							],
							[
								283,
								3,
								291,
								0
							],
							[
								283,
								2,
								288,
								0
							]
						]
					},
					"285": {
						"offset": [
							2100,
							2570
						]
					},
					"286": {
						"offset": [
							250,
							7070
						]
					},
					"287": {
						"offset": [
							90,
							7062
						],
						"io": [
							[
								287,
								0,
								286,
								0
							]
						]
					},
					"288": {
						"offset": [
							2100,
							2670
						]
					},
					"289": {
						"offset": [
							290,
							7070
						]
					},
					"290": {
						"offset": [
							250,
							6230
						],
						"io": [
							[
								290,
								0,
								420,
								0
							]
						]
					},
					"291": {
						"offset": [
							2100,
							2780
						]
					},
					"292": {
						"offset": [
							100,
							6230
						],
						"io": [
							[
								292,
								0,
								290,
								0
							]
						]
					},
					"294": {
						"offset": [
							2300,
							2890
						],
						"io": [
							[
								294,
								0,
								296,
								0
							]
						]
					},
					"295": {
						"offset": [
							2090,
							2880
						],
						"io": [
							[
								295,
								0,
								294,
								0
							]
						]
					},
					"296": {
						"offset": [
							2460,
							2900
						],
						"io": [
							[
								296,
								0,
								305,
								0
							],
							[
								296,
								1,
								311,
								0
							],
							[
								296,
								2,
								315,
								0
							]
						]
					},
					"297": {
						"offset": [
							3130,
							2830
						],
						"io": [
							[
								297,
								0,
								309,
								0
							]
						]
					},
					"300": {
						"offset": [
							3960,
							2950
						],
						"io": [
							[
								300,
								0,
								313,
								0
							]
						]
					},
					"301": {
						"offset": [
							3970,
							3060
						],
						"io": [
							[
								301,
								0,
								318,
								0
							]
						]
					},
					"303": {
						"offset": [
							1200,
							2860
						],
						"io": [
							[
								303,
								0,
								281,
								0
							]
						]
					},
					"304": {
						"offset": [
							1530,
							2870
						],
						"io": [
							[
								304,
								0,
								283,
								0
							],
							[
								304,
								1,
								295,
								0
							]
						]
					},
					"305": {
						"offset": [
							2790,
							2820
						],
						"io": [
							[
								305,
								0,
								306,
								0
							]
						]
					},
					"306": {
						"offset": [
							2950,
							2820
						],
						"io": [
							[
								306,
								0,
								297,
								0
							]
						]
					},
					"309": {
						"offset": [
							3270,
							2800
						],
						"io": [
							[
								309,
								2,
								310,
								0
							],
							[
								309,
								0,
								311,
								0
							],
							[
								309,
								1,
								315,
								0
							]
						]
					},
					"310": {
						"offset": [
							4480,
							2790
						]
					},
					"311": {
						"offset": [
							3650,
							2930
						],
						"io": [
							[
								311,
								0,
								312,
								0
							]
						]
					},
					"312": {
						"offset": [
							3810,
							2930
						],
						"io": [
							[
								312,
								0,
								300,
								0
							]
						]
					},
					"313": {
						"offset": [
							4100,
							2900
						],
						"io": [
							[
								313,
								2,
								314,
								0
							],
							[
								313,
								1,
								310,
								0
							],
							[
								313,
								0,
								315,
								0
							]
						]
					},
					"314": {
						"offset": [
							4510,
							2920
						]
					},
					"315": {
						"offset": [
							3650,
							3040
						],
						"io": [
							[
								315,
								0,
								317,
								0
							]
						]
					},
					"317": {
						"offset": [
							3820,
							3040
						],
						"io": [
							[
								317,
								0,
								301,
								0
							]
						]
					},
					"318": {
						"offset": [
							4100,
							3050
						],
						"io": [
							[
								318,
								1,
								314,
								0
							],
							[
								318,
								0,
								310,
								0
							],
							[
								318,
								2,
								311,
								0
							]
						]
					},
					"319": {
						"offset": [
							2060,
							2120
						],
						"io": [
							[
								319,
								0,
								268,
								0
							]
						]
					},
					"320": {
						"offset": [
							2360,
							2120
						]
					},
					"321": {
						"offset": [
							2060,
							2240
						],
						"io": [
							[
								321,
								0,
								270,
								0
							]
						]
					},
					"323": {
						"offset": [
							2550,
							2260
						],
						"io": [
							[
								323,
								1,
								333,
								0
							]
						]
					},
					"324": {
						"offset": [
							2090,
							2330
						],
						"io": [
							[
								324,
								0,
								332,
								0
							]
						]
					},
					"325": {
						"offset": [
							2400,
							2350
						],
						"io": [
							[
								325,
								0,
								323,
								0
							],
							[
								325,
								1,
								326,
								0
							]
						]
					},
					"326": {
						"offset": [
							2550,
							2400
						],
						"io": [
							[
								326,
								1,
								335,
								0
							]
						]
					},
					"327": {
						"offset": [
							2890,
							2300
						],
						"io": [
							[
								327,
								0,
								334,
								0
							]
						]
					},
					"330": {
						"offset": [
							3080,
							2470
						],
						"io": [
							[
								330,
								0,
								334,
								0
							]
						]
					},
					"332": {
						"offset": [
							2260,
							2340
						],
						"io": [
							[
								332,
								0,
								325,
								0
							]
						]
					},
					"333": {
						"offset": [
							2720,
							2280
						],
						"io": [
							[
								333,
								0,
								327,
								0
							]
						]
					},
					"334": {
						"offset": [
							3230,
							2360
						]
					},
					"335": {
						"offset": [
							2710,
							2460
						],
						"io": [
							[
								335,
								0,
								336,
								0
							]
						]
					},
					"336": {
						"offset": [
							2900,
							2460
						],
						"io": [
							[
								336,
								0,
								330,
								0
							]
						]
					},
					"337": {
						"offset": [
							-50,
							3700
						],
						"io": [
							[
								337,
								0,
								342,
								0
							]
						]
					},
					"339": {
						"offset": [
							-210,
							3700
						],
						"io": [
							[
								339,
								0,
								337,
								0
							]
						]
					},
					"340": {
						"offset": [
							400,
							3160
						]
					},
					"341": {
						"offset": [
							400,
							3260
						]
					},
					"342": {
						"offset": [
							140,
							3690
						],
						"io": [
							[
								342,
								0,
								343,
								0
							],
							[
								342,
								1,
								345,
								0
							],
							[
								342,
								2,
								353,
								0
							]
						]
					},
					"343": {
						"offset": [
							450,
							3630
						]
					},
					"344": {
						"offset": [
							-60,
							4000
						],
						"io": [
							[
								344,
								0,
								348,
								0
							]
						]
					},
					"345": {
						"offset": [
							450,
							3740
						],
						"io": [
							[
								345,
								0,
								346,
								0
							]
						]
					},
					"346": {
						"offset": [
							630,
							3730
						]
					},
					"348": {
						"offset": [
							120,
							4010
						],
						"io": [
							[
								348,
								0,
								349,
								0
							],
							[
								348,
								1,
								371,
								0
							]
						]
					},
					"349": {
						"offset": [
							340,
							3970
						]
					},
					"350": {
						"offset": [
							260,
							7430
						]
					},
					"351": {
						"offset": [
							-40,
							4230
						],
						"io": [
							[
								351,
								0,
								354,
								0
							]
						]
					},
					"352": {
						"offset": [
							-200,
							4240
						],
						"io": [
							[
								352,
								0,
								351,
								0
							]
						]
					},
					"353": {
						"offset": [
							450,
							3830
						]
					},
					"354": {
						"offset": [
							150,
							4240
						],
						"io": [
							[
								354,
								0,
								355,
								0
							],
							[
								354,
								1,
								357,
								0
							]
						]
					},
					"355": {
						"offset": [
							2070,
							4200
						]
					},
					"356": {
						"offset": [
							780,
							4120
						],
						"io": [
							[
								356,
								1,
								362,
								0
							]
						]
					},
					"357": {
						"offset": [
							510,
							4260
						],
						"io": [
							[
								357,
								0,
								358,
								0
							]
						]
					},
					"358": {
						"offset": [
							670,
							4280
						],
						"io": [
							[
								358,
								0,
								356,
								0
							],
							[
								358,
								1,
								359,
								0
							]
						]
					},
					"359": {
						"offset": [
							780,
							4280
						],
						"io": [
							[
								359,
								1,
								363,
								0
							]
						]
					},
					"360": {
						"offset": [
							1090,
							4180
						],
						"io": [
							[
								360,
								0,
								355,
								0
							]
						]
					},
					"361": {
						"offset": [
							1100,
							4310
						],
						"io": [
							[
								361,
								0,
								364,
								0
							]
						]
					},
					"362": {
						"offset": [
							920,
							4150
						],
						"io": [
							[
								362,
								0,
								360,
								0
							]
						]
					},
					"363": {
						"offset": [
							920,
							4290
						],
						"io": [
							[
								363,
								0,
								361,
								0
							]
						]
					},
					"364": {
						"offset": [
							1250,
							4290
						],
						"io": [
							[
								364,
								0,
								365,
								0
							],
							[
								364,
								1,
								409,
								0
							]
						]
					},
					"365": {
						"offset": [
							1690,
							4250
						],
						"io": [
							[
								365,
								0,
								355,
								0
							]
						]
					},
					"366": {
						"offset": [
							1940,
							4340
						],
						"io": [
							[
								366,
								0,
								355,
								0
							]
						]
					},
					"369": {
						"offset": [
							210,
							7430
						]
					},
					"370": {
						"offset": [
							60,
							7430
						],
						"io": [
							[
								370,
								0,
								369,
								0
							]
						]
					},
					"371": {
						"offset": [
							340,
							4080
						]
					},
					"372": {
						"offset": [
							240,
							7430
						]
					},
					"373": {
						"offset": [
							260,
							7410
						]
					},
					"374": {
						"offset": [
							240,
							6960
						]
					},
					"375": {
						"offset": [
							80,
							6960
						],
						"io": [
							[
								375,
								0,
								374,
								0
							]
						]
					},
					"377": {
						"offset": [
							290,
							6950
						]
					},
					"378": {
						"offset": [
							180,
							4610
						],
						"io": [
							[
								378,
								0,
								379,
								0
							],
							[
								378,
								1,
								380,
								0
							],
							[
								378,
								2,
								384,
								0
							],
							[
								378,
								3,
								388,
								0
							]
						]
					},
					"379": {
						"offset": [
							370,
							4480
						]
					},
					"380": {
						"offset": [
							370,
							4590
						]
					},
					"381": {
						"offset": [
							230,
							7290
						]
					},
					"382": {
						"offset": [
							70,
							7300
						],
						"io": [
							[
								382,
								0,
								381,
								0
							]
						]
					},
					"383": {
						"offset": [
							250,
							7300
						]
					},
					"384": {
						"offset": [
							370,
							4700
						]
					},
					"385": {
						"offset": [
							10,
							5000
						],
						"io": [
							[
								385,
								0,
								389,
								0
							]
						]
					},
					"386": {
						"offset": [
							-150,
							5010
						],
						"io": [
							[
								386,
								0,
								385,
								0
							]
						]
					},
					"388": {
						"offset": [
							370,
							4810
						]
					},
					"389": {
						"offset": [
							200,
							4990
						],
						"io": [
							[
								389,
								0,
								391,
								0
							],
							[
								389,
								1,
								400,
								0
							],
							[
								389,
								2,
								405,
								0
							]
						]
					},
					"391": {
						"offset": [
							510,
							4940
						],
						"io": [
							[
								391,
								0,
								393,
								0
							]
						]
					},
					"392": {
						"offset": [
							730,
							4880
						],
						"io": [
							[
								392,
								1,
								397,
								0
							]
						]
					},
					"393": {
						"offset": [
							650,
							4960
						],
						"io": [
							[
								393,
								0,
								392,
								0
							],
							[
								393,
								1,
								394,
								0
							]
						]
					},
					"394": {
						"offset": [
							730,
							5020
						],
						"io": [
							[
								394,
								1,
								407,
								0
							]
						]
					},
					"395": {
						"offset": [
							1040,
							4930
						],
						"io": [
							[
								395,
								0,
								399,
								0
							]
						]
					},
					"396": {
						"offset": [
							1050,
							5100
						],
						"io": [
							[
								396,
								0,
								401,
								0
							]
						]
					},
					"397": {
						"offset": [
							880,
							4910
						],
						"io": [
							[
								397,
								0,
								395,
								0
							]
						]
					},
					"399": {
						"offset": [
							1170,
							4900
						],
						"io": [
							[
								399,
								0,
								401,
								0
							],
							[
								399,
								1,
								406,
								0
							]
						]
					},
					"400": {
						"offset": [
							547,
							5084
						]
					},
					"401": {
						"offset": [
							1320,
							5080
						]
					},
					"402": {
						"offset": [
							260,
							5900
						],
						"io": [
							[
								402,
								0,
								411,
								0
							]
						]
					},
					"403": {
						"offset": [
							110,
							5900
						],
						"io": [
							[
								403,
								0,
								402,
								0
							]
						]
					},
					"405": {
						"offset": [
							540,
							5190
						]
					},
					"406": {
						"offset": [
							1320,
							4960
						]
					},
					"407": {
						"offset": [
							880,
							5080
						],
						"io": [
							[
								407,
								0,
								396,
								0
							]
						]
					},
					"409": {
						"offset": [
							1640,
							4330
						],
						"io": [
							[
								409,
								0,
								410,
								0
							]
						]
					},
					"410": {
						"offset": [
							1780,
							4330
						],
						"io": [
							[
								410,
								0,
								366,
								0
							]
						]
					},
					"411": {
						"offset": [
							430,
							5910
						],
						"io": [
							[
								411,
								2,
								412,
								0
							],
							[
								411,
								0,
								414,
								0
							],
							[
								411,
								1,
								418,
								0
							]
						]
					},
					"412": {
						"offset": [
							600,
							6020
						]
					},
					"414": {
						"offset": [
							600,
							5810
						]
					},
					"415": {
						"offset": [
							240,
							7190
						]
					},
					"416": {
						"offset": [
							60,
							7190
						],
						"io": [
							[
								416,
								0,
								415,
								0
							]
						]
					},
					"417": {
						"offset": [
							250,
							7190
						]
					},
					"418": {
						"offset": [
							600,
							5910
						]
					},
					"419": {
						"offset": [
							290,
							7190
						]
					},
					"420": {
						"offset": [
							420,
							6230
						],
						"io": [
							[
								420,
								0,
								421,
								0
							],
							[
								420,
								1,
								425,
								0
							],
							[
								420,
								2,
								426,
								0
							]
						]
					},
					"421": {
						"offset": [
							610,
							6160
						]
					},
					"422": {
						"offset": [
							270,
							6840
						]
					},
					"423": {
						"offset": [
							100,
							6840
						],
						"io": [
							[
								423,
								0,
								422,
								0
							]
						]
					},
					"424": {
						"offset": [
							300,
							6860
						]
					},
					"425": {
						"offset": [
							610,
							6270
						]
					},
					"426": {
						"offset": [
							610,
							6390
						]
					},
					"427": {
						"offset": [
							440,
							6590
						],
						"io": [
							[
								427,
								0,
								429,
								0
							],
							[
								427,
								1,
								430,
								0
							]
						]
					},
					"428": {
						"offset": [
							760,
							6690
						],
						"io": [
							[
								428,
								0,
								435,
								0
							]
						]
					},
					"429": {
						"offset": [
							600,
							6570
						]
					},
					"430": {
						"offset": [
							600,
							6680
						],
						"io": [
							[
								430,
								0,
								428,
								0
							]
						]
					},
					"431": {
						"offset": [
							1360,
							6720
						],
						"io": [
							[
								431,
								1,
								439,
								0
							]
						]
					},
					"432": {
						"offset": [
							1360,
							6580
						],
						"io": [
							[
								432,
								1,
								443,
								0
							]
						]
					},
					"433": {
						"offset": [
							1210,
							6670
						],
						"io": [
							[
								433,
								0,
								432,
								0
							],
							[
								433,
								1,
								431,
								0
							]
						]
					},
					"434": {
						"offset": [
							1070,
							6660
						],
						"io": [
							[
								434,
								0,
								433,
								0
							]
						]
					},
					"435": {
						"offset": [
							900,
							6650
						],
						"io": [
							[
								435,
								0,
								434,
								0
							]
						]
					},
					"437": {
						"offset": [
							1720,
							6660
						],
						"io": [
							[
								437,
								0,
								444,
								0
							]
						]
					},
					"438": {
						"offset": [
							1870,
							6800
						],
						"io": [
							[
								438,
								0,
								442,
								0
							]
						]
					},
					"439": {
						"offset": [
							1530,
							6780
						],
						"io": [
							[
								439,
								0,
								440,
								0
							]
						]
					},
					"440": {
						"offset": [
							1700,
							6780
						],
						"io": [
							[
								440,
								0,
								438,
								0
							]
						]
					},
					"442": {
						"offset": [
							2010,
							6790
						]
					},
					"443": {
						"offset": [
							1530,
							6620
						],
						"io": [
							[
								443,
								0,
								437,
								0
							]
						]
					},
					"444": {
						"offset": [
							1890,
							6620
						],
						"io": [
							[
								444,
								1,
								445,
								0
							],
							[
								444,
								0,
								447,
								0
							]
						]
					},
					"445": {
						"offset": [
							3120,
							6450
						]
					},
					"446": {
						"offset": [
							2660,
							6500
						],
						"io": [
							[
								446,
								1,
								453,
								0
							]
						]
					},
					"447": {
						"offset": [
							2200,
							6570
						],
						"io": [
							[
								447,
								0,
								448,
								0
							]
						]
					},
					"448": {
						"offset": [
							2370,
							6580
						],
						"io": [
							[
								448,
								0,
								449,
								0
							]
						]
					},
					"449": {
						"offset": [
							2510,
							6590
						],
						"io": [
							[
								449,
								0,
								446,
								0
							],
							[
								449,
								1,
								450,
								0
							]
						]
					},
					"450": {
						"offset": [
							2660,
							6640
						],
						"io": [
							[
								450,
								1,
								454,
								0
							]
						]
					},
					"451": {
						"offset": [
							2950,
							6560
						],
						"io": [
							[
								451,
								0,
								445,
								0
							]
						]
					},
					"452": {
						"offset": [
							3150,
							6730
						],
						"io": [
							[
								452,
								0,
								456,
								0
							]
						]
					},
					"453": {
						"offset": [
							2800,
							6550
						],
						"io": [
							[
								453,
								0,
								451,
								0
							]
						]
					},
					"454": {
						"offset": [
							2800,
							6720
						],
						"io": [
							[
								454,
								0,
								455,
								0
							]
						]
					},
					"455": {
						"offset": [
							2970,
							6720
						],
						"io": [
							[
								455,
								0,
								452,
								0
							]
						]
					},
					"456": {
						"offset": [
							3280,
							6710
						]
					}
				}
			}
		},
		"nodes": {
			"1": {
				"type": "entry",
				"name": "1",
				"data": {
					"plaque": "Start"
				}
			},
			"2": {
				"type": "content",
				"name": "2",
				"data": {
					"title": "UN ESPÍA EN ISENGARD"
				}
			},
			"6": {
				"type": "content",
				"name": "6",
				"data": {
					"title": "Prólogo",
					"content": "Eres el aprendiz de confianza de uno de los magos más grandes de toda la Tierra Media: ¡Saruman el Blanco!\n\nSaruman, uno de los cinco Istari, unos poderosos magos y conjuradores de quienes se dice que vinieron del oeste, donde viven los valar, los Inmortales Guardianes del Mundo. Saruman, hombre alto de larga barba y cabellos sueltos y canos, con apenas algunas mechas de color gris oscuro. Saruman, líder de la Orden de los magos, vestido con capucha y una túnica larga y ondulante, pura como la nieve recién caída, símbolo de su color y lugar. Saruman, cabeza del Concilio Blanco, un grupo que incluye no sólo a los magos, sino también a la reina élfica Galadriel, al maestro de sabiduría Elrond y a otros sabios. Saruman, conocido por muchos nombres, considerado por todos como un mago sin igual, a excepción del Señor Oscuro de Mordor.\n\n",
					"clear": true
				}
			},
			"7": {
				"type": "content",
				"name": "7",
				"data": {
					"content": "Te enfrentas a una terrible cuestión; ¿Ha traicionado Saruman al Concilio Blanco, tomando la senda del Mal?  ¡Debes averiguarlo! Y en tal caso, ¿qué puedes hacer? Quizá tu única esperanza sea enviar un mensaje a Galadriel, la Dama de Lórien. Saruman la mencionaba en el pasado con cierta frecuencia; decía que era una de los noldor, muy orgullosa y sabia. Sin embargo, raras veces tenia una palabra amable para ella, estaba claro que la consideraba como una especie de rival. En tanto que miembro del Concilio Blanco, Galadriel debería estar al corriente de las actividades de Saruman. En la azotea de Orthanc hay unas jaulas con aves mensajeras inteligentes; antes, Saruman solía utilizarlas para enviar mensajes a los otros líderes de la Tierra Media. Podrías enviar una de estas aves a la Dama élfica y tratar de convencerla de que viniera a hablar contigo un mensajero suyo. Así podrías comunicarle personalmente las negras noticias de la traición de Saruman (si demuestras que ésta existe), ya que es una información demasiado delicada para transmitirla con un ave mensajera, por más inteligente que sea.",
					"clear": true
				}
			},
			"8": {
				"type": "content",
				"name": "8",
				"data": {
					"title": "Elige solo dos objetos de la siguiente lista:",
					"clear": true,
					"rect": [
						129,
						121
					],
					"auto": true
				}
			},
			"20": {
				"type": "jump",
				"name": "16_",
				"data": {
					"target": 42,
					"reason": "",
					"rect": null
				},
				"ref": [
					42
				]
			},
			"27": {
				"type": "variable_update",
				"name": "r",
				"data": {
					"variable": 21,
					"operator": "set",
					"with": [
						0,
						1
					],
					"rect": [
						126,
						35
					]
				},
				"ref": [
					21
				]
			},
			"28": {
				"type": "variable_update",
				"name": "s",
				"data": {
					"variable": 23,
					"operator": "set",
					"with": [
						0,
						1
					],
					"rect": [
						213,
						54
					]
				},
				"ref": [
					23
				]
			},
			"29": {
				"type": "variable_update",
				"name": "t",
				"data": {
					"variable": 25,
					"operator": "set",
					"with": [
						0,
						1
					],
					"rect": [
						165,
						60
					]
				},
				"ref": [
					25
				]
			},
			"30": {
				"type": "variable_update",
				"name": "u",
				"data": {
					"variable": 24,
					"operator": "set",
					"with": [
						0,
						1
					],
					"rect": [
						189,
						66
					]
				},
				"ref": [
					24
				]
			},
			"31": {
				"type": "variable_update",
				"name": "v",
				"data": {
					"variable": 26,
					"operator": "set",
					"with": [
						0,
						1
					],
					"rect": [
						127,
						62
					]
				},
				"ref": [
					26
				]
			},
			"40": {
				"type": "variable_update",
				"name": "14",
				"data": {
					"variable": 36,
					"operator": "add",
					"with": [
						0,
						1
					],
					"rect": [
						160,
						67
					]
				},
				"ref": [
					36
				]
			},
			"42": {
				"type": "condition",
				"name": "16",
				"data": {
					"variable": 36,
					"operator": "eq",
					"with": [
						0,
						2
					],
					"rect": [
						157,
						89
					]
				},
				"ref": [
					36
				],
				"use": [
					20
				]
			},
			"55": {
				"type": "interaction",
				"name": "1j",
				"data": {
					"actions": [
						"daga"
					],
					"rect": [
						134,
						84
					]
				}
			},
			"56": {
				"type": "interaction",
				"name": "1k",
				"data": {
					"actions": [
						"3 dosis de hierbas"
					]
				}
			},
			"60": {
				"type": "condition",
				"name": "1o",
				"data": {
					"variable": 21,
					"operator": "eq",
					"with": [
						0,
						1
					]
				},
				"ref": [
					21
				]
			},
			"62": {
				"type": "condition",
				"name": "1q",
				"data": {
					"variable": 23,
					"operator": "eq",
					"with": [
						0,
						1
					],
					"rect": [
						248,
						121
					]
				},
				"ref": [
					23
				]
			},
			"63": {
				"type": "sequencer",
				"name": "1r",
				"data": {
					"slots": 5
				}
			},
			"64": {
				"type": "condition",
				"name": "1s",
				"data": {
					"variable": 24,
					"operator": "eq",
					"with": [
						0,
						1
					],
					"rect": [
						208,
						96
					]
				},
				"ref": [
					24
				]
			},
			"65": {
				"type": "interaction",
				"name": "1t",
				"data": {
					"actions": [
						"coraza de cuero"
					],
					"rect": [
						156,
						78
					]
				}
			},
			"66": {
				"type": "condition",
				"name": "1u",
				"data": {
					"variable": 25,
					"operator": "eq",
					"with": [
						0,
						1
					],
					"rect": [
						187,
						116
					]
				},
				"ref": [
					25
				]
			},
			"67": {
				"type": "interaction",
				"name": "1v",
				"data": {
					"actions": [
						"espada corta"
					],
					"rect": [
						134,
						84
					]
				}
			},
			"68": {
				"type": "condition",
				"name": "1w",
				"data": {
					"variable": 26,
					"operator": "eq",
					"with": [
						0,
						1
					],
					"rect": [
						179,
						101
					]
				},
				"ref": [
					26
				]
			},
			"69": {
				"type": "interaction",
				"name": "1x",
				"data": {
					"actions": [
						"mochila"
					],
					"rect": [
						134,
						84
					]
				}
			},
			"74": {
				"type": "content",
				"name": "22",
				"data": {
					"content": "Comienzas tu investigación en el pináculo de Orthanc Z19 (Observatorio). \n\nDentro de la torre de Ortbanc puedes entrar en una habitación adyacente o subir o bajar por una escalera. \n ",
					"clear": true
				}
			},
			"75": {
				"type": "content",
				"name": "23",
				"data": {
					"title": "Z19 (Observatorio)",
					"rect": [
						166,
						101
					],
					"content": "Muy por encima de la llanura de Isengard se alza el séptimo nivel de Orthanc el observatorio de la azotea. Aunque se le llama <séptimo nivel>, sabes que en realidad hay muchos otros pisos entre los <niveles> principales: todos tienen estancias cerradas bajo llave y criptas secretas. Saruman admite que incluso él podría no haberlas encontrado todas, todavía. En tanto que aprendiz del Mago Blanco, se te permite el acceso solamente a los niveles principales; Saruman se reserva para sí mismo el acceso a «las salas interiores», como le gusta llamarlas.\nEsta estrecha área exterior está resguardada entre los picos de los cuatro impresionantes pilares de piedra negra a ciento cincuenta metros sobre el suelo, unidos por un muro (deberías ponerte de puntillas para mirar por encima de él); más allá, abajo, se extiende la llanura de Isengard. Te esfuerzas por ver algo en el llano, pero está envuelto en una espesa niebla. Crees ver a lo lejos las torres de una muralla que sobresale entre las brumas. Así debe de sentirse uno cuando \"está en las nubes\", piensas, contemplando con atención el paisaje en penumbra. Una brisa fría te agita los cabellos cuando te alejas del muro. En el suelo ves grabados muchos signos astrológicos. En un nicho vacío de uno de los picos se halla la jaula de las aves mensajeras.\n",
					"clear": true
				},
				"use": [
					128
				]
			},
			"77": {
				"type": "variable_update",
				"name": "25",
				"data": {
					"variable": 3,
					"operator": "set",
					"with": [
						0,
						"Z19"
					],
					"rect": [
						134,
						73
					]
				},
				"ref": [
					3
				]
			},
			"79": {
				"type": "variable_update",
				"name": "27",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						130,
						54
					]
				},
				"ref": [
					78
				]
			},
			"83": {
				"type": "condition",
				"name": "2b",
				"data": {
					"variable": 82,
					"operator": "eq",
					"with": [
						0,
						true
					],
					"rect": [
						203,
						98
					]
				},
				"ref": [
					82
				]
			},
			"88": {
				"type": "generator",
				"name": "2g",
				"data": {
					"variable": 80,
					"method": "randi",
					"arguments": [
						2,
						12,
						false,
						true,
						true
					],
					"rect": [
						131,
						106
					]
				},
				"ref": [
					80
				]
			},
			"89": {
				"type": "condition",
				"name": "2h",
				"data": {
					"variable": 80,
					"operator": "lse",
					"with": [
						0,
						5
					]
				},
				"ref": [
					80
				]
			},
			"90": {
				"type": "condition",
				"name": "2i",
				"data": {
					"variable": 80,
					"operator": "gte",
					"with": [
						0,
						6
					]
				},
				"ref": [
					80
				]
			},
			"91": {
				"type": "sequencer",
				"name": "2j",
				"data": {
					"slots": 2
				}
			},
			"93": {
				"type": "content",
				"name": "2l",
				"data": {
					"content": "Comienzas a escribir cuidadosamente una nota para la reina élfica Galadriel; su reino debe de estar muy cerca y seguramente la Dama del Bosque de Oro le ayudará. Desearías poder ponerte en contacto con Gandalf el Gris, pues es sabio y también uno de los istari, pero el Mago Gris siempre está viajando y es difícil de localizar. Cuando estás acabando la nota, oyes un rumor de pasos en las escaleras."
				}
			},
			"95": {
				"type": "variable_update",
				"name": "2n",
				"data": {
					"variable": 82,
					"operator": "set",
					"with": [
						0,
						false
					]
				},
				"ref": [
					82
				]
			},
			"96": {
				"type": "content",
				"name": "2o",
				"data": {
					"content": "Hábilmente, guardas la nota a medio escribir en el bolsillo. Un instante más tarde, a través de la puerta abierta, ves la capucha blanca que cubre la cabeza del mismísimo Saruman, asomando por la escalera de caracol. El mago sonríe con malicia al verte.\n\n—¡Vaya, hola, mi joven amigo! --dice con su voz suave y tranquilizadora--. \nMe sorprende verte en la azotea a estas horas. ¡Sin duda, estás estudiando las estrellas! Muy bien.\n\nSe queda quieto un momento y mira al cielo. Tú logras controlar tus temblores, pero no puedes evitar fijarte en que los ropajes de Saruman no parecen blancos a la luz de la luna. De hecho, mientras la fría brisa los agita, parecen cambiar, pasando por todos Ios colores imaginables.\n\nEl mago vuelve a hablar, al principio casi para sus adentros:\n—La vista es bastante defectuosa con el cuarto creciente, pero aun así pueden verse la mayoría de las Constelaciones -- De pronto, se vuelve hacia ti, su penetrante mirada parece atravesar el centro de tu palpitante corazón— Creo que me retiraré por hoy. ¡Buenas noches! Saruman se vuelve y desaparece entre el torbellino de sus ropajes. Exhalas, pues sólo entonces te das cuenta de que, todo este tiempo has estado conteniendo la respiración. Tras aguardar un minuto hasta recuperar la calma, sacas la nota para terminarla.\n",
					"clear": true
				}
			},
			"97": {
				"type": "variable_update",
				"name": "2p",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						130,
						54
					]
				},
				"ref": [
					78
				]
			},
			"98": {
				"type": "variable_update",
				"name": "2q",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						130,
						54
					]
				},
				"ref": [
					78
				]
			},
			"99": {
				"type": "content",
				"name": "2r",
				"data": {
					"title": "Terminas la nota y la relees:",
					"content": "A la Dama de Lórien:\nYo, un aprendiz de Saruman el Blanco de Isengard, escribo este mensaje urgente. Debo comunicar una información especial al Concilio Blanco, de carácter demasiado delicado para que pueda ser mandada por un ave mensajera. No contestéis a esta carta; enviad a un mensajero a mi encuentro, dentro de diez días, a medianoche (habrá luna llena). Estaré aguardando a vuestro enviado en: ",
					"clear": true
				}
			},
			"101": {
				"type": "variable_update",
				"name": "2t",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						15
					],
					"rect": [
						130,
						54
					]
				},
				"ref": [
					78
				]
			},
			"102": {
				"type": "variable_update",
				"name": "2u",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						20
					],
					"rect": [
						130,
						54
					]
				},
				"ref": [
					100
				]
			},
			"104": {
				"type": "interaction",
				"name": "2w",
				"data": {
					"actions": [
						"La entrada del Valle del Mago [3F]",
						"El puente sobre el río Isen [6A]",
						"Una casa abandonada cerca del río [4C]"
					],
					"rect": [
						340,
						121
					]
				}
			},
			"105": {
				"type": "variable_update",
				"name": "2x",
				"data": {
					"variable": 103,
					"operator": "set",
					"with": [
						0,
						"3F"
					],
					"rect": [
						198,
						69
					]
				},
				"ref": [
					103
				]
			},
			"106": {
				"type": "variable_update",
				"name": "2y",
				"data": {
					"variable": 103,
					"operator": "set",
					"with": [
						0,
						"6A"
					],
					"rect": [
						198,
						69
					]
				},
				"ref": [
					103
				]
			},
			"107": {
				"type": "variable_update",
				"name": "2z",
				"data": {
					"variable": 103,
					"operator": "set",
					"with": [
						0,
						"4C"
					],
					"rect": [
						198,
						69
					]
				},
				"ref": [
					103
				]
			},
			"108": {
				"type": "content",
				"name": "30",
				"data": {
					"content": "Una vez acabada la nota, la introduces en uno de los diminutos cartuchos y lo atas a la pata de Elramar (Alas de estrellas), un pájaro mensajero muy fiable. El ave aletea ruidosamente y emprende el vuelo rodeando la torre antes de partir hacia el nordeste, donde se halla el Bosque de Oro de Lórien. "
				}
			},
			"109": {
				"type": "content",
				"name": "31",
				"data": {
					"content": "Tras enviar el mensaje, decides esperar todo el tiempo posible antes de intentar reunir Pistas y Marcharte de Isengard. Así, Saruman dispondrá de poco tiempo para descubrir tu traición.\n\nPasan los días con infinita lentitud, pese a que te mantienes ocupado con los quehaceres domésticos y tus estudios. Siempre que te encuentras cerca de Saruman te pones nervioso, pero él no parece darse cuenta de ello. Es obvio que el Mago Blanco está concentrado en otros asuntos.\n\n"
				}
			},
			"111": {
				"type": "variable_update",
				"name": "33",
				"data": {
					"variable": 3,
					"operator": "set",
					"with": [
						0,
						"W14"
					]
				},
				"ref": [
					3
				]
			},
			"113": {
				"type": "variable_update",
				"name": "35",
				"data": {
					"variable": 112,
					"operator": "add",
					"with": [
						0,
						9
					]
				},
				"ref": [
					112
				]
			},
			"114": {
				"type": "content",
				"name": "36",
				"data": {
					"content": "Amanece la mañana del décimo día. Mientras acabas de desayunar con tranquilidad en tu habitación (W14), comienzas a planear el modo de obtener pruebas más específicas de la fechoría de Saruman el Blanco. Tienes que encontrar muestras de su traición. Son las diez de la mañana. Deberías salir de la torre dentro de doce horas, solo así sabrás que tienes el tiempo suficiente para llegar a medianoche al lugar acordado para la cita (840 minutos a partir de ahora). Lo más inteligente es utilizar este tiempo para reunir información sobre las actividades de tu Maestro. \n\nNota: El tiempo actual es 0 minutos del Día 10.  Puedes pasar más tiempo aquí si lo deseas. Luego, sigue adelante.\n"
				}
			},
			"115": {
				"type": "variable_update",
				"name": "37",
				"data": {
					"variable": 112,
					"operator": "add",
					"with": [
						0,
						1
					]
				},
				"ref": [
					112
				]
			},
			"117": {
				"type": "variable_update",
				"name": "39",
				"data": {
					"variable": 116,
					"operator": "set",
					"with": [
						0,
						10
					]
				},
				"ref": [
					116
				]
			},
			"119": {
				"type": "variable_update",
				"name": "3b",
				"data": {
					"variable": 118,
					"operator": "set",
					"with": [
						0,
						840
					]
				},
				"ref": [
					118
				]
			},
			"122": {
				"type": "content",
				"name": "3e",
				"data": {
					"title": "S19",
					"rect": [
						165,
						102
					],
					"content": "Te encuentras en el último rellano de la escalera más alta. Dos ventanucos dan al norte y al oeste. Al sudoeste hay una portezuela estrecha que conduce a la azotea de Orthanc. Puedes bajar (a S18) o cruzar la puerta y salir a la azotea (Z19).\n"
				},
				"use": [
					140
				]
			},
			"124": {
				"type": "content",
				"name": "3g",
				"data": {
					"content": "La ciudadela de Isengard ha sido tu hogar durante la mayor parte de tu breve vida. Es una fortaleza impresionante enclavada al norte de un resguardado valle llamado Nan Curunir (el Valle del Mago).\n\nEl Valle se extiende a lo largo del extremo sur de las Montañas Nubladas, junto a la frontera de Rohan, la tierra de los Señores de los Caballos. Aunque protegida por un muro circular de más de un kilómetro y medio de diámetro, Isengard también está custodiada por un gran ejército. La parte más maravillosa (y misteriosa) de la fortaleza es, posiblemente, la torre central, Orthanc, que quiere decir (Espíritu Astuto) en una lengua y (Monte del Colmillo) en otra. De hecho, ambas expresiones son ciertas, ya que Orthanc es un pináculo de piedra negra, lisa e indestructible, de ciento cincuenta metros de alto. y cuya cima se abre en cuatro picos, puntiagudos como agujas Su interior es un laberinto de habitaciones, pasadizos y escaleras, diseñado para confundir a todos salvo a quienes lo habiten y estén más familiarizados con él. Tienes la fortuna de ser una de esas personas.\n\nEres huérfano. Te trajeron a Isengard cuando eras muy joven, junto con otros chicos de tu edad. A diferencia de la mayoría de tus compañeros, sirvientes o aprendices al servicio de Saruman, eres alto y de cabellos oscuros Algunos de los otros adquirieron la recia complexión de los rohirrim, muy rubios y de tez pálida; prácticamente todos los demás (casi todos ellos varones) alcanzaron una estatura menor, con el pelo castaño y la piel morena de los dunlendinos. Hace años que no los ves.\n\n"
				}
			},
			"125": {
				"type": "content",
				"name": "3h",
				"data": {
					"content": "Saruman ha intuido un gran porvenir en ti (al parecer, más que en los otros) y te permite el acceso a varios de los innumerables niveles de la imponente torre de Orthanc. Con una notable excepción: te ha prohibido entrar en la cámara del palantir, la habitación donde se guarda la antigua <piedra que ve> del perdido Númenor. Ni siquiera te ha autorizado a que hables de ella a desconocidos. De hecho, el propio Saruman se ha aventurado en raras ocasiones a entrar en aquella estancia... hasta hace poco.\n\nSaruman te ha dado un juego de llaves de Orthanc y te permite que lo ayudes en muchos de sus experimentos. Al principio era un tutor amable y maravilloso, pero en los últimos años has notado un cambio en el viejo mago. Te habla menos, permanece encerrado en su laboratorio o, lo que es más aterrador, en la cámara de la <piedra que ve>. Parece hastiado de la vida y se enfurece con facilidad; entonces, en sus ojos centellean oscuros relámpagos. Se han excavado vastos arsenales y pozos en las arboledas de Isengard, que una vez fueron hermosas. Son escondrijos para albergar y abastecer a un enorme ejército. Y lo peor es que pueden verse orcos y otras criaturas aún más horribles dentro de los muros de Isengard, como si el mago los hubiera recibido con los brazos abiertos. ¿Es posible? \n\n¿Está engañando Saruman al Concilio Blanco? ¿Podría haberse aliado con el Señor Oscuro? \n"
				}
			},
			"128": {
				"type": "jump",
				"name": "3k",
				"data": {
					"target": 75,
					"reason": "Z19"
				},
				"ref": [
					75
				]
			},
			"129": {
				"type": "variable_update",
				"name": "3l",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					]
				},
				"ref": [
					78
				],
				"use": [
					136
				]
			},
			"131": {
				"type": "jump",
				"name": "3n",
				"data": {
					"target": 137,
					"reason": "S18"
				},
				"ref": [
					137
				]
			},
			"134": {
				"type": "variable_update",
				"name": "3q",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					]
				},
				"ref": [
					78
				]
			},
			"135": {
				"type": "content",
				"name": "3r",
				"data": {
					"title": "Z19 (Observatorio)",
					"content": "Muy por encima de la llanura de Isengard se alza el séptimo nivel de Orthanc el observatorio de la azotea. Aunque se le llama <séptimo nivel>, sabes que en realidad hay muchos otros pisos entre los <niveles> principales: todos tienen estancias cerradas bajo llave y criptas secretas. Saruman admite que incluso él podría no haberlas encontrado todas, todavía. En tanto que aprendiz del Mago Blanco, se te permite el acceso solamente a los niveles principales; Saruman se reserva para sí mismo el acceso a «las salas interiores», como le gusta llamarlas.\nEsta estrecha área exterior está resguardada entre los picos de los cuatro impresionantes pilares de piedra negra a ciento cincuenta metros sobre el suelo, unidos por un muro (deberías ponerte de puntillas para mirar por encima de él); más allá, abajo, se extiende la llanura de Isengard. Te esfuerzas por ver algo en el llano, pero está envuelto en una espesa niebla. Crees ver a lo lejos las torres de una muralla que sobresale entre las brumas. Así debe de sentirse uno cuando \"está en las nubes\", piensas, contemplando con atención el paisaje en penumbra. Una brisa fría te agita los cabellos cuando te alejas del muro. En el suelo ves grabados muchos signos astrológicos. En un nicho vacío de uno de los picos se halla la jaula de las aves mensajeras.\n",
					"clear": true,
					"rect": [
						198,
						106
					]
				}
			},
			"136": {
				"type": "jump",
				"name": "3s",
				"data": {
					"target": 129,
					"reason": "S19"
				},
				"ref": [
					129
				]
			},
			"137": {
				"type": "content",
				"name": "3t",
				"data": {
					"title": "S18",
					"content": "Como una gigantesca serpiente, la escalera se retuerce hasta perderse en la oscuridad. En este rellano, pequeño y apenas iluminado, se alza la estrecha puerta de piedra negra que conduce a la cámara del palantir. Permaneces inmóvil entre las sombras del umbral, mien¬tras la sangre bombea en tus oídos. ¿Entrarás en la habitación secreta, donde yace una de las piedras más antiguas y poderosas del mundo? Te debates entre el miedo y la curiosidad.\n\nSi intentas entrar en la cámara del palantir (Y18), pasa al 123.\n•De lo contrario sigue adelante subiendo (a S19) o bajando (a S17).\n"
				},
				"use": [
					131
				]
			},
			"138": {
				"type": "variable_update",
				"name": "3u",
				"data": {
					"variable": 78,
					"operator": "set",
					"with": [
						0,
						0
					]
				},
				"ref": [
					78
				]
			},
			"139": {
				"type": "variable_update",
				"name": "3v",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					]
				},
				"ref": [
					78
				]
			},
			"140": {
				"type": "jump",
				"name": "3w",
				"data": {
					"target": 122,
					"reason": "S19"
				},
				"ref": [
					122
				]
			},
			"143": {
				"type": "jump",
				"name": "3z",
				"data": {
					"target": 145,
					"reason": "S19"
				},
				"ref": [
					145
				]
			},
			"145": {
				"type": "interaction",
				"name": "41",
				"data": {
					"actions": [
						"S19"
					],
					"rect": [
						141,
						91
					]
				},
				"use": [
					143
				]
			},
			"147": {
				"type": "interaction",
				"name": "43",
				"data": {
					"actions": [
						"Z19",
						"S18"
					],
					"rect": [
						141,
						91
					]
				}
			},
			"149": {
				"type": "content",
				"name": "45",
				"data": {
					"title": "Tu habitación W14",
					"content": "Esta estancia te resulta familiar: es tu habitación, naturalmente, tu hogar durante estos últimos años. Las ventanas dan al este y al norte. A menudo te has sentado en el amplio alféizar y has mirado al exterior, al otro lado de la muralla de Isengard, pensando en la costa y en el mar...  y en ¿qué habrá más allá?\n\nTu habitación es grande y cómoda, aunque tiene un mobiliario sencillo, comparada con el resto de Orthanc, la mayoría de la gente la consideraría digna de un palacio. Hace mucho tiempo que exploraste cada hueco y hasta la última piedra de tu dormitorio, y nunca encontraste nada misterioso ni especialmente interesante. Puedes pasar aquí tantas horas o tantos días como desees, siempre y cuando no estén buscándote. De lo contrario, el tiempo transcurrido es de 5 minutos. \n",
					"rect": [
						186,
						82
					]
				},
				"use": [
					156
				]
			},
			"150": {
				"type": "interaction",
				"name": "46",
				"data": {
					"actions": [
						"Escalera S14"
					],
					"rect": [
						112,
						61
					]
				}
			},
			"151": {
				"type": "condition",
				"name": "47",
				"data": {
					"variable": 153,
					"operator": "eq",
					"with": [
						0,
						false
					],
					"rect": [
						193,
						126
					]
				},
				"ref": [
					153
				],
				"use": [
					186
				]
			},
			"154": {
				"type": "variable_update",
				"name": "4a",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"155": {
				"type": "interaction",
				"name": "4b",
				"data": {
					"actions": [
						"Escalera S14",
						"Tu habitación W14"
					],
					"rect": [
						179,
						57
					]
				}
			},
			"156": {
				"type": "jump",
				"name": "4c",
				"data": {
					"target": 149,
					"reason": "Tu habitación W14",
					"rect": [
						162,
						81
					]
				},
				"ref": [
					149
				]
			},
			"157": {
				"type": "jump",
				"name": "4d",
				"data": {
					"target": 173,
					"reason": "Escalera S14",
					"rect": [
						128,
						100
					]
				},
				"ref": [
					173
				]
			},
			"160": {
				"type": "marker",
				"name": "4g",
				"data": {
					"label": "Y18",
					"color": "1a4cd2ff"
				}
			},
			"164": {
				"type": "jump",
				"name": "4k",
				"data": {
					"target": -1,
					"reason": "Y18"
				}
			},
			"165": {
				"type": "interaction",
				"name": "4l",
				"data": {
					"actions": [
						"S19",
						"Y18 (Cámara del Palantir)",
						"S17"
					],
					"rect": [
						227,
						117
					]
				}
			},
			"166": {
				"type": "jump",
				"name": "4m",
				"data": {
					"target": 168,
					"reason": "S17"
				},
				"ref": [
					168
				]
			},
			"168": {
				"type": "content",
				"name": "4o",
				"data": {
					"title": "S17",
					"content": "Llegas al rellano del quinto nivel de esta escalera. Frente a ti en la pared, ves una gran puerta metálica de diseño inusual. En vez de girar sobre goznes, como casi todas las puertas, sube deslizándose por una ranura. Saruman te explicó que es un cierre más seguro en caso de que se desprenda algún gas peligroso en el laboratorio, que se halla al otro lado de la puerta. Desde aquí puedes subir (a S18), bajar (a S13) o entrar en el laboratorio (X17), Sigue adelante"
				},
				"use": [
					166
				]
			},
			"170": {
				"type": "variable_update",
				"name": "4q",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						126,
						69
					]
				},
				"ref": [
					78
				],
				"use": [
					237
				]
			},
			"171": {
				"type": "marker",
				"name": "4r",
				"data": {
					"label": "varias opciones",
					"color": "1a4cd2ff"
				}
			},
			"172": {
				"type": "content",
				"name": "4s",
				"data": {
					"title": "S14",
					"content": "En el cuarto nivel de esta escalera los escalones terminan frente a la puerta de tu dormitorio. Aunque esta puerta no es tan imponente como algunas de las que se encuentran en los niveles inferiores, está hecha de madera dura y maciza, con runas y delicados dibujos labrados de forma muy elaborada. En el pequeño pórtico, junto a la puerta, cuelga un fanal de latón y cristal que proyecta una luz acogedora sobre el rellano. Te paras a reflexionar sobre lo que harás a continuación. Desde aquí puedes bajar (a S10) o entrar en tu dormitorio (W14). "
				},
				"use": [
					175
				]
			},
			"173": {
				"type": "variable_update",
				"name": "4t",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					157,
					194
				]
			},
			"175": {
				"type": "jump",
				"name": "4v",
				"data": {
					"target": 172,
					"reason": "Escalera S14",
					"rect": [
						127,
						90
					]
				},
				"ref": [
					172
				]
			},
			"177": {
				"type": "content",
				"name": "4x",
				"data": {
					"title": "Estudio de Saruman W13 ",
					"content": "Aunque ya habías estado anteriormente en el estudio de Saruman, siempre habías venido por invitación del mago, y su penetrante mirada te mantenía tan tenso que apenas habías tenido la ocasión de echar poco más que un vistazo superficial a la habitación. Sin embargo, ahora puedes examinarla con mayor atención Las paredes están cubiertas de estanterías atestadas no sólo de los cuadernos de Saruman, sino también de una amplia variedad de extraños objetos. Pasa al 467.\n",
					"rect": [
						217,
						92
					]
				}
			},
			"178": {
				"type": "variable_update",
				"name": "4y",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					243
				]
			},
			"180": {
				"type": "content",
				"name": "50",
				"data": {
					"content": "Las miríadas de objetos que abarrotan la habitación son todas fascinantes y atraen tu atención, pero hay algo sobre el escritorio que te intriga aún más; es un pergamino; el sello está roto, pero aún sigue enrollado. Lo despliegas con cautela mientras te acuerdas del mensajero que lo trajo ayer mismo; un hombre extraño y moreno, vestido de negro. Recuerdas que sentías escalofríos cuando estabas a su lado.\n\n\n\n\n"
				}
			},
			"182": {
				"type": "content",
				"name": "52",
				"data": {
					"title": "Tesoreria W15",
					"content": "La pesada puerta gira hacia dentro sobre sus goznes de una aleación reluciente, y revela una estancia débilmente iluminada por unos finos rayos de luz que nacen cerca del techo. Entras con sigilo, cierras cuidadosamente la puerta a tus espaldas y le apoyas en ella mientras tus ojos se adaptan a la semioscuridad Hay una hilera de siete hornacinas excavadas en la pared curvada (que se corresponde con el muro exterior de Orthanc), y sobre cada una de ellas ves uno de los rayos oblicuos de luz. Estos siete rayos convergen en un punto de la habitación: una plataforma, de poco más de dos metros de diámetro y que se alza un metro del suelo. Tienes la impresión de que, en un tiempo pasado, esta extraña habitación tenía algún propósito de carácter místico, olvidado hace muchos años.\n\nDiversas cajas y cofrecillos se apilan sobre la plataforma. Cuando avanzas por la habitación, ves que en cada hornacina hay un pequeño cofre de madera."
				}
			},
			"183": {
				"type": "variable_update",
				"name": "53",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						15
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					442,
					456
				]
			},
			"186": {
				"type": "jump",
				"name": "56",
				"data": {
					"target": 151,
					"reason": "W14",
					"rect": [
						97,
						95
					]
				},
				"ref": [
					151
				]
			},
			"187": {
				"type": "interaction",
				"name": "57",
				"data": {
					"actions": [
						"W14",
						"S10"
					]
				}
			},
			"188": {
				"type": "content",
				"name": "58",
				"data": {
					"title": "S10",
					"content": "Llegas al rellano del tercer nivel. Una puerta grande de madera oscura y brillante y de arco ojival está empotrada en un nicho de la pared interior. Esta enorme puerta conduce a la extraordinaria Biblioteca de Orthanc."
				},
				"use": [
					190
				]
			},
			"189": {
				"type": "variable_update",
				"name": "59",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					285,
					343
				]
			},
			"190": {
				"type": "jump",
				"name": "5a",
				"data": {
					"target": 188,
					"reason": "S10"
				},
				"ref": [
					188
				]
			},
			"193": {
				"type": "interaction",
				"name": "5d",
				"data": {
					"actions": [
						"S14",
						"S6",
						"Biblioteca V12 "
					],
					"rect": [
						173,
						110
					]
				}
			},
			"194": {
				"type": "jump",
				"name": "5e",
				"data": {
					"target": 173,
					"reason": "S14"
				},
				"ref": [
					173
				]
			},
			"195": {
				"type": "content",
				"name": "5f",
				"data": {
					"content": "Saruman,\nNo me has informado de tus progresos, como me prometiste. Esto me molesta. Te sugiero que reanudes la comunicación inmediatamente a través de la Piedra, si no deseas conocer su ira... ¡o la mía! La Boca de Sauron"
				}
			},
			"196": {
				"type": "content",
				"name": "5g",
				"data": {
					"content": "Debajo de la firma hay un ojo sin párpado dibujado con tinta roja. Sueltas el pergamino, asqueado, y permaneces con la mirada fija en la pared, pero sin ver nada. ¡La Boca de Sauron! ¡Sauron de Mordor, el Señor de los Anillos, ¡ha estado hablando con Saruman! Tus peores temores se ven confirmados. Anota la Pista A. Sigue adelante a S13."
				}
			},
			"198": {
				"type": "variable_update",
				"name": "5i",
				"data": {
					"variable": 197,
					"operator": "set",
					"with": [
						0,
						true
					]
				},
				"ref": [
					197
				]
			},
			"199": {
				"type": "jump",
				"name": "5j",
				"data": {
					"target": 201,
					"reason": "S13"
				},
				"ref": [
					201
				]
			},
			"201": {
				"type": "content",
				"name": "5l",
				"data": {
					"title": "S13",
					"content": "Los escalones se alejan en espiral en ambas direcciones, y ante ti tienes una puerta alta de arco ojival. Conduce al estudio de Saruman."
				},
				"use": [
					199
				]
			},
			"202": {
				"type": "variable_update",
				"name": "5m",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					247
				]
			},
			"204": {
				"type": "interaction",
				"name": "5o",
				"data": {
					"actions": [
						"Sales de la Tesorería (S15)",
						"Observas los objetos que están sobre la plataforma",
						"Si examinas los cofres de las hornacinas"
					],
					"rect": [
						422,
						143
					]
				}
			},
			"205": {
				"type": "content",
				"name": "5p",
				"data": {
					"title": "Escalera S15",
					"content": "Esta escalera acaba en un estrecho rellano del cuarto nivel. Delante de ti, la puerta de hierro frío de la Tesorería te impide el paso; a ambos lados ves unas estatuas de hierro: unos hombres altos atavia¬dos con armadura de láminas completa. Has venido aquí algunas ve¬ces. y en cada ocasión la amenazadora presencia de las estatuas gemelas te ha producido escalofríos. Saruman te ha asegurado que los guardianes no son más que simples esculturas, pero nunca ha lo¬grado convencerte del todo."
				}
			},
			"206": {
				"type": "variable_update",
				"name": "5q",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					228,
					445
				]
			},
			"209": {
				"type": "content",
				"name": "5t",
				"data": {
					"content": "Hay cajas de todas las formas y tamaños; algunas son de metal, y otras de madera con cierres de cuero de diseño muy delicado. Sin embargo, como todas son muy antiguas, el cuero es quebradizo y se parte en cuanto lo tocas. Lo peor es que todas parecen estar vacías. Abres una caja tras otra, perdiendo progresivamente la paciencia, hasta que llegas, por fin, al final del montón. Sólo queda una, tan peque¬ña, que sólo puede contener una joya de reducido tamaño. Abres con cautela la diminuta tapa, esperando casi que también esté vacía... ¡pero no! En su interior, envuelto en un paño de terciopelo negro hay un precioso anillo de oro engastado con tres rubíes. Lo deslizas en tu dedo: se ajusta perfectamente. Tiene una inscripción apenas visible:\n«Soy un Anillo de Fuego; quien me lleve podrá lanzar un Rayo de Fuego por día sin sufrir ningún daño.»"
				}
			},
			"210": {
				"type": "variable_update",
				"name": "5u",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						10
					]
				},
				"ref": [
					100
				]
			},
			"211": {
				"type": "variable_update",
				"name": "5v",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						20
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					220
				]
			},
			"212": {
				"type": "interaction",
				"name": "5w",
				"data": {
					"actions": [
						"Si te quedas con el Anillo",
						"Si vuelves a guardarlo en la caja"
					],
					"rect": [
						296,
						101
					]
				}
			},
			"214": {
				"type": "content",
				"name": "5y",
				"data": {
					"content": "Te acercas al primer cofre. Ves que se trata de un sencillo estuche de madera, pero finamente trabajado. Al parecer, no está cerrado con llave. Abres la tapa con cautela, esperando que no haya una trampa oculta. Aparentemente no la hay, pues no ocurre nada cuando la le¬vantas del todo. Dentro... ¡Dentro hay un tesoro más allá de lo que nunca has podido imaginar!. Este cofre está lleno hasta el borde de monedas de oro; contiene una fortuna. Un rápido examen revela el mismo contenido en los otros seis cofres, «¡Debe de haber casi mil monedas solo en éste!» piensas asombrado. Cuando recoges una moneda para examinarla más minuciosamente, una extraña sensación comienza a invadirte. Esta moneda no se troqueló en Gondor. La acuñación es demasiado perfecta y en una de sus caras muestra la imagen de una mujer. Intentas descifrar la débil inscripción Tengwar... «Por la gracia de Eru, en el reinado de Su Majestad, Tár-Ancalimé, año 1100 de la Segunda Edad; Númenor.» ¡Este tesoro fue rescatado de Númenor, y probablemente traído por Elendil cuando cruzó el mar antes de que se hundieran aquellas tierras!\nSi deseas quedarte con una parte de este dinero, puedes coger hasta 20 monedas sin ir sobrecargado. Toma nota de lo que te lleves."
				}
			},
			"215": {
				"type": "variable_update",
				"name": "5z",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					227
				]
			},
			"216": {
				"type": "variable_update",
				"name": "60",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						3
					]
				},
				"ref": [
					100
				]
			},
			"218": {
				"type": "interaction",
				"name": "62",
				"data": {
					"actions": [
						"Sales de la Tesorería (S15)",
						"Observas los objetos que están sobre la plataforma"
					],
					"rect": [
						435,
						100
					]
				}
			},
			"220": {
				"type": "jump",
				"name": "64",
				"data": {
					"target": 211,
					"reason": "Observas los objetos que están sobre la plataforma",
					"rect": [
						429,
						95
					]
				},
				"ref": [
					211
				]
			},
			"221": {
				"type": "content",
				"name": "65",
				"data": {
					"content": "Orgulloso por tu hallazgo, vuelves a guardar IAS cajas de la manera más parecida posible a como las has encontrado, Anota la Pista C.\n•\tSI examinas los cofres de las bornacinas. pasa al 436\n•\tDe lo contrario, sigue adelante.\n"
				}
			},
			"222": {
				"type": "variable_update",
				"name": "66",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"223": {
				"type": "variable_update",
				"name": "67",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						5
					]
				},
				"ref": [
					100
				]
			},
			"225": {
				"type": "variable_update",
				"name": "69",
				"data": {
					"variable": 224,
					"operator": "set",
					"with": [
						0,
						true
					]
				},
				"ref": [
					224
				]
			},
			"226": {
				"type": "interaction",
				"name": "6a",
				"data": {
					"actions": [
						"Sales de la Tesorería (S15)",
						"Si examinas los cofres de las hornacinas"
					],
					"rect": [
						347,
						85
					]
				}
			},
			"227": {
				"type": "jump",
				"name": "6b",
				"data": {
					"target": 215,
					"reason": "Si examinas los cofres de las hornacinas",
					"rect": [
						342,
						87
					]
				},
				"ref": [
					215
				]
			},
			"228": {
				"type": "jump",
				"name": "6c",
				"data": {
					"target": 206,
					"reason": "Escalera S15",
					"rect": [
						133,
						88
					]
				},
				"ref": [
					206
				]
			},
			"230": {
				"type": "content",
				"name": "6e",
				"data": {
					"content": "Temes que Saruman llegue a ver el anillo (recordando además que no es de tu propiedad), por lo que vuelves a guardado cuidadosamente en su estuche. Además, dejas las otras cajas de la manera más parecida posible a como las has encontrado.\n\n"
				}
			},
			"231": {
				"type": "variable_update",
				"name": "6f",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"235": {
				"type": "interaction",
				"name": "6j",
				"data": {
					"actions": [
						"Estudio de Saruman W13 ",
						"S17",
						"Escalera S9"
					],
					"rect": [
						220,
						59
					]
				}
			},
			"236": {
				"type": "content",
				"name": "6k",
				"data": {
					"content": "¡Descubre sorprendido que la puerta no está cerrada con llave! No se oye ningún ruido en el interior del estudio Sigue adelante."
				}
			},
			"237": {
				"type": "jump",
				"name": "6l",
				"data": {
					"target": 170,
					"reason": "S17"
				},
				"ref": [
					170
				]
			},
			"238": {
				"type": "content",
				"name": "6m",
				"data": {
					"title": "Escalera S9",
					"content": "La gran cavidad interior de este pináculo comienza a estrecharse cuando llegas al tercer nivel; no obstante, los escalones tienen todavía una anchura considerable. Hay una puerta de arco ojival profundamente empotrada en la negra roca de la pared. Esta pesada puerta, con paneles finamente labrados en madera oscura de cerezo, conduce a la Biblioteca de la torre de Orthanc, donde se guarda una de las más completas colecciones de libros de toda la Tierra Media. \n"
				}
			},
			"239": {
				"type": "jump",
				"name": "6n",
				"data": {
					"target": 244,
					"reason": "Escalera S9",
					"rect": [
						117,
						100
					]
				},
				"ref": [
					244
				]
			},
			"242": {
				"type": "variable_update",
				"name": "6q",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"243": {
				"type": "jump",
				"name": "6r",
				"data": {
					"target": 178,
					"reason": "Estudio de Saruman W13 ",
					"rect": [
						203,
						55
					]
				},
				"ref": [
					178
				]
			},
			"244": {
				"type": "variable_update",
				"name": "6s",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					275,
					239,
					380
				]
			},
			"245": {
				"type": "interaction",
				"name": "6t",
				"data": {
					"actions": [
						"S13",
						"Escalera S5",
						"Biblioteca V12 "
					],
					"rect": [
						155,
						108
					]
				}
			},
			"247": {
				"type": "jump",
				"name": "6v",
				"data": {
					"target": 202,
					"reason": "S13"
				},
				"ref": [
					202
				]
			},
			"248": {
				"type": "content",
				"name": "6w",
				"data": {
					"title": "Escalera S5",
					"content": "Llegas al rellano del segundo nivel, donde unas grandes puertas dobles conducen al salón (U8). La escalera sigue ascendiendo en espiral hasta perderse de vista. "
				}
			},
			"249": {
				"type": "variable_update",
				"name": "6x",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					250
				]
			},
			"250": {
				"type": "jump",
				"name": "6y",
				"data": {
					"target": 249,
					"reason": "Escalera S5",
					"rect": [
						145,
						92
					]
				},
				"ref": [
					249
				]
			},
			"251": {
				"type": "content",
				"name": "6z",
				"data": {
					"title": "Biblioteca V12 ",
					"content": "Te sientes abrumado por el enorme tamaño de la Biblioteca. Siempre te sobrecoge esta inmensa cámara abovedada, de treinta metros de diámetro y casi veintitrés de alto en la clave. Cinco niveles de pasillos de hierro rodean su perímetro, unidos entre si por escaleras de caracol. Estas siete espirales de estrechos peldaños en forma de rejilla están distribuidas a intervalos regulares por la sala y alcanzan una altura máxima de dieciocho metros sobre la base de la cúpula, sostenida por un entramado de hierros retorcidos cuya complejidad y ornamentación hacen de esta sala una joya que debe apreciarse. "
				}
			},
			"252": {
				"type": "variable_update",
				"name": "70",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					341,
					253,
					421
				]
			},
			"253": {
				"type": "jump",
				"name": "71",
				"data": {
					"target": 252,
					"reason": "Biblioteca V12 ",
					"rect": [
						144,
						86
					]
				},
				"ref": [
					252
				]
			},
			"255": {
				"type": "content",
				"name": "73",
				"data": {
					"content": "No se trata solo de esta maravillosa estructura que rodea los inapreciables volúmenes y documentos guardados aquí, sino que toda la circunferencia de la gran estancia está cubierta de estanterías y bastidores de madera labrada, que contienen miles y miles de rollos de pergamino, manuscritos atados y libros. \n"
				}
			},
			"256": {
				"type": "content",
				"name": "74",
				"data": {
					"content": "Naturalmente, la mayoría son documentos SUELTOS y apilados en paquetes; algunos han sido encuadernados, escritos con la fluida caligrafía de Saruman. Buena parte del área superior de la pared está plagada de miríadas de casillas; en cada una de ellas se guarda un rollo de pergamino, numerado y etiquetado.\n\n \n\n"
				}
			},
			"257": {
				"type": "content",
				"name": "75",
				"data": {
					"content": "Al este, una puerta pequeña y estrecha de piedra negra rompe el patrón repetido de bastidores y estanterías. Al otro lado de aquella puerta hay un pasillo corto al final del cual se encuentra un balconcillo con barandilla de hierro, que se asoma justo encima de la puerta principal.\n\nLa enorme habitación está iluminada, básicamente, por siete ventanales que se levantan desde el suelo hasta la cúpula junto a cada una de las escaleras. Por la noche, el techo abovedado emite una iluminación cálida y amarillenta. Una vez preguntaste al mago sobre las características de aquel techo hechizado, pero él se limitó a menear la cabeza y decir: (Supongo que era algún truco de los númenóreanos; malgastaban sus conocimientos en banalidades como ésa). Sin embargo, nunca le has contado que este techo te resulta fascinante, y sueles venir a la Biblioteca sólo para contemplar cómo la luz natural se desvanece y la cúpula cobra vida.\n\n"
				}
			},
			"258": {
				"type": "content",
				"name": "76",
				"data": {
					"content": "El suelo de la sala está ocupado por numerosos escritorios de forma curvada, recuerdos de una época en que Orthanc era una ciudadela poblada no sólo por soldados de Gondor, sino también por místicos, historiadores y astrólogos.\n\nEn el centro, sobre una tarima, se hallan el escritorio del bibliotecario principal y el catálogo, que contiene las referencias de todos los manuscritos, libros y pergaminos de la habitación. Como sólo tú, los demás aprendices y Saruman usáis actualmente la Biblioteca, no es necesaria la figura del bibliotecario: el escritorio ha permanecido descuidado durante siglos. "
				}
			},
			"259": {
				"type": "generator",
				"name": "77",
				"data": {
					"variable": 80,
					"method": "randi",
					"arguments": [
						2,
						12,
						false,
						true,
						true
					],
					"rect": [
						131,
						106
					]
				},
				"ref": [
					80
				]
			},
			"260": {
				"type": "sequencer",
				"name": "78",
				"data": {
					"slots": 2
				}
			},
			"261": {
				"type": "condition",
				"name": "79",
				"data": {
					"variable": 80,
					"operator": "lse",
					"with": [
						0,
						5
					]
				},
				"ref": [
					80
				]
			},
			"262": {
				"type": "condition",
				"name": "7a",
				"data": {
					"variable": 80,
					"operator": "gte",
					"with": [
						0,
						6
					]
				},
				"ref": [
					80
				]
			},
			"263": {
				"type": "content",
				"name": "7b",
				"data": {
					"content": "Saruman está de pie en la galería el tercer nivel y parece estar buscando un libro."
				}
			},
			"264": {
				"type": "content",
				"name": "7c",
				"data": {
					"content": "La Biblioteca está vacía; sus altos pilares se elevan hacia el techo, sumido en la oscuridad. El silencio es tan profundo que resulta casi opresivo.\n"
				}
			},
			"266": {
				"type": "variable_update",
				"name": "7e",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"267": {
				"type": "interaction",
				"name": "7f",
				"data": {
					"actions": [
						"Saludas a Saruman",
						"Te quedas en la biblioteca, pero no le diriges palabra",
						"Te vas por otra escalera y no quieres que te vea",
						"Te marchas por donde has venido"
					],
					"rect": [
						481,
						78
					]
				}
			},
			"268": {
				"type": "content",
				"name": "7g",
				"data": {
					"content": "En respuesta a tu llamada, el mago se revuelve agitando sus blancos ropajes. Los abundantes pliegues reflejan la luz de los fanales en unos resplandecientes arcos iris. Un efecto luminoso, sin duda. Saruman se inclina sobre la barandilla y te saluda con un movimiento de cabeza.\n- ¡Buenos días, mi joven amigo! ---dice, y sigue buscando."
				}
			},
			"270": {
				"type": "content",
				"name": "7i",
				"data": {
					"content": "Acudes al catálogo, tres libros enormes que enumeran el contenido de la Biblioteca. Teniendo en cuenta tu situación, podrías consultar los siguientes temas: los Anillos del Poder o tal vez los palantiri, o mapas de Rohan y de Nan Curunir (el Valle del Mago) el área exterior de Isengard). Mientras estás pensando que tema vas a consultar, oyes sobre ti una voz suave, pero asombrosamente penetrante.\n\n—¡Ah, mi joven amigo! Sin duda, has venido a trabajar en tus estudios.\nLevantas la mirada, aparentando estar confundido. El Mago Blanco se halla encima de ti, inclinado sobre la retorcida barandilla de hierro de la galería y sujetándose con sus largas manos.\n—¡Oh! ¡Maestro! ¡No sabia que estabais ahí arriba! —Es una mentira tonta, y te reprochas el haberla dicho. Seguramente, Saruman adi¬vinará la verdad—. Sólo estaba haciendo algunas investigaciones.\nEl viejo mago te sonríe y dice:\n—¡Bien, bien! Me alegra oír que estás trabajando en algo. Vuelve a su lectura y te ignora durante el resto de tu estancia en la Biblioteca."
				}
			},
			"275": {
				"type": "jump",
				"name": "7n",
				"data": {
					"target": 244,
					"reason": "S9"
				},
				"ref": [
					244
				]
			},
			"277": {
				"type": "variable_update",
				"name": "7p",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"278": {
				"type": "interaction",
				"name": "7q",
				"data": {
					"actions": [
						"Sales (por cualquier puerta)",
						"Buscas un libro",
						"Buscas algo inusual en la Biblioteca"
					],
					"rect": [
						329,
						100
					]
				},
				"use": [
					320
				]
			},
			"281": {
				"type": "content",
				"name": "7t",
				"data": {
					"content": "Una búsqueda exhaustiva en las paredes, suelo y techo de la estancia no da ningún resultado positivo. Aparentemente, la Biblioteca no contiene ningún secreto. "
				}
			},
			"282": {
				"type": "marker",
				"name": "7u",
				"data": {
					"label": "125",
					"color": "1a4cd2ff"
				}
			},
			"283": {
				"type": "interaction",
				"name": "7v",
				"data": {
					"actions": [
						"S9",
						"S10",
						"Escalera S11",
						"Escalera S12"
					]
				},
				"use": [
					310,
					334
				]
			},
			"285": {
				"type": "jump",
				"name": "7x",
				"data": {
					"target": 189,
					"reason": "S10"
				},
				"ref": [
					189
				]
			},
			"286": {
				"type": "content",
				"name": "7y",
				"data": {
					"title": "S11",
					"content": "En este rellano del tercer nivel encuentras la entrada a la Bibliote¬ca de Orthanc, uno de los lugares al este del mar que cuenta con un mayor cúmulo de saber. La puerta de la Biblioteca es alta y estrecha, empotrada en un hueco sombrío, abierto en la curvada pared inte¬rior de la torre. Esta pesada puerta, con paneles finamente labrados en madera oscura de cerezo, conduce a la Biblioteca de Orthanc, don¬de se guarda una de las más completas colecciones de libros de toda la Tierra Media. Desde aquí puedes subir (a S15), bajar (a S7) o entrar en la Biblioteca (V12). Sigue adelante.\n"
				}
			},
			"287": {
				"type": "variable_update",
				"name": "7z",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					288,
					429
				]
			},
			"288": {
				"type": "jump",
				"name": "80",
				"data": {
					"target": 287,
					"reason": "Escalera S11",
					"rect": [
						125,
						105
					]
				},
				"ref": [
					287
				]
			},
			"289": {
				"type": "marker",
				"name": "81",
				"data": {
					"label": "s11",
					"color": "1a4cd2ff"
				}
			},
			"290": {
				"type": "content",
				"name": "82",
				"data": {
					"title": "Escalera S12",
					"content": "Hay una gran puerta de arco ojival empotrada en la negra roca de la pared. Esta pesada puerta, con paneles finamente labrados en ma¬dera oscura de cereza conduce a la Biblioteca de Orthanc, donde se guarda una de las más completas colecciones de libros de toda la Tierra Media. \n"
				}
			},
			"291": {
				"type": "jump",
				"name": "83",
				"data": {
					"target": 292,
					"reason": "S12"
				},
				"ref": [
					292
				]
			},
			"292": {
				"type": "variable_update",
				"name": "84",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					291,
					414
				]
			},
			"294": {
				"type": "content",
				"name": "86",
				"data": {
					"content": "Consultas el catálogo: lo forman tres enormes volúmenes escritos a mano, que contienen la lista de todos los escritos de la Biblioteca. Teniendo en cuenta tu situación, podrías averiguar algo más sobre los siguientes temas: Los Anillos del Poder, los palantiri, o los mapas de Rohan y de Nan Curunir (el Valle del Mago o área exterior de Isengard)."
				}
			},
			"295": {
				"type": "variable_update",
				"name": "87",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						155,
						90
					]
				},
				"ref": [
					78
				]
			},
			"296": {
				"type": "interaction",
				"name": "88",
				"data": {
					"actions": [
						"Anillos del Poder",
						"Palantiri",
						"Mapas del Valle del Mago y de Rohan"
					],
					"rect": [
						307,
						104
					]
				}
			},
			"297": {
				"type": "content",
				"name": "89",
				"data": {
					"content": "Tu búsqueda te lleva por toda la Biblioteca, en parte porque parece que faltan varios de los volúmenes que buscas. Piensas que podrían estar guardados en el estudio de Saruman. Sin embargo, si encuentras cierta Información del muy conocido Poema de los Ani¬llos (el que habla de los Nueve Anillos hechos para los Hombres Mortales, los Siete para los Señores Enanos, los Tres para los Reyes Elfos y el Anillo Único que debía gobernarlos a todos).\n\nAl parecer, se produjo una notable confusión después de la Guerra de la Última Alianza, la batalla que puso fin a la Segunda Edad, hace tres mil años. En aquella gran guerra, los elfos y los hombres unieron sus fuerzas y derrocaron a Sauron, penetrando en Mordor y tomando por asalto la invencible fortaleza de Barad-dúr. En la bata¬lla final, Isildur, el rey mortal de Gondor, arrancó el Anillo Único del dedo de Sauron, aniquilando el poder del Señor Oscuro y con¬denándolo a no tener forma.\nPero, ¿qué se hizo del Anillo? Poco después, Isildur fue muerto por los orcos en una emboscada junto al rio Anduin. ¿Se perdió el Anillo en el río, o fue recuperado? Por supuesto, los libros no lo dicen. Se¬guramente, si hubiera sido encontrado, su portador ya lo habría anun¬ciado. Los registros indican que ese Anillo era terriblemente poderoso; su portador no podría permanecer escondido por mucho tiempo.\n\nSentado en la silenciosa Biblioteca, mientras reflexionas sobre el destino del Anillo Único, las piezas comienzan a encajar en tu men¬te: hace muchos años que Saruman está fascinado por esos Anillos y los estudios sobre ellos, y has captado fragmentos de sus conversa-ciones con algunos de sus agentes. El valle del río Anduin era mencionado con frecuencia..., así como el nombre de Isildur. Durante un largo momento, tienes la impresión de que se te ha parado el co¬razón. ¡Saruman está buscando el Anillo Único para quedárselo! Pero como fue forjado por Sauron, ¿no será pues maligno? Tal vez Saru¬man sea lo bastante poderoso y sabio como para usarlo para hacer el bien. No obstante, por muy fuerte que sea Saruman, ¿podría im¬ponerse al odio eterno de Sauron, el Mala caído? ¿Cómo podría con¬fiar Saruman en derrotar esa maldición? Luego, una idea más horrenda cruza por tu cabeza: ¿Acaso desea eso efectivamente? Estás más de¬cidido que nunca a encontrar la verdad.\n\n-Si buscas información sobre  (Los palantiri), pasa al 323.\n-Si buscas mapas del Valle del Mago y de Rohan, pasa al 166.\n-De lo contrarío, sigue adelante. \n"
				}
			},
			"300": {
				"type": "content",
				"name": "8c",
				"data": {
					"content": "Al principio crees que no vas a encontrar ninguna información útil sobre las (piedras que ven), hasta que, por casualidad, reparas en varios volúmenes y rollos de pergamino apilados en una mesa lateral: ¡son los manuscritos que estabas buscando! Al parecer, Saruman también los está utilizando. «No es un indicio muy bueno», piensas con tristeza.\n\nEl creador de los palantiri fue Féanor, el mejor herrero de su tiempo (también hizo los Silmarils). En un principio, se usaron en las Tie-rras Inmortales, pero fueron ofrecidos posteriormente a los Hombres Mortales en gratitud por su ayuda en las guerras contra Morgoth, durante la oscuridad de la Primera Edad. Después de mucho tiempo, vinieron finalmente a descansar en la Tierra Media. Algunos se han perdido, se dice que dos de las piedras de Arnor se encuentran en el fondo de la gran bahía de hielo, otra se halla en los Puertos Grises, aunque sus poderes de visión están limitados a las distantes Tierras Inmortales. En Gondor, el palantir de Minas Inthil está ahora en poder de Sauron, junto con la propia ciudad. Una vez hubo una «piedra que ve» en Osgiliath, la antigua capital de Gondor, pero cayó al Anduin cuando la ciudad fue arrasada.\n\nSólo Minas Tirith y Orthanc albergan los restantes palantiri libres. Pueden ver lejos, y cualquier lugar Iluminado, pero existe un vínculo entre ellos y se atraen de forma natural. También se requiere una gran fuerza de voluntad para mandar sobre una Piedra; de lo contrario, sólo revela imágenes cambiantes y borrosas.\n\nAprendes todos estos datos, y además Iees muchas páginas de instrucciones específicas para su uso. Mientras reflexionas sobre esta información, diversas ideas acuden a tu mente. ¿Podría el Señor Oscuro haber tomado posesión de la Piedra de Ithil? En tal caso, ¡podría utilizarla para observar cualquier sitio! Reprimes el pánico al pensar que Sauron podría estar espiándote en estos momentos. «Si mi Maestro ha usado la Piedra de Orthanc, pudo haber entrado en contacto con Sauron...» La idea de ambos hechiceros enzarzados en un combate mental te hace estremecer. Ya has leído bastante sobre esto; cierras el libro y te pones en pie."
				}
			},
			"301": {
				"type": "content",
				"name": "8d",
				"data": {
					"content": "Tras una búsqueda de escasos minutos, encuentras los mapas. Los enrollas y los guardas con cuidado en un pequeño canuto de cuero. Anota la Pista D."
				}
			},
			"303": {
				"type": "variable_update",
				"name": "8f",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						30
					],
					"rect": [
						155,
						90
					]
				},
				"ref": [
					78
				]
			},
			"304": {
				"type": "interaction",
				"name": "8g",
				"data": {
					"actions": [
						"Sales (por cualquier puerta)",
						"Buscas un libro"
					],
					"rect": [
						329,
						100
					]
				}
			},
			"305": {
				"type": "variable_update",
				"name": "8h",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						120
					],
					"rect": [
						147,
						54
					]
				},
				"ref": [
					78
				],
				"use": [
					314
				]
			},
			"306": {
				"type": "variable_update",
				"name": "8i",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						3
					],
					"rect": [
						110,
						72
					]
				},
				"ref": [
					100
				]
			},
			"309": {
				"type": "interaction",
				"name": "8l",
				"data": {
					"actions": [
						"Palantiri",
						"Mapas del Valle del Mago y de Rohan",
						"Sales (Por cualquier Puerta)"
					],
					"rect": [
						307,
						104
					]
				}
			},
			"310": {
				"type": "jump",
				"name": "8m",
				"data": {
					"target": 283,
					"reason": "Sales por cualquier puerta",
					"rect": [
						233,
						91
					]
				},
				"ref": [
					283
				]
			},
			"311": {
				"type": "variable_update",
				"name": "8n",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						20
					],
					"rect": [
						147,
						54
					]
				},
				"ref": [
					78
				]
			},
			"312": {
				"type": "variable_update",
				"name": "8o",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						3
					],
					"rect": [
						110,
						72
					]
				},
				"ref": [
					100
				]
			},
			"313": {
				"type": "interaction",
				"name": "8p",
				"data": {
					"actions": [
						"Mapas del Valle del Mago y de Rohan",
						"Sales (Por cualquier Puerta)",
						"Anillos de Poder"
					],
					"rect": [
						307,
						104
					]
				}
			},
			"314": {
				"type": "jump",
				"name": "8q",
				"data": {
					"target": 305,
					"reason": "Anillos de Poder",
					"rect": [
						154,
						56
					]
				},
				"ref": [
					305
				]
			},
			"315": {
				"type": "variable_update",
				"name": "8r",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						147,
						54
					]
				},
				"ref": [
					78
				]
			},
			"317": {
				"type": "variable_update",
				"name": "8t",
				"data": {
					"variable": 316,
					"operator": "set",
					"with": [
						0,
						true
					]
				},
				"ref": [
					316
				]
			},
			"318": {
				"type": "interaction",
				"name": "8u",
				"data": {
					"actions": [
						"Sales (Por cualquier Puerta)",
						"Anillos de Poder",
						"Palantiri"
					],
					"rect": [
						307,
						104
					]
				}
			},
			"319": {
				"type": "variable_update",
				"name": "8v",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"320": {
				"type": "jump",
				"name": "8w",
				"data": {
					"target": 278,
					"reason": ""
				},
				"ref": [
					278
				]
			},
			"321": {
				"type": "variable_update",
				"name": "8x",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"323": {
				"type": "condition",
				"name": "8z",
				"data": {
					"variable": 80,
					"operator": "lse",
					"with": [
						0,
						6
					]
				},
				"ref": [
					80
				]
			},
			"324": {
				"type": "generator",
				"name": "90",
				"data": {
					"variable": 80,
					"method": "randi",
					"arguments": [
						2,
						12,
						false,
						true,
						true
					],
					"rect": [
						131,
						106
					]
				},
				"ref": [
					80
				]
			},
			"325": {
				"type": "sequencer",
				"name": "91",
				"data": {
					"slots": 2
				}
			},
			"326": {
				"type": "condition",
				"name": "92",
				"data": {
					"variable": 80,
					"operator": "gte",
					"with": [
						0,
						7
					]
				},
				"ref": [
					80
				]
			},
			"327": {
				"type": "content",
				"name": "93",
				"data": {
					"content": "Con aplomo, tratas de cruzar la Biblioteca sin ser visto. No obstante cuando ya has recorrido dos tercios del camino, oyes una voz suave pero asombrosamente penetrante, que procede de arriba.\n\n-¡Ah, mi joven amigo! Has venido a trabajar en tus estudios...\nLevantas la mirada, aparentando estar confundido. El rostro del Mago Blanco parece suspendido sobre ti, y su barba nevada pende sobre la barandilla de la galería.\n—¡Oh! ¡Saruman! ¡No sabia que estabais ahí! Sólo... eh... pasaba por aquí, Maestro.\nEl viejo mago frunce el entrecejo por unos instantes.\n—Muy bien —dice luego, y desaparece\n"
				}
			},
			"330": {
				"type": "content",
				"name": "96",
				"data": {
					"content": "Cruzas la Biblioteca a hurtadillas, procurando ocultarte siempre que puedes. Por fin, llegas a la otra puerta sin que, al parecer, hayas sido descubierto. Sigue adelante."
				}
			},
			"332": {
				"type": "variable_update",
				"name": "98",
				"data": {
					"variable": 80,
					"operator": "add",
					"with": [
						1,
						331
					]
				},
				"ref": [
					80,
					331
				]
			},
			"333": {
				"type": "variable_update",
				"name": "99",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"334": {
				"type": "jump",
				"name": "9a",
				"data": {
					"target": 283,
					"reason": "Sales por cualquier puerta",
					"rect": [
						233,
						91
					]
				},
				"ref": [
					283
				]
			},
			"335": {
				"type": "variable_update",
				"name": "9b",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"336": {
				"type": "variable_update",
				"name": "9c",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						1
					]
				},
				"ref": [
					100
				]
			},
			"337": {
				"type": "content",
				"name": "9d",
				"data": {
					"title": "Escalera S6",
					"content": "En este rellano del segundo nivel encuentras una puerta alta de pulida madera de roble. Está cerrada. Por lo que sabes, hace años que no hay visitantes hospedados en Orthanc. "
				}
			},
			"339": {
				"type": "variable_update",
				"name": "9f",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					349,
					355,
					340
				]
			},
			"340": {
				"type": "jump",
				"name": "9g",
				"data": {
					"target": 339,
					"reason": "S6"
				},
				"ref": [
					339
				]
			},
			"341": {
				"type": "jump",
				"name": "9h",
				"data": {
					"target": 252,
					"reason": "Biblioteca V12 ",
					"rect": [
						142,
						84
					]
				},
				"ref": [
					252
				]
			},
			"342": {
				"type": "interaction",
				"name": "9i",
				"data": {
					"actions": [
						"S10",
						"Escalera S2",
						"Dormitorio de Invitados U9"
					],
					"rect": [
						234,
						123
					]
				}
			},
			"343": {
				"type": "jump",
				"name": "9j",
				"data": {
					"target": 189,
					"reason": "S10"
				},
				"ref": [
					189
				]
			},
			"344": {
				"type": "content",
				"name": "9k",
				"data": {
					"title": "Escalera S2",
					"content": "Este hueco de escalera, una de las cuatro que ascienden retorciéndose por la parte central de los impresionantes pilares de piedra negra de Orthanc, muestra la amplia base de la escalinata que empieza aquí. Los peldaños son anchos y lisos, y la escalera, una masa de piedra maciza que sube en espiral hasta que se pierde en la oscuridad. Del muro exterior penden unos largos estandartes, cuyos colores se han apagado con los años. Ni ellos ni los fanales colocados a intervalos iguales en la pared tienen mucho éxito en combatir la sobrecogedora negrura de la estancia. \n"
				},
				"use": [
					346
				]
			},
			"345": {
				"type": "variable_update",
				"name": "9l",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"346": {
				"type": "jump",
				"name": "9m",
				"data": {
					"target": 344,
					"reason": "Escalera S2",
					"rect": [
						116,
						85
					]
				},
				"ref": [
					344
				]
			},
			"348": {
				"type": "interaction",
				"name": "9o",
				"data": {
					"actions": [
						"Escalera S6",
						"Sala de Entrada T4"
					],
					"rect": [
						177,
						108
					]
				}
			},
			"349": {
				"type": "jump",
				"name": "9p",
				"data": {
					"target": 339,
					"reason": "Escalera S6",
					"rect": [
						114,
						80
					]
				},
				"ref": [
					339
				]
			},
			"350": {
				"type": "marker",
				"name": "9q",
				"data": {
					"label": "t4",
					"color": "1a4cd2ff"
				}
			},
			"351": {
				"type": "content",
				"name": "9r",
				"data": {
					"title": "Dormitorio de invitados U9",
					"content": "El dormitorio de invitados está dominado por una enorme cama coronada por un dosel y con unas gruesas colgaduras de terciopelo que están descorridas y atadas a las cuatro columnas del lecho. Junto a una de las dos ventanas altas hay un sofá y varias sillas; también hay un biombo para cambiarse. Los paneles de madera oscura o los tapices que cubren las paredes hacen que la habitación resulte cálida y acogedora, pese a que el hogar, espacioso y de color negro, está apagado."
				}
			},
			"352": {
				"type": "variable_update",
				"name": "9s",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					353
				]
			},
			"353": {
				"type": "jump",
				"name": "9t",
				"data": {
					"target": 352,
					"reason": "Dormitorio de invitados U9",
					"rect": [
						229,
						93
					]
				},
				"ref": [
					352
				]
			},
			"354": {
				"type": "interaction",
				"name": "9u",
				"data": {
					"actions": [
						"Escalera S6",
						"Escudriñas el dormitorio de invitados"
					],
					"rect": [
						323,
						87
					]
				}
			},
			"355": {
				"type": "jump",
				"name": "9v",
				"data": {
					"target": 339,
					"reason": "Escalera S6",
					"rect": [
						112,
						89
					]
				},
				"ref": [
					339
				]
			},
			"356": {
				"type": "condition",
				"name": "9w",
				"data": {
					"variable": 80,
					"operator": "lse",
					"with": [
						0,
						10
					]
				},
				"ref": [
					80
				]
			},
			"357": {
				"type": "generator",
				"name": "9x",
				"data": {
					"variable": 80,
					"method": "randi",
					"arguments": [
						2,
						12,
						false,
						true,
						true
					],
					"rect": [
						131,
						106
					]
				},
				"ref": [
					80
				]
			},
			"358": {
				"type": "sequencer",
				"name": "9y",
				"data": {
					"slots": 2
				}
			},
			"359": {
				"type": "condition",
				"name": "9z",
				"data": {
					"variable": 80,
					"operator": "gte",
					"with": [
						0,
						11
					]
				},
				"ref": [
					80
				]
			},
			"360": {
				"type": "content",
				"name": "a0",
				"data": {
					"content": "Buscas brevemente por los cajones, bajo la cama y detrás de los tapices, pero sin ningún resultado. No encuentras nada de interés aquí. "
				}
			},
			"361": {
				"type": "content",
				"name": "a1",
				"data": {
					"content": "Tras varios minutos investigando en el dormitorio de invitados, oyes un ruido en la puerta. Te vuelves y ves a una de las muchachas de servicio en el umbral de la puerta. Te preguntas qué estará haciendo aquí; pero, lo que es más importante, ¡debes impedir que cuente a Saruman que te ha visto merodeando por aquí!\n\n\n"
				}
			},
			"362": {
				"type": "variable_update",
				"name": "a2",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"363": {
				"type": "variable_update",
				"name": "a3",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"364": {
				"type": "interaction",
				"name": "a4",
				"data": {
					"actions": [
						"Pasas de largo junto a ella y sales",
						"Le adviertes que no se lo cuente a Saruman"
					],
					"rect": [
						361,
						100
					]
				}
			},
			"365": {
				"type": "content",
				"name": "a5",
				"data": {
					"content": "Confundida, se aparta de ti cuando pasas junto a ella. ¿Vas a permanecer en silencio? Sigue adelante.\n"
				}
			},
			"366": {
				"type": "content",
				"name": "a6",
				"data": {
					"content": "Lanzas tu mirada más autoritaria a la muchacha y le dices:\n—¡Si yo estuviera en tu lugar, no molestaría a Saruman para decirle que me has visto aquí!\nElla te mira con ojos inexpresivos durante largo rato antes de contestar:\n—No, claro que no. Lo que hagan ustedes, los aprendices, no es asunto mío.\nLuego, la joven sonríe alegremente y comienza a guardar la ropa limpia en la habitación. \n"
				}
			},
			"369": {
				"type": "content",
				"name": "a9",
				"data": {
					"title": "Sala de entrada T4",
					"content": "La hermosa sala de entrada tiene un techo abovedado, cubierto de pandes labrados de fina madera de roble. El suelo es de mármol negro pulido, y hay muchos objetos y obras de arte colocados en unas hornacinas por todo el perímetro. El ruido de tus pasos resuena en la amplia habitación. Desde aquí puedes pasar a cualquiera de las escaleras del primer nivel (S1, S2, S3, S4); entrar en la cocina (T7), en la sala de estar (T5), o en la despensa (T6); o disponerte a salir de Orthanc (T2). Sigue adelante.\n",
					"rect": [
						169,
						69
					]
				}
			},
			"370": {
				"type": "variable_update",
				"name": "aa",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						134,
						29
					]
				},
				"ref": [
					78
				],
				"use": [
					371
				]
			},
			"371": {
				"type": "jump",
				"name": "ab",
				"data": {
					"target": 370,
					"reason": "Sala de Entrada T4",
					"rect": [
						187,
						28
					]
				},
				"ref": [
					370
				]
			},
			"372": {
				"type": "marker",
				"name": "ac",
				"data": {
					"label": "t4",
					"color": "1a4cd2ff"
				}
			},
			"373": {
				"type": "marker",
				"name": "ad",
				"data": {
					"label": "t4",
					"color": "1a4cd2ff"
				}
			},
			"374": {
				"type": "content",
				"name": "ae",
				"data": {
					"content": "Entras en el salón, una estancia muy poco frecuentada. Unas estrechas ventanas, enmarcadas por unas pesadas cortinas de terciopelo azul descolorido, dan al oeste y al norte respectivamente. Los fanales de cristal colocados por los constructores dunedain iluminan las paredes, recubiertas de paneles de madera de roble. Los ornamentados muebles comienzan a mostrar signos de envejecimiento. Tira dos dados:\n\n- Si el total está entre 2 y 4, pasa al 380.\n- Si está entre 5 y 12, pasa al 392.\n",
					"title": "Salón U8"
				}
			},
			"375": {
				"type": "variable_update",
				"name": "af",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					379,
					400,
					401
				]
			},
			"377": {
				"type": "marker",
				"name": "ah",
				"data": {
					"label": "u8",
					"color": "1a4cd2ff"
				}
			},
			"378": {
				"type": "interaction",
				"name": "ai",
				"data": {
					"actions": [
						"Salón U8",
						"Escalera S9",
						"Escalera S1",
						"Comedor U11"
					]
				}
			},
			"379": {
				"type": "jump",
				"name": "aj",
				"data": {
					"target": 375,
					"reason": "Salón U8",
					"rect": [
						91,
						68
					]
				},
				"ref": [
					375
				]
			},
			"380": {
				"type": "jump",
				"name": "ak",
				"data": {
					"target": 244,
					"reason": "Escalera S9",
					"rect": [
						117,
						100
					]
				},
				"ref": [
					244
				]
			},
			"381": {
				"type": "content",
				"name": "al",
				"data": {
					"title": "Escalera S1",
					"content": "En este rellano del primer nivel, una de las cuatro enormes escaleras de caracol de Orthanc se alza sobre ti. La espiral de piedra maciza llena la estancia de tal modo que sólo es visible el primer giro. Te detienes y crees poder oír el eco de pasos lejanos. Sin embargo, sólo el silencio llega a tus oídos, que se esfuerzan en vano. El recuerdo de señores y místicos muertos hace mucho tiempo ronda por la antigua torre. Desde aquí puedes subir por la escalera (a S5) o pasar a la sala de entrada (T4) Sigue adelante.\n"
				}
			},
			"382": {
				"type": "variable_update",
				"name": "am",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					384
				]
			},
			"383": {
				"type": "marker",
				"name": "an",
				"data": {
					"label": "s1",
					"color": "1a4cd2ff"
				}
			},
			"384": {
				"type": "jump",
				"name": "ao",
				"data": {
					"target": 382,
					"reason": "Escalera S1",
					"rect": [
						117,
						100
					]
				},
				"ref": [
					382
				]
			},
			"385": {
				"type": "content",
				"name": "ap",
				"data": {
					"content": "Al otro lado de las puertas se llalla el elegante comedor, que casi no se usa ya. Esta estancia contiene numerosas antigüedades, incluida una mesa ovalada, labrada de forma muy elaborada, y sillas de respaldo alto. También hay dos vitrinas grandes, llenas de antiguos y extraños objetos que el viejo mago ha coleccionado en sus viajes. Un candelabro de cristal con cien velas pende del techo y dos pares de ventanas altas y estrechas se abren al sur y al oeste. Como siempre, la habitación está vacía y sumida en el silencio.",
					"title": "Comedor U11"
				}
			},
			"386": {
				"type": "variable_update",
				"name": "aq",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					388,
					412
				]
			},
			"388": {
				"type": "jump",
				"name": "as",
				"data": {
					"target": 386,
					"reason": "Comedor U11",
					"rect": [
						117,
						100
					]
				},
				"ref": [
					386
				]
			},
			"389": {
				"type": "interaction",
				"name": "at",
				"data": {
					"actions": [
						"Sigues escudriñando el comedor",
						"Salón U8",
						"Escalera S8"
					],
					"rect": [
						271,
						88
					]
				}
			},
			"391": {
				"type": "generator",
				"name": "av",
				"data": {
					"variable": 80,
					"method": "randi",
					"arguments": [
						2,
						12,
						false,
						true,
						true
					],
					"rect": [
						131,
						106
					]
				},
				"ref": [
					80
				]
			},
			"392": {
				"type": "condition",
				"name": "aw",
				"data": {
					"variable": 80,
					"operator": "lse",
					"with": [
						0,
						10
					]
				},
				"ref": [
					80
				]
			},
			"393": {
				"type": "sequencer",
				"name": "ax",
				"data": {
					"slots": 2
				}
			},
			"394": {
				"type": "condition",
				"name": "ay",
				"data": {
					"variable": 80,
					"operator": "gte",
					"with": [
						0,
						11
					]
				},
				"ref": [
					80
				]
			},
			"395": {
				"type": "content",
				"name": "az",
				"data": {
					"content": "El comedor es como una galería. Los grandes aparadores, antes uti¬lizados para guardar los cubiertos y las vajillas, están llenos ahora de objetos de piedra y de metal: símbolos y joyas que el mago ha reco¬gido por toda la Tierra Media. Algunos son muy hermosos, hechos de oro y otros materiales preciosos, mientras que otros son extraños y bárbaros.\nReprimes el impulso de examinar la colección de reliquias de Saruman y limitas tu búsqueda a la habitación en sí. No obstante, tras escudriñar cuidadosamente las paredes y el suelo, no hallas nada de particular interés. \n"
				}
			},
			"396": {
				"type": "content",
				"name": "b0",
				"data": {
					"content": "Estás registrando los cajones de cubertería cuando oyes pasos en las escaleras. Tu única opción (aparte de ser atrapado revolviendo la vajilla) es entrar corriendo en el salón.\n"
				}
			},
			"397": {
				"type": "variable_update",
				"name": "b1",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						15
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"399": {
				"type": "interaction",
				"name": "b3",
				"data": {
					"actions": [
						"Salón U8",
						"Escalera S8"
					]
				}
			},
			"400": {
				"type": "jump",
				"name": "b4",
				"data": {
					"target": 375,
					"reason": "Salón U8"
				},
				"ref": [
					375
				]
			},
			"401": {
				"type": "jump",
				"name": "b5",
				"data": {
					"target": 375,
					"reason": "Salón U8"
				},
				"ref": [
					375
				]
			},
			"402": {
				"type": "content",
				"name": "b6",
				"data": {
					"title": "Escalera S8",
					"content": "Te hallas en el rellano del segundo nivel de esta escalera, un enorme que resuena el eco. Tienes ante ti unas grandes puertas corredizas de madera; conducen al comedor. "
				}
			},
			"403": {
				"type": "variable_update",
				"name": "b7",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					405,
					406,
					426
				]
			},
			"405": {
				"type": "jump",
				"name": "b9",
				"data": {
					"target": 403,
					"reason": "Escalera S8",
					"rect": [
						121,
						84
					]
				},
				"ref": [
					403
				]
			},
			"406": {
				"type": "jump",
				"name": "ba",
				"data": {
					"target": 403,
					"reason": "Escalera S8",
					"rect": [
						110,
						88
					]
				},
				"ref": [
					403
				]
			},
			"407": {
				"type": "variable_update",
				"name": "bb",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"409": {
				"type": "variable_update",
				"name": "bd",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"410": {
				"type": "variable_update",
				"name": "be",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						1
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					100
				]
			},
			"411": {
				"type": "interaction",
				"name": "bf",
				"data": {
					"actions": [
						"Escalera S12",
						"Escalera S4",
						"Comedor U11"
					]
				}
			},
			"412": {
				"type": "jump",
				"name": "bg",
				"data": {
					"target": 386,
					"reason": "Comedor U11",
					"rect": [
						117,
						100
					]
				},
				"ref": [
					386
				]
			},
			"414": {
				"type": "jump",
				"name": "bi",
				"data": {
					"target": 292,
					"reason": "Escalera S12",
					"rect": [
						130,
						92
					]
				},
				"ref": [
					292
				]
			},
			"415": {
				"type": "content",
				"name": "bj",
				"data": {
					"title": "Escalera S4",
					"content": "Una de las cuatro escaleras de piedra asciende en espiral por el interior de los estilizados pilares de Orthanc. Los escalones y las pare¬des fueron construidos con el mismo tipo de piedra, pulida como el vidrio, de un color negro brillante y aparentemente indestructi¬ble. Pequeños fanales de plata y cristal cuelgan de las paredes a inter¬valos regulares, proyectando una luz tenue y parpadeante sobre la brillante superficie de las piedras. La mole de la escalera de caracol se halla ante ti; puedes subir (a S8) o pasar a la sala de entrada (T4). Sigue adelante.\n"
				}
			},
			"416": {
				"type": "variable_update",
				"name": "bk",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					418
				]
			},
			"417": {
				"type": "marker",
				"name": "bl",
				"data": {
					"label": "s4",
					"color": "1a4cd2ff"
				}
			},
			"418": {
				"type": "jump",
				"name": "bm",
				"data": {
					"target": 416,
					"reason": "Escalera S4",
					"rect": [
						117,
						100
					]
				},
				"ref": [
					416
				]
			},
			"419": {
				"type": "marker",
				"name": "bn",
				"data": {
					"label": "s4",
					"color": "1a4cd2ff"
				}
			},
			"420": {
				"type": "interaction",
				"name": "bo",
				"data": {
					"actions": [
						"Biblioteca V12 ",
						"Escalera S16",
						"Escalera S8"
					],
					"rect": [
						149,
						122
					]
				}
			},
			"421": {
				"type": "jump",
				"name": "bp",
				"data": {
					"target": 252,
					"reason": "Biblioteca V12 ",
					"rect": [
						146,
						62
					]
				},
				"ref": [
					252
				]
			},
			"422": {
				"type": "content",
				"name": "bq",
				"data": {
					"title": "Escalera S16",
					"content": "S16\tTiempo: 5\nAquí acaba una escalera. En este rellano hay dos ventanas orientadas al sur y al oeste sobre la llanura de Isengard. La vista es gris y sombría; el valle parece sumido en una oscuridad perpetua. También ves una puerta de madera gris pulida enmarcada en plata; conduce al dormitorio de Saruman. Mientras meditas las diferentes alternativas, una ráfaga repentina de aire frío sube por el hueco de la escalera, produciéndote escalofríos.\n•\tSi intentas entrar en el dormitorio de Saruman (W16), pasa al 479.\n•\tDe lo contrario sigue adelante bajando (a S12)."
				}
			},
			"423": {
				"type": "variable_update",
				"name": "br",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				],
				"use": [
					425
				]
			},
			"424": {
				"type": "marker",
				"name": "bs",
				"data": {
					"label": "s16",
					"color": "1a4cd2ff"
				}
			},
			"425": {
				"type": "jump",
				"name": "bt",
				"data": {
					"target": 423,
					"reason": "Escalera S16",
					"rect": [
						144,
						86
					]
				},
				"ref": [
					423
				]
			},
			"426": {
				"type": "jump",
				"name": "bu",
				"data": {
					"target": 403,
					"reason": "Escalera S8",
					"rect": [
						144,
						86
					]
				},
				"ref": [
					403
				]
			},
			"427": {
				"type": "interaction",
				"name": "bv",
				"data": {
					"actions": [
						"Escalera S11",
						"Tesoreria W15"
					],
					"rect": [
						136,
						111
					]
				}
			},
			"428": {
				"type": "content",
				"name": "bw",
				"data": {
					"content": "Examinas cuidadosamente el ojo de la cerradura, bajo el gran pomo de cristal negro de múltiples facetas. Seguramente servirá una de éstas, piensas mientras vas probando las numerosas llaves de intrincado diseño que llevas sujetas en una cadena."
				}
			},
			"429": {
				"type": "jump",
				"name": "bx",
				"data": {
					"target": 287,
					"reason": "Escalera S11",
					"rect": [
						128,
						91
					]
				},
				"ref": [
					287
				]
			},
			"430": {
				"type": "variable_update",
				"name": "by",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"431": {
				"type": "condition",
				"name": "bz",
				"data": {
					"variable": 80,
					"operator": "gte",
					"with": [
						0,
						8
					]
				},
				"ref": [
					80
				]
			},
			"432": {
				"type": "condition",
				"name": "c0",
				"data": {
					"variable": 80,
					"operator": "lse",
					"with": [
						0,
						7
					]
				},
				"ref": [
					80
				]
			},
			"433": {
				"type": "sequencer",
				"name": "c1",
				"data": {
					"slots": 2
				}
			},
			"434": {
				"type": "variable_update",
				"name": "c2",
				"data": {
					"variable": 80,
					"operator": "add",
					"with": [
						1,
						436
					]
				},
				"ref": [
					80,
					436
				]
			},
			"435": {
				"type": "generator",
				"name": "c3",
				"data": {
					"variable": 80,
					"method": "randi",
					"arguments": [
						2,
						12,
						false,
						true,
						true
					],
					"rect": [
						131,
						106
					]
				},
				"ref": [
					80
				]
			},
			"437": {
				"type": "content",
				"name": "c5",
				"data": {
					"content": "Ninguna de las llaves parece encajar."
				}
			},
			"438": {
				"type": "content",
				"name": "c6",
				"data": {
					"content": "Una llave parece distinta de las otras y podría encajar en la cerradura. Lo intentas, haciendo girar el metal, pero con destreza y sin hacer ruido ¡Funciona! La puerta se abre. Sigue adelante.\n"
				}
			},
			"439": {
				"type": "variable_update",
				"name": "c7",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						5
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"440": {
				"type": "variable_update",
				"name": "c8",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						1
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					100
				]
			},
			"442": {
				"type": "jump",
				"name": "ca",
				"data": {
					"target": 183,
					"reason": "Tesoreria W15",
					"rect": [
						128,
						78
					]
				},
				"ref": [
					183
				]
			},
			"443": {
				"type": "variable_update",
				"name": "cb",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					78
				]
			},
			"444": {
				"type": "interaction",
				"name": "cc",
				"data": {
					"actions": [
						"Fuerzas la cerradura",
						"Escalera S15"
					],
					"rect": [
						195,
						52
					]
				}
			},
			"445": {
				"type": "jump",
				"name": "cd",
				"data": {
					"target": 206,
					"reason": "Escalera S15",
					"rect": [
						120,
						91
					]
				},
				"ref": [
					206
				]
			},
			"446": {
				"type": "condition",
				"name": "ce",
				"data": {
					"variable": 80,
					"operator": "lse",
					"with": [
						0,
						8
					]
				},
				"ref": [
					80
				]
			},
			"447": {
				"type": "generator",
				"name": "cf",
				"data": {
					"variable": 80,
					"method": "randi",
					"arguments": [
						2,
						12,
						false,
						true,
						true
					],
					"rect": [
						131,
						106
					]
				},
				"ref": [
					80
				]
			},
			"448": {
				"type": "variable_update",
				"name": "cg",
				"data": {
					"variable": 80,
					"operator": "add",
					"with": [
						1,
						331
					]
				},
				"ref": [
					80,
					331
				]
			},
			"449": {
				"type": "sequencer",
				"name": "ch",
				"data": {
					"slots": 2
				}
			},
			"450": {
				"type": "condition",
				"name": "ci",
				"data": {
					"variable": 80,
					"operator": "gte",
					"with": [
						0,
						9
					]
				},
				"ref": [
					80
				]
			},
			"451": {
				"type": "content",
				"name": "cj",
				"data": {
					"content": "Esta cerradura se resiste a tus intentos. Renuncias y te vas, sintiéndote deprimido por el fracaso, pero también un poco culpable por haber intentado entrar en esta sala prohibida. "
				}
			},
			"452": {
				"type": "content",
				"name": "ck",
				"data": {
					"content": "Trabajas con diligencia durante varios minutos, empleando un pequeño fragmento de metal retorcido que encontraste en el laboratorio la semana pasada. El sudor te empapa la frente mientras te concentras en la tarea; al mismo tiempo, te esfuerzas por oír cualquier ruido de patrullas que se produzca en la escalera. ¡Por fin, el cerrojo se abre con un clic casi inaudible! \n"
				}
			},
			"453": {
				"type": "variable_update",
				"name": "cl",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						133,
						73
					]
				},
				"ref": [
					78
				]
			},
			"454": {
				"type": "variable_update",
				"name": "cm",
				"data": {
					"variable": 78,
					"operator": "add",
					"with": [
						0,
						10
					],
					"rect": [
						133,
						73
					]
				},
				"ref": [
					78
				]
			},
			"455": {
				"type": "variable_update",
				"name": "cn",
				"data": {
					"variable": 100,
					"operator": "add",
					"with": [
						0,
						2
					],
					"rect": [
						131,
						72
					]
				},
				"ref": [
					100
				]
			},
			"456": {
				"type": "jump",
				"name": "co",
				"data": {
					"target": 183,
					"reason": "Tesoreria W15",
					"rect": [
						128,
						78
					]
				},
				"ref": [
					183
				]
			}
		},
		"variables": {
			"3": {
				"name": "lugar",
				"type": "str",
				"init": "",
				"use": [
					77,
					111
				]
			},
			"10": {
				"name": "dado6",
				"type": "num",
				"init": 0
			},
			"21": {
				"name": "daga",
				"type": "num",
				"init": 0,
				"use": [
					27,
					60
				]
			},
			"23": {
				"name": "3_dosis_de_hierbas",
				"type": "num",
				"init": 0,
				"use": [
					28,
					62
				]
			},
			"24": {
				"name": "coraza_de_cuero",
				"type": "num",
				"init": 0,
				"use": [
					30,
					64
				]
			},
			"25": {
				"name": "espada_corta",
				"type": "num",
				"init": 0,
				"use": [
					29,
					66
				]
			},
			"26": {
				"name": "mochila",
				"type": "num",
				"init": 0,
				"use": [
					31,
					68
				]
			},
			"36": {
				"name": "inventario",
				"type": "num",
				"init": 0,
				"use": [
					40,
					42
				]
			},
			"78": {
				"name": "tiempo",
				"type": "num",
				"init": 0,
				"use": [
					79,
					97,
					98,
					101,
					129,
					134,
					138,
					139,
					154,
					170,
					173,
					178,
					183,
					189,
					202,
					206,
					211,
					215,
					222,
					231,
					242,
					244,
					249,
					252,
					266,
					277,
					287,
					292,
					295,
					303,
					305,
					311,
					315,
					319,
					321,
					333,
					335,
					339,
					345,
					352,
					362,
					363,
					370,
					375,
					382,
					386,
					397,
					403,
					407,
					409,
					416,
					423,
					430,
					439,
					443,
					453,
					454
				]
			},
			"80": {
				"name": "dado12",
				"type": "num",
				"init": 0,
				"use": [
					88,
					89,
					90,
					259,
					261,
					262,
					323,
					324,
					326,
					332,
					356,
					357,
					359,
					391,
					392,
					394,
					431,
					432,
					434,
					435,
					446,
					447,
					448,
					450
				]
			},
			"82": {
				"name": "empiezajuego",
				"type": "bool",
				"init": true,
				"use": [
					83,
					95
				]
			},
			"100": {
				"name": "exp",
				"type": "num",
				"init": 0,
				"use": [
					102,
					210,
					216,
					223,
					306,
					312,
					336,
					410,
					440,
					455
				]
			},
			"103": {
				"name": "lugarencuentro",
				"type": "str",
				"init": "",
				"use": [
					105,
					106,
					107
				]
			},
			"112": {
				"name": "dia",
				"type": "num",
				"init": 0,
				"use": [
					113,
					115
				]
			},
			"116": {
				"name": "hora",
				"type": "num",
				"init": 0,
				"use": [
					117
				]
			},
			"118": {
				"name": "tiempocita",
				"type": "num",
				"init": 0,
				"use": [
					119
				]
			},
			"153": {
				"name": "busqueda",
				"type": "bool",
				"init": false,
				"use": [
					151
				]
			},
			"197": {
				"name": "pistaA",
				"type": "bool",
				"init": false,
				"use": [
					198
				]
			},
			"224": {
				"name": "PistaC",
				"type": "bool",
				"init": false,
				"use": [
					225
				]
			},
			"316": {
				"name": "PistaD",
				"type": "bool",
				"init": false,
				"use": [
					317
				]
			},
			"331": {
				"name": "pericia",
				"type": "num",
				"init": 0,
				"use": [
					332,
					448
				]
			},
			"436": {
				"name": "percepcion",
				"type": "num",
				"init": 0,
				"use": [
					434
				]
			}
		},
		"characters": {

		}
	}
};

</script>
        <script>
/*./modules/shared-i18n.js*/

// Arrow HTML-JS Runtime: i18n (internationalization) module

const _SUPPORTED_LOCALES = ["en"];

const _TRANSLATION_TABLE = {
    skip: {
        en: "Skip",
    },
    continue: {
        en: "Continue",
    },
    false: {
        en: "False",
    },
    true: {
        en: "True",
    },
    generate: {
        en: "Generate",
    },
    dialog_anonymous_character_name: {
        en: "Anonymous",
    },
    apply: {
        en: "Apply",
    },
    invalid: {
        en: "Invalid",
    },
    user_input_default_bool_negative: {
        en: "Negative (False)",
    },
    user_input_default_bool_positive: {
        en: "Positive (True)",
    },
    evaluate: {
        en: "Evaluate",
    },
    eol: {
        en: "EOL: {node_name}",
    },
};

function i18n(string_id, lang){
    // default to `_LOCALE` if the target `lang` is not annotated or supported 
    if ( _SUPPORTED_LOCALES.includes(lang) == false ) lang = _LOCALE;
    if ( _TRANSLATION_TABLE.hasOwnProperty(string_id) ) {
        if ( _TRANSLATION_TABLE[string_id].hasOwnProperty(lang) ) {
            return _TRANSLATION_TABLE[string_id][lang];
        } else {
            throw new Error(`Incomplete Translation Table: value for the selected locale doesn't exist! _TRANSLATION_TABLE[${string_id}][${lang}]`);
        }
    } else {
        throw new Error(`I18n translation table doesn't include the string id: ${string_id} `);
    }
}

</script>
        <script>
/*./modules/shared-bbcode-parser.js*/

// Arrow HTML-JS Runtime: BBCode parser module

// This parser is a modified fork of
// [JS BBCode Parser v3.0.4 - License: MIT](https://github.com/DasRed/js-bbcode-parser)

const DEFAULT_BBCODE_MAPPING = {

    '\\[br\\]': '<br>',

    '\\[b\\](.+?)\\[/b\\]': '<strong>$1</strong>',
    '\\[i\\](.+?)\\[/i\\]': '<em>$1</em>',
    '\\[u\\](.+?)\\[/u\\]': '<u>$1</u>',

    '\\[h1\\](.+?)\\[/h1\\]': '<h1>$1</h1>',
    '\\[h2\\](.+?)\\[/h2\\]': '<h2>$1</h2>',
    '\\[h3\\](.+?)\\[/h3\\]': '<h3>$1</h3>',
    '\\[h4\\](.+?)\\[/h4\\]': '<h4>$1</h4>',
    '\\[h5\\](.+?)\\[/h5\\]': '<h5>$1</h5>',
    '\\[h6\\](.+?)\\[/h6\\]': '<h6>$1</h6>',

    '\\[p\\](.+?)\\[/p\\]': '<p>$1</p>',

    '\\[color=(.+?)\\](.+?)\\[/color\\]':  '<span style="color:$1">$2</span>',
    '\\[size=([0-9]+)\\](.+?)\\[/size\\]': '<span style="font-size:$1px">$2</span>',

    '\\[img\\](.+?)\\[/img\\]': '<img src="$1">',
    '\\[img=(.+?)\\]':          '<img src="$1">',

    '\\[email\\](.+?)\\[/email\\]':       '<a href="mailto:$1">$1</a>',
    '\\[email=(.+?)\\](.+?)\\[/email\\]': '<a href="mailto:$1">$2</a>',

    '\\[url\\](.+?)\\[/url\\]':                      '<a href="$1">$1</a>',
    '\\[url=(.+?)\\|onclick\\](.+?)\\[/url\\]':      '<a onclick="$1">$2</a>',
    '\\[url=(.+?)\\starget=(.+?)\\](.+?)\\[/url\\]': '<a href="$1" target="$2">$3</a>',
    '\\[url=(.+?)\\](.+?)\\[/url\\]':                '<a href="$1">$2</a>',

    '\\[a=(.+?)\\](.+?)\\[/a\\]': '<a href="$1" name="$1">$2</a>',

    '\\[list\\](.+?)\\[/list\\]': '<ul>$1</ul>',
    '\\[\\*\\](.+?)\\[/\\*\\]':   '<li>$1</li>',

    '\\[attr=(.+?)\\svalue=(.+?)\\](.+?)\\[/attr\\]': '<span $1="$2">$3</span>',
    '\\[attr=(.+?)\\](.+?)\\[/attr\\]':               '<span $1>$2</span>',
    
    '\\[style=(.+?)\\](.+?)\\[/style\\]': '<span style="$1">$2</span>',

};

class BBCodeParser {

    constructor(codes) {
        this.codes = [];
        this.setCodes(codes);
    }

    parse(text) {
        return this.codes.reduce((text, code) => text.replace(code.regexp, code.replacement), text);
    }

    add(regex, replacement) {
        this.codes.push({
            regexp: new RegExp(regex, 'igm'),
            replacement: replacement
        });
        return this;
    }

    setCodes(codes) {
        this.codes = Object.keys(codes).map(function (regex) {
            const replacement = codes[regex];
            return {
                regexp: new RegExp(regex, 'igm'),
                replacement: replacement
            };
        }, this);
        return this;
    }

}

const DEFAULT_BBCODE_PARSER = new BBCodeParser(DEFAULT_BBCODE_MAPPING); 

</script>
        <script>
/*./modules/shared.js*/

// Arrow HTML-JS Runtime: Shared utility (static) functions

function safeInt(maybe_number, replacement, allow_none_integer_replacement) {
    if ( Number.isInteger(replacement) == false && allow_none_integer_replacement !== true ) replacement = (-1);
    var result = parseInt(maybe_number);
        result = ( Number.isInteger(result) ? result : replacement );
    return result;
}

function safeBool(maybe_bool){
    var result = null;
    if ( typeof maybe_bool != 'boolean' ){
        if ( typeof maybe_bool == 'string' ){
            maybe_bool = maybe_bool.toLowerCase();
            if ( maybe_bool === "true" ){
                result = true;
            } else if ( maybe_bool === "false" ){
                result = false;
            }
        }
    } else {
        result = maybe_bool;
    }
    if ( result === null ){
        result = ( !!(maybe_bool) );
    }
    return result;
}

function object_has_keys_all(object, expected_keys_array) {
    for (const object_key of expected_keys_array) {
        if ( object.hasOwnProperty(object_key) == false ){
            return false;
        }
    }
    return true;
}

function remap_connections_for_slots(map, owner_node_id){
    if ( typeof map == 'object' && typeof owner_node_id == 'number' && owner_node_id >=0 ){
        var remap_for_slots = [];
        if ( map.hasOwnProperty("io") && Array.isArray(map.io) ){
            for (const connection of map.io) {
                // <connection>[ from_id, from_slot, to_id, to_slot ]
               if ( connection.length >= 4 && connection[0] == owner_node_id ){
                    remap_for_slots[ connection[1] ] = { "id": connection[2], "slot": connection[3] };
               }
            }
        }
        return remap_for_slots;
    } else {
        throw new Error("Unable to remap connections for slots: Called with wrong arguments.");
    }
}

function create_node_base_html(node_id, node_resource, tag){
    var html = document.createElement(tag || 'div');
        html.className = 'node';
        html.setAttribute('data-type',  node_resource.type);
        html.setAttribute('data-name',  node_resource.name);
        html.setAttribute('data-uid',   node_id.toString());
    return html;
}

function create_element(tag, inner, attributes){
    var element = document.createElement(tag);
    if ( inner ){
        if ( typeof inner == 'string' ){
            element.innerHTML = inner;
        } else if ( inner instanceof Element ){
            element.appendChild(inner);
        }
    }
    if (typeof attributes == 'object') {
        for (const attr in attributes) {
            if (attributes.hasOwnProperty(attr)) {
                element.setAttribute(attr, attributes[attr]);
            }
        }
    }
    return element;
}

function ellipsis(text, length) {
    return text.substr(0, length) + (text.length > length ? "..." : "")
}

function format(text, pairs, case_insensitive){
    // replacing every `{tag}` in `text` with value of `pairs[tag]`
    if ( typeof text == 'string' && typeof pairs == 'object' ){
        for (const key in pairs) {
            if (pairs.hasOwnProperty(key)) {
                const tag = '{' + key + '}';
                const pattern = new RegExp(tag, (case_insensitive === true ? 'gi' : 'g')); // i.e. `g`lobally search for every key
                const replacement = pairs[key];
                text = text.replace( pattern , replacement );
            }
        }
        return text;
    } else {
        throw new Error("Unable to format text: Called with wrong arguments.");
    }
}

function parse_bbcode(text, return_text_anyway){
    // returns `text/html`
    if (typeof text == 'string'){
        return DEFAULT_BBCODE_PARSER.parse(text);
    } else {
        // ... or if the input is not what expected
        if (return_text_anyway === false){ // error
            throw new Error("Unable to parse BBCode: Called with wrong arguments.");
        } else { // or by default an empty string ''
            return "";
        }
    }
}

function string_begins_with(string, rhs){
    if ( typeof string == 'string' && typeof rhs == 'string'){
        return ( string.indexOf(rhs) == 0 );
    } else {
        throw new Error("Called with Wrong Arguments: Expected two strings.");
    }
}

function string_ends_with(string, rhs){
    if ( typeof string == 'string' && typeof rhs == 'string'){
        var last_index_of_rhs = string.lastIndexOf(rhs);
        return ( last_index_of_rhs >= 0 && last_index_of_rhs === ( string.length - rhs.length ) );
    } else {
        throw new Error("Called with Wrong Arguments: Expected two strings.");
    }
}

// Replicates `Godot[v3.2.x]::String::capitalize`:
// For `capitalize camelCase mixed_with_underscores`, it will return `Capitalize Camel Case Mixed With Underscores`.
function capitalize(string){
    if ( typeof string == 'string' ){
        // Replaces underscores with spaces
        var replaced = string.replace(/_/gi, " ");
        // adds spaces before in-word uppercase characters
        var result = "";
        for ( var cidx = 0; cidx < replaced.length; cidx++ ){
            var chr = replaced.charAt(cidx);
            var chr_upper = chr.toUpperCase();
            result += ( chr != " " && chr == chr_upper ? ` ${chr}` : chr );
        }
        // converts all letters to lowercase
        // then capitalizes the first letter and every letter following a space character.
        result = result.split(" ");
        for( var widx = 0; widx < result.length; widx++ ){
            var low_word = result[widx].toLowerCase();
            result[widx] = ( low_word.charAt(0).toUpperCase() + low_word.substring(1) );
        }
        result = result.join(" ");
        return result;
    } else {
        throw new Error("Called with Wrong Arguments: Expected string.");
    }
}

const inclusiveRandInt = function(_min, _max, base, negative, even, odd) {
    if( arguments.length < 2 ){
        _max = _min;
		_min = 0;
	}
    _min = ( Number.isFinite( _min ) ? Math.ceil(_min) : 0 );
    _max = ( Number.isFinite( _max ) ? Math.floor(_max) : 0 );
    var max = Math.max(_min, _max);
    var min = Math.min(_min, _max);
	let result = null;
    do {
        result = Math.floor(Math.random() * (max - min + 1)) + min;
        if ( even != odd ){
            let is_even = ((result % 2) == 0);
            if ( is_even && even == false ) result = null;
            if ( is_even == false && odd == false ) result = null;
        }
    } while (result == null);
    if ( negative === true ) result = (result * (-1));
	if ( Number.isInteger(base) && base >= 2 && base <= 36  ){
        return result.toString(base);
    } else {
        return result;
    }
};

</script>
        <script>
/*./modules/condition.js*/

// Arrow HTML-JS Runtime: Condition node module

class Condition {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        const FALSE_SLOT = 0;
        const TRUE_SLOT  = 1;
        
        const UNSET_CONDITION_MESSAGE = "Condition unset or invalid!";

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = parseInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 || slot_idx > 1 ){
                // We default to `false` anytime something is wrong but we can continue
                slot_idx = FALSE_SLOT; 
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {            
            // Skipped? The convention is to ...
            this.html.setAttribute('data-skipped', true);
            // ... react by playing the *False Slot First*
            if ( this.slots_map.hasOwnProperty(FALSE_SLOT) ){ // if false slot is connected
                this.play_forward_from(FALSE_SLOT);
            }
            else { // otherwise playing the *Only Remained [Possibly Connected] True Slot*
                this.play_forward_from(TRUE_SLOT); // which ...
            } // ... will naturally end the plot line if the true slot is not connected
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };

        this.evaluation_and_play = function(){
            var evaluation = null;
            if ( this.condition_statement ) {
                evaluation = this.condition_statement.evaluate();
                // ... It may result in `null` (e.g. if the statement is unset.)
            }
            if ( typeof evaluation != 'boolean' ) {
                evaluation = false; // reset to default `false` if there is no valid evaluation ...
                if (_VERBOSE) console.warn(`Evaluation of Condition (${this.node_resource.name}) Failed, therefore considered as 'False'.`);
            }
            this.play_forward_from(
                ( evaluation == true) ? TRUE_SLOT : FALSE_SLOT
            );
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else {
                    this.evaluation_and_play();
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Statement
                this.condition_statement = null;
                if ( this.node_resource.hasOwnProperty("data") ){
                    try {
                        this.condition_statement = new ConditionStatement(this.node_resource.data, VARS);
                    } catch(err){
                        if (_VERBOSE) console.warn('Unable to Parse Condition. Error:' + err);
                    }
                }
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    // Parsed Condition Statement:
                    if ( this.condition_statement ){
                        var parsed_condition_statement = (this.condition_statement.parse() || UNSET_CONDITION_MESSAGE);
                        this.parsed_statement = create_element("code", parsed_condition_statement, {"class": "statement"});
                        this.html.appendChild(this.parsed_statement);
                    }
                    // False:
                    this.false_button = create_element("button", i18n("false"), { "value": "false" });
                    this.false_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, FALSE_SLOT) );
                    this.html.appendChild(this.false_button);
                    // True:
                    this.true_button = create_element("button", i18n("true"), { "value": "true" });
                    this.true_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, TRUE_SLOT) );
                    this.html.appendChild(this.true_button);
            }
            return this;
        }
        throw new Error("Unable to construct `Condition`");
    }

}

class ConditionStatement {

    /*  Note:
        (convention)
        length comparisons can get a str(int) as `with` value or a str(string)
        in the first case the stringified integer will be parsed as the length of the right-hand-side,
        and in the latter case, the `.length()` of the string will be used in the comparison.
    */

    constructor(data, variables){

        const _self = this;

        this.data = null;
        this.variable = null;

        const PARAMETER_MODES_ENUM = {
            0: "value",
            1: "variable"
        };
        const PARAMETER_MODES_ENUM_CODE = {
            "value": 0,
            "variable": 1
        };
        
        const COMPARISON_OPERATORS = {
            "num": {
                "eq": { "text": "is Equal", "sign": "==" },
                "nq": { "text": "is Not Equal", "sign": "!=" },
                "gt": { "text": "is Greater", "sign": ">" },
                "gte": { "text": "is Greater or Equal", "sign": ">=" },
                "ls": { "text": "is Lesser", "sign": "<" },
                "lse": { "text": "is Lesser or Equa)", "sign": "<=" },
            },
            "str": {
                "rgx":{ "text": "Matches RegEx Pattern", "sign": "~=" },
                "ct":{ "text": "Contains Substring", "sign": "%~" },
                "cts":{ "text": "Contains Substring (Case-Sensitive)", "sign": "%=" },
                "bgn":{ "text": "Begins with", "sign": "^=" },
                "end":{ "text": "Ends with", "sign": "=^" },
                "eql":{ "text": "Has Equal Length", "sign": "#=" },
                "lng":{ "text": "Is Longer", "sign": "#>" },
                "shr":{ "text": "Is Shorter", "sign": "#<" },
            },
            "bool": {
                "eq": { "text": "Conforms", "sign": "=="},
                "nq": { "text": "Doesn't Conform", "sign": "!="},
            },
        };

        const KEYS_NEEDED_TO_PARSE = ["variable", "operator", "with"];
        
        const STATEMENT_TEMPLATE = "{ident} {operator_sign} {parameter}";
        const COMPARED_TO_SELF_INITIAL_RIGHT_SIDE = "Self (Intial Value)";
        
        const STRING_VALUE_FORMATING_TEMPLATE = "`%s`";
    
        this.parse = function(){
            var parsed = null;
            if ( this.variable && this.data ) {
                this.statement = { "ident": null, "operator_sign": null, "parameter": null };
                this.statement.ident = this.variable.name;
                if ( COMPARISON_OPERATORS[this.variable.type].hasOwnProperty(this.data.operator) ){
                    this.statement.operator_sign = COMPARISON_OPERATORS[this.variable.type][this.data.operator].sign;
                }
                switch ( this.data.with[0] ){
                    case PARAMETER_MODES_ENUM_CODE.value:
                        if (this.variable.type == "str"){
                            this.statement.parameter = STRING_VALUE_FORMATING_TEMPLATE.replace("%s", this.data.with[1]);
                        } else {
                            this.statement.parameter = this.data.with[1];
                        }
                        break;
                    case PARAMETER_MODES_ENUM_CODE.variable:
                        if ( this.data.with[1] == this.data.variable) { // the variable is compared to self (initial value)
                            this.statement.parameter = COMPARED_TO_SELF_INITIAL_RIGHT_SIDE;
                        } else { // or another variable
                            if ( VARS.hasOwnProperty(this.data.with[1]) ) {
                                var parameter_var = VARS[ this.data.with[1] ];
                                this.statement.parameter = parameter_var.name;
                            }
                        }
                        break;
                }
                for (const key in this.statement) {
                    if ( this.statement.hasOwnProperty(key) ) {
                        if ( this.statement[key] === null ){
                            this.statement = null;
                            break;
                        }
                    }
                }
                parsed = (this.statement ? format(STATEMENT_TEMPLATE, this.statement) : null );
            }
            return parsed;
        };

        //  `evaluate_str_comparison` can give a number as input, but it comes from a textual input
        //  also it may compare two real strings (str variables) so we shall
        //  detect what user have had in mind:
        this.smart_length_parse = function(input){
            if ( typeof input == 'number' ){
                return safeInt(input, 0);
            } else if ( typeof input == 'string' ) {
                var parsed_input = parseInt(input);
                if ( parsed_input.toString() == input ){
                    // if input is only a number inputted as string, it will be returned as the length (parsed)
                    return parsed_input;
                } else { //  otherwise ...
                    //... the length of the string is the result
                    return input.length;
                }
            } else {
                return 0;
            }
        };
            
        this.evaluators = {
            "str": function(left, operation, right){ 
                var result = null;
                switch (operation) {
                    case "rgx": // Matches RegEx Pattern
                        try {
                            var regex = new RegExp(right);
                            result = ( left.search(regex) >= 0);
                        } catch(err) {
                            if (_VERBOSE){
                                console.warn(`Evaluation Failed! Bad RegEx Match Operation: ` + err);
                                console.warn(arguments);
                            }
                        }
                        break;                    
                    case "ct": // Contains Substring
                        var l = left.toLowerCase();
                        var r = right.toLowerCase();
                        result = (l.indexOf(r) >= 0);
                        break;
                    case "cts": // Contains Substring (Case-Sensitive)
                        result = (left.indexOf(right) >= 0);
                        break;
                    case "eql": // Has Equal Length
                        result = (left.length == _self.smart_length_parse(right));
                        break;
                    case "lng": // Is Longer
                        result = (left.length > _self.smart_length_parse(right));
                        break;
                    case "shr": // Is Shorter
                        result = (left.length < _self.smart_length_parse(right));
                        break;
                    case "bgn": // Begins with
                        result = string_begins_with(left, right);
                        break;
                    case "end": // Ends with
                        result = string_ends_with(left, right);
                        break;
                }
                return result;
            },
            "num": function(left, operation, right){
                var result = null;
                switch (operation) {
                    case "eq": // is Equal
                        result = ( left == right);
                        break;
                    case "nq": // is Not Equal
                        result = ( left != right);
                        break;
                    case "gt": // is Greater
                        result = ( left > right);
                        break;
                    case "gte": // is Greater or Equal
                        result = ( left >= right);
                        break;
                    case "ls": // is Lesser
                        result = ( left < right);
                        break;
                    case "lse": // is Lesser or Equal
                        result = ( left <= right);
                        break;
                }
                return result;
            },
            "bool": function(left, operation, right){
                var result = null;
                switch (operation){
                    case "eq":
                        result = (left == right);
                        break;
                    case "nq":
                        result = (left != right);
                        break;
                }
                return result;
            }
        };

        this.evaluate = function(){
            var result = null;
            if ( this.variable ){
                var type  = this.variable.type;
                var value = this.variable.value;
                var with_value;
                switch ( this.data.with[0] ) {
                    case PARAMETER_MODES_ENUM_CODE.value:
                        with_value = this.data.with[1];
                        break;
                    case PARAMETER_MODES_ENUM_CODE.variable:
                        var the_second_variable_id = this.data.with[1];
                        if ( VARS.hasOwnProperty(the_second_variable_id) ){
                            if (the_second_variable_id == this.data.variable){
                                // compared to itself (self initial value)
                                with_value = VARS[the_second_variable_id].init;
                            } else {
                                with_value = VARS[the_second_variable_id].value;
                            }
                        }
                        break;
                }
                // now we have whatever we need, just make sure the comparee value is right
                if ( with_value !== null ) {
                    if ( type == "str" && ( typeof with_value != 'string') ){
                        with_value = with_value.toString();
                    } else if ( type == "num" && (typeof with_value != 'number') ){
                        with_value= safeInt(with_value, 0);
                    } else if ( type == "bool" && (typeof with_value != 'boolean') ){
                        with_value= safeBool(with_value);
                    }
                    // lets evaluate for the type
                    if ( COMPARISON_OPERATORS[type].hasOwnProperty(this.data.operator) ){
                        result = this.evaluators[type]( value, this.data.operator, with_value );
                    }
                }
            }
            return result;
        };

        if (
            object_has_keys_all(data, KEYS_NEEDED_TO_PARSE) && 
            Array.isArray(data.with) && data.with.length == 2  // with<array>[parameter_mode, parameter_value]
        ){
            this.data = data;
            var target_variable_id = safeInt(data.variable);
            if ( VARS.hasOwnProperty(target_variable_id) ){
                this.variable = VARS[data.variable];
            }
        } else {
            throw new Error( "Invalid Condition! Some of required data is missing: " + KEYS_NEEDED_TO_PARSE.join(", ") );
        }
        
    }
    
}

</script>
        <script>
/*./modules/content.js*/

// Arrow HTML-JS Runtime: Content node module

class Content {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {
        
        const _self = this;
        
        const DEFAULT_NODE_DATA = {
            "title": "",
            "content": "",
            "brief": 0,
            "auto": false,
            "clear": false,
        }

        // Forces auto-play regardless of the `auto` property
        const AUTO_PLAY_SLOT = -1;
        
        const CONTINUE_PLAY_SLOT = 0;
        
        const TITLE_TAG = "h2";
        const CONTENT_TAG = "pre";
        const BRIEF_TAG = "pre";

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = AUTO_PLAY_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            // a skipped content node is not displayed ...
            this.html.setAttribute('data-skipped', true);
            // ...  so there is no continue button and we shall play forward anyway
            this.play_forward_from((AUTO_PLAY_SLOT >= 0 ? AUTO_PLAY_SLOT : CONTINUE_PLAY_SLOT));
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.string_data_or_default = function(parameter) {
            var text = DEFAULT_NODE_DATA[parameter];
            if (
                this.node_resource.data.hasOwnProperty(parameter) &&
                (typeof this.node_resource.data[parameter] == 'string')
            ){
                text = this.node_resource.data[parameter]
            }
            return text;
        };
        
        this.bool_data_or_default = function(parameter) {
            var intended = DEFAULT_NODE_DATA[parameter];
            if (
                this.node_resource.data.hasOwnProperty(parameter) &&
                (typeof this.node_resource.data[parameter] == 'boolean')
            ){
                intended = this.node_resource.data[parameter]
            }
            return intended;
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {   
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else if (AUTO_PLAY_SLOT >= 0) {
                    this.play_forward_from(AUTO_PLAY_SLOT);
                } else {
                    if ( this.bool_data_or_default("auto") ) {
                        this.play_forward_from(CONTINUE_PLAY_SLOT);
                    }
                }
            }
            // View Clearance ?
            if (_ALLOW_CLEARANCE) {
                // `content` nodes can force the page to get cleaned before they step in
                if ( this.bool_data_or_default("clear") ) {
                    clear_up(this.node_id);
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ...
                    if ( node_resource.hasOwnProperty("data") ){
                        var title_string = this.string_data_or_default("title")
                        if ( title_string.length > 0 ){
                            this.title = create_element(TITLE_TAG, parse_bbcode( exposure( title_string ) ) );
                            this.html.appendChild(this.title);
                        }
                        // Textual (legacy) brief support:
                        // (It's not a string anymore so we can check for its default)
                        if ( node_resource.data.hasOwnProperty("brief") && typeof node_resource.data.brief == 'string' ){
                            this.brief = create_element(BRIEF_TAG, parse_bbcode( exposure( node_resource.data.brief ) ) );
                            this.html.appendChild(this.brief);
                        }
                        // ...
                        var content_string = this.string_data_or_default("content")
                        if (content_string.length > 0 ){
                            this.content = create_element(CONTENT_TAG, parse_bbcode( exposure( content_string ) ) );
                            this.html.appendChild(this.content);
                        }
                        if ( this.bool_data_or_default("auto") ) { this.html.setAttribute('data-auto', 'true'); }
                        if ( this.bool_data_or_default("clear") ) { this.html.setAttribute('data-clear', 'true'); }
                    }
                    // ...
                    this.continue_button = create_element("button", i18n("continue"));
                    this.continue_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, CONTINUE_PLAY_SLOT) );
                    this.html.appendChild(this.continue_button);
                    // ...
                    if (node_map.hasOwnProperty("skip") && node_map.skip === true) {
                        this.skip_button = create_element("button", i18n("skip"));
                        this.skip_button.addEventListener( _CLICK, this.skip_play.bind(_self) );
                        this.html.appendChild(this.skip_button);
                    }
            }
            return this;
        }
        throw new Error("Unable to construct `Content`");
    }
    
}

</script>
        <script>
/*./modules/dialog.js*/

// Arrow HTML-JS Runtime: Dialog node module

class Dialog {
    
    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        const ANONYMOUS_CHARACTER = {
            "name": i18n("dialog_anonymous_character_name"),
            "color": "ffffff",
        };

        const DEFAULT_NODE_DATA = {
            "character": -1, // ~ anonymous or unset (hardcoded convention)
            "lines": ["Hey there!"],
            // -- optional(s) --
            "playable": false,
        };

        const AUTO_PLAY_SLOT = -1;
        
        const LINES_HOLDER_TAG = 'ol';
        const LINE_ELEMENT_TAG = 'li';
        const PLAYED_LINE_TAG = 'p';
        
        this.lines = null;
        this.line_elements = null;
        this.played_line = null;
        this.character_profile = null;
        this.character_profile_element = null;
        this.character_name_element = null;

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = AUTO_PLAY_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // Plays the first *connected* slot (dialog) 
            // or just the first[0] slot if there is no connected one which means end edge
            var first_connected_slot = 0;
            if (this.slots_map.length >= 1) {
                var all_connected_slots = Object.keys(this.slots_map);
                all_connected_slots.sort();
                first_connected_slot = all_connected_slots[0];
            }
            this.play_forward_from(first_connected_slot);
        };
        
        this.set_view_played = function(slot_idx){
            // set the famous attribute,
            this.html.setAttribute('data-played', true);
            // then emphasize the played line
            if ( Number.isInteger(slot_idx) && slot_idx >= 0 && slot_idx < this.lines.length ){
                this.played_line = create_element(
                    PLAYED_LINE_TAG,
                    exposure(this.lines[slot_idx]),
                    { class: 'dialog-played-line' }
                );
                this.html.appendChild(this.played_line);
            } else {
                throw new Error("Unable to set `Dialog` played: The played slot doesn't exist: ", slot_idx);
            }
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
            // ... and remove the element for the emphasized played line
            if ( this.played_line ){
                this.played_line.remove();
                this.played_line = null;
            }
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                // handle skip in case,
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                // otherwise auto-play if set (which is not normal)
                } else if ( AUTO_PLAY_SLOT >= 0 ) {
                    this.play_forward_from(AUTO_PLAY_SLOT);
                // or handle the none-playable dialog in case ...
                } else {
                    this.random_play_none_playable_dialogs();
                }
                // ... and finally for normal playable dialogs,
                // we'll wait for the user to take action and play a line.
            }
        };

        this.create_line_elements = function(lines_array, lines_holder, listen){
            if ( ("appendChild" in lines_holder) == false ) lines_holder = null;
            var line_elements = [];
            for ( var idx = 0; idx < lines_array.length; idx++ ) {
                var line_element = create_element(
                    LINE_ELEMENT_TAG,
                    exposure(lines_array[idx])
                );
                if ( listen ){
                    // Each line has its own slot in the same order, so...
                    line_element.addEventListener(_CLICK, this.play_forward_from.bind(_self, idx));
                }
                if ( lines_holder ) lines_holder.appendChild(line_element);
                line_elements.push(line_element);
            }
            return line_elements;
        };
        
        this.has_intended_bool_behavior = function(parameter) {
            var is_intended = DEFAULT_NODE_DATA[parameter];
            if (
                this.node_resource.data.hasOwnProperty(parameter) &&
                (typeof this.node_resource.data[parameter] == 'boolean')
            ){
                is_intended = this.node_resource.data[parameter]
            }
            return is_intended;
        };
        
        this.random_play_none_playable_dialogs = function(){
            if ( this.has_intended_bool_behavior("playable") == false ){
                var random_played_line_idx = inclusiveRandInt( this.lines.length - 1);
                this.play_forward_from(random_played_line_idx);
            }
        };

        this.update_character_profile = function(character_id, character){
            if ( typeof character == 'object' && character.hasOwnProperty("color") && character.hasOwnProperty("name") ){
                if ( this.character_profile_element == null ){
                    this.character_name_element = create_element( "div", character.name, { class: 'character-name' } );
                    var data_attributes = {
                        class: 'character-profile',
                        style: `--character-color: #${character.color};`,
                        "data-id": character_id,
                        "data-name": character.name,
                    };
                    for (const key in character.tags){
                        data_attributes[`data-tag-${key}`] = character.tags[key];
                    };
                    this.character_profile_element = create_element( "div",
                        this.character_name_element,
                        data_attributes
                    );
                    this.html.appendChild(this.character_profile_element);
                } else {
                    this.character_profile_element.setAttribute('style', `--character-color: #${character.color};`);
                    this.character_name_element.innerHTML = character.name;
                }
            } else {
                if (_VERBOSE) console.error(character);
                throw new Error("Unable to Update Character Profile: Lack of required object keys, `name` and/or `color`.");
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    var error = null;
                    if ( node_resource.hasOwnProperty('data') ){
                        // Character profile:
                        if ( node_resource.data.hasOwnProperty('character') ){
                            var character_id = safeInt(node_resource.data.character);
                            this.update_character_profile(
                                character_id,
                                CHARS.hasOwnProperty(character_id) ? CHARS[character_id] : ANONYMOUS_CHARACTER,
                            );
                        }
                        // Lines:
                        if ( node_resource.data.hasOwnProperty('lines') && Array.isArray(node_resource.data.lines) && node_resource.data.lines.length > 0 ){
                            // + holder
                            this.lines_holder = create_element(LINES_HOLDER_TAG, null, { class: "dialog-lines"});
                                // + lines
                                this.lines = node_resource.data.lines;
                                this.line_elements = this.create_line_elements(node_resource.data.lines, this.lines_holder, true);
                            this.html.appendChild(this.lines_holder);
                        } else {
                            error = "No `lines` exist!";
                        }
                        if ( this.has_intended_bool_behavior("playable") ){
                            this.html.setAttribute('data-playable', 'true');
                        }
                    } else {
                        error = "The resource doesn't own the required `data`.";
                    }
                    if (error)  throw new Error("Unable to create `Dialog` node! " + error );

            }
            return this;
        }
        throw new Error("Unable to construct `Dialog`");
    }
    
}

</script>
        <script>
/*./modules/entry.js*/

// Arrow HTML-JS Runtime: Entry node module

class Entry {
    
    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        const AUTO_PLAY_SLOT = 0;
        
        this.get_element = function () {
            return this.html;
        };

        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = AUTO_PLAY_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // continue the only and natural path even if the node is skipped
            this.play_forward_from(AUTO_PLAY_SLOT);
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };

        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                // ... auto-plays anyway
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else if ( AUTO_PLAY_SLOT >= 0 ) {
                    this.play_forward_from(AUTO_PLAY_SLOT);
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    // + plaque:
                    if ( 
                        node_resource.hasOwnProperty("data") && node_resource.data.hasOwnProperty("plaque") &&
                        typeof node_resource.data.plaque == 'string' && node_resource.data.plaque.length > 0
                    ) {
                        this.plaque = create_element("em", node_resource.data.plaque, {'class': 'plaque'});
                        this.html.appendChild(this.plaque);
                    } else {
                        this.entry_mark = create_element("span", "[Entry]");
                        this.html.appendChild(this.entry_mark);
                    }
                    // + possible user interaction (manual play)
                    this.entry_button = create_element("button", node_resource.name);
                    this.entry_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, AUTO_PLAY_SLOT) );
                    this.html.appendChild(this.entry_button);
            }
            return this;
        }
        throw new Error("Unable to construct `Entry`");
    }

}

</script>
        <script>
/*./modules/frame.js*/

// Arrow HTML-JS Runtime: Frame node module

// NOTE:
//
// Frames nodes have no incoming or outgoing slots.
// They are designed to be used as visual organizers in the Arrow editor.
// Although frames can not act as active links in a plot and are not expected to be played by convention,
// they are structurally nodes (i.e. stored as node resources and allowed to be jumped into,)
// so shall have defined runtime behavior.
// This runtime treats them as end-of-line marker-like nodes (with labels) the same way the Arrow editor does.

class Frame {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        // super();

        const AUTO_PLAY_SLOT = 0;
        
        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = AUTO_PLAY_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                // NOTE:
                // You always end up here, because currently, **frames have no outgoing slot.**
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // continue the only and natural path even if the node is skipped
            this.play_forward_from(AUTO_PLAY_SLOT);
        };
        
        this.set_view_played = function(slot_idx){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play(); // ... also auto-plays forward
                } else if ( AUTO_PLAY_SLOT >= 0 ) {
                    this.play_forward_from(AUTO_PLAY_SLOT);
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    // Label
                    var label_text = (
                        node_resource.hasOwnProperty("data") && node_resource.data.hasOwnProperty("label") &&
                        typeof node_resource.data.label == 'string' && node_resource.data.label.length > 0
                    ) ? node_resource.data.label : "...";
                    var attributes = ( node_resource.data.hasOwnProperty("color") ? { style: `--frame-color: #${node_resource.data.color}; ` } :  undefined );
                    this.label = create_element("p", label_text, attributes);
                    this.html.appendChild(this.label);
                    // Manual play button
                    this.frame_button = create_element("button", node_resource.name);
                    this.frame_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, AUTO_PLAY_SLOT) );
                    this.html.appendChild(this.frame_button);
                // We also need to inform user in case there was a mistake in creating jumps and we ended up here,
                // because frames are not expected to be played!
                if (_VERBOSE) console.warn(
                    `We just hit a Frame node (${node_id} - ${node_resource.name})!\n` +
                    "Although this node type is not expected to be part of (or a link in) a plot, " +
                    "it is allowed to be played (by being jumped into,) so needs to have defined runtime behavior.\n" +
                    "Because there is no general outgoing scenario, this runtime treats frames as marker-like end-of-line nodes.\n" +
                    "Make sure this node is intentionally played and is not a misdirected jump.\n" +
                    "Better practice may be to use a `Marker` if you intend to get this kind of result.\n"
                )
            }
            return this;
        }
        throw new Error("Unable to construct `Frame`");
    }

}

</script>
        <script>
/*./modules/generator.js*/

// Arrow HTML-JS Runtime: Generator node module

class Generator {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        const ONLY_PLAY_SLOT = 0;
        
        const UNSET_EXPRESSION_MESSAGE = "Parameters unset or invalid!";
        const MAX_ARGS_PREVIEW_LENGTH = 10;

        const STRING_SET_DELIMITER = "|";
        const DEFAULT_CHARACTER_POOL = "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz123456789";

        const VALID_GENERATORS = {
            "num": {
                "randi": {
                    "title": "Random Integer",
                    "func": function(args){
                        var result = null;
                        if (
                            Array.isArray(args) &&
                            args.length == 5
                        ){
                            if (
                                Number.isInteger(args[0]) && args[0] >= 0 &&
                                Number.isInteger(args[1]) && args[1] >= 2
                            ){
                                result = inclusiveRandInt(
                                    args[0],        // from
                                    (args[1] - 1), // to (exclusive)
                                    undefined,    // undefined base = 2
                                    args[2],     // negative,
                                    args[3],     // even
                                    args[4]     // odd
                                );
                            } else{
                                if (_VERBOSE) console.warn("Unexpected Behavior! Bad range for `randi` generator: ", args );
                            }
                        } else {
                            if (_VERBOSE) console.warn("Unexpected Behavior! Wrong arguments for `randi` generator: ", args );
                        }
                        if (result === null) {
                            result = inclusiveRandInt(0, 100); // so returns even on corrupt arguments
                        }
                        return result;
                    },
                    "args": function(data) {
                        if (data.hasOwnProperty("arguments") && Array.isArray(data.arguments) && data.arguments.length == 5){
                            var args = data.arguments;
                            return `: [${args[0]}, ${args[1]}] ${args[2] ? "N" : ""}${args[3] ? "E" : ""}${args[4] ? "O": ""}`;
                        } else {
                            return "(Invalid)"
                        }
                    },
                },
            },
            "str": {
                "ascii": {
                    "title": "Random ASCII String",
                    "func": function(args){
                        var result = "";
                        if (args.length == 2){
                            var char_pool = (typeof args[0] == "string" && args[0].length > 0) ? args[0] : DEFAULT_CHARACTER_POOL;
                            var char_pool_length = char_pool.length;
                            var desired_length = (typeof args[1] == "number" && args[1] >= 1) ? Math.floor(args[1]) : char_pool_length;
                            while (result.length < desired_length){
                                let char_pos = inclusiveRandInt(0, char_pool_length - 1);
                                console.log(char_pos);
                                result = ( result + char_pool[ char_pos ] );
                            }
                        }
                        return result;
                    },
                    "args": function(data) {
                        if (data.hasOwnProperty("arguments") && Array.isArray(data.arguments) && data.arguments.length == 2){
                            return `: ${data.arguments[1]} of \`${ellipsis(data.arguments[0].length > 0 ? data.arguments[0] : DEFAULT_CHARACTER_POOL, MAX_ARGS_PREVIEW_LENGTH)}\``;
                        } else {
                            return "(Invalid)"
                        }
                    },
                },
                "strst": {
                    "title": "From Set of Strings",
                    "func": function(stringified_set){
                        var result = "";
                        if (typeof stringified_set == "string" && stringified_set.length > 0){
                            var string_set = stringified_set
                                            .split(STRING_SET_DELIMITER)
                                            .filter( (part) => { return part.length > 0; } );
                            if (string_set.length > 0){
                                result = string_set[ inclusiveRandInt(0, (string_set.length - 1)) ];
                            }
                        }
                        return result;
                    },
                    "args": function(data) {
                        if (data.hasOwnProperty("arguments") && typeof data.arguments == 'string' && data.arguments.length > 0){
					        return ": `" + ellipsis(data.arguments, MAX_ARGS_PREVIEW_LENGTH) + "`"
                        } else {
                            return "(Null/Invalid)"
                        }
                    },
                },
            },
            "bool": {
                "rnbln": {
                    "title": "Random Boolean",
                    "func": function(_null){
                        return (
                            Math.floor( Math.random() * 10 ) % 2 == 0
                        );
                    },
                    "args": function(data) {
                        return "" // No arguments to preview
                    },
                },
            },
        };

        this.the_variable = null;
        this.the_variable_id = null;
        this.previous_variable_value = null;

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward = function(){
            if ( this.slots_map.hasOwnProperty(ONLY_PLAY_SLOT) ) {
                var next = this.slots_map[ONLY_PLAY_SLOT];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(ONLY_PLAY_SLOT);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // when skipped it *doesn't modify* the variable
            this.play_forward();
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            // reverse any variable update
            if ( this.the_variable && this.previous_variable_value !== null ){
                update_global_variable_by_id(this.the_variable_id, this.previous_variable_value);
            }
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };

        this.generate_and_play = function(){
            var new_value = null;
            if ( this.valid_generator ) {
                new_value = this.valid_generator.func.call(
                    null,
                    this.node_resource.data.hasOwnProperty("arguments") ? this.node_resource.data.arguments : null
                );
                // ... It may result in `null` (e.g. if the expression is unset.)
            }
            if ( new_value !== null && this.the_variable ){
                update_global_variable_by_id(this.the_variable_id, new_value);
                this.play_forward();
            } else {
                console.error(`Unable to run the generator (${this.node_resource.name}.) Skipped forward.`);
                this.skip_play();
            }
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else {
                    this.generate_and_play();
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Expression
                this.valid_generator = null;
                if ( this.node_resource.hasOwnProperty("data") && this.node_resource.data.hasOwnProperty("variable") ){
                    this.the_variable_id = safeInt(this.node_resource.data.variable);
                    if ( VARS.hasOwnProperty(this.the_variable_id) ) {
                        this.the_variable = VARS[ this.the_variable_id ];
                        this.previous_variable_value = this.the_variable.value;
                        if (
                            this.node_resource.data.hasOwnProperty("method") &&
                            this.the_variable.hasOwnProperty("type") &&
                            VALID_GENERATORS.hasOwnProperty(this.the_variable.type) &&
                            VALID_GENERATORS[this.the_variable.type].hasOwnProperty(this.node_resource.data.method)
                        ){
                            this.valid_generator = VALID_GENERATORS[this.the_variable.type][this.node_resource.data.method];
                        }
                    } else {
                        if (_VERBOSE) console.warn(
                            "Invalid Generator Node! The node has nonexistent UID as the target variable:",
                            this.the_variable_id,
                            this.node_resource
                        );
                    }
                } else {
                    if (_VERBOSE) console.warn(
                        "Invalid Generator Node! The node has no data set or target variable.",
                        this.node_resource
                    );
                }
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    // Parsed VariableUpdate Expression:
                    var parsed_valid_generator = (
                        this.valid_generator ?
                        `${this.the_variable.name} = ${this.valid_generator.title} ${this.valid_generator.args(this.node_resource.data)}`
                        : UNSET_EXPRESSION_MESSAGE
                    );
                    this.parsed_expression = create_element("code", parsed_valid_generator, { "class": "expression" });
                    this.html.appendChild(this.parsed_expression);
                    // Manual Evaluation Button:
                    this.eval_button = create_element("button", i18n("generate"));
                    this.eval_button.addEventListener( _CLICK, this.generate_and_play.bind(_self) );
                    this.html.appendChild(this.eval_button);
                    // and skip button (used in manual play and step-backs)
                    this.skip_button = create_element("button", i18n("skip"));
                    this.skip_button.addEventListener( _CLICK, this.skip_play.bind(_self) );
                    this.html.appendChild(this.skip_button);
            }
            return this;
        }
        throw new Error("Unable to construct `VariableUpdate`");
    }

}

</script>
        <script>
/*./modules/hub.js*/

// Arrow HTML-JS Runtime: Hub node module

class Hub {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;

        // Hubs are to merge edges,
        // so there is only one outgoing slot which is always auto-played
        const AUTO_PLAY_SLOT = 0;
        
        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = AUTO_PLAY_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // continue the only and natural path even if the node is skipped
            this.play_forward_from(AUTO_PLAY_SLOT);
        };
        
        this.set_view_played = function(slot_idx){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            // ditto
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else if ( AUTO_PLAY_SLOT >= 0 ) {
                    this.play_forward_from(AUTO_PLAY_SLOT);
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    this.hub_mark = create_element("span", "[Hub]");
                    this.html.appendChild(this.hub_mark);
                    this.hub_button = create_element("button", node_resource.name);
                    this.hub_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, AUTO_PLAY_SLOT) );
                    this.html.appendChild(this.hub_button);
            }
            return this;
        }
        throw new Error("Unable to construct `Hub`");
    }
    
}

</script>
        <script>
/*./modules/interaction.js*/

// Arrow HTML-JS Runtime: Interaction node module

class Interaction {
    
    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        const AUTO_PLAY_SLOT = -1;
        
        const ACTIONS_HOLDER_TAG = 'ol';
        const ACTION_ELEMENT_TAG = 'li';
        const PLAYED_ACTION_TAG = 'p';
        
        this.actions = null;
        this.action_elements = null;
        this.played_action = null;

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = AUTO_PLAY_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // Plays the first *connected* slot (interaction)
            // or just the first[0] slot if there is no connected one which means end edge
            var first_connected_slot = 0;
            if (this.slots_map.length >= 1) {
                var all_connected_slots = Object.keys(this.slots_map);
                all_connected_slots.sort();
                first_connected_slot = all_connected_slots[0];
            }
            this.play_forward_from(first_connected_slot);
        };
        
        this.set_view_played = function(slot_idx){
            // set the famous attribute,
            this.html.setAttribute('data-played', true);
            // then emphasize the played action
            if ( Number.isInteger(slot_idx) && slot_idx >= 0 && slot_idx < this.actions.length ){
                this.played_action = create_element(
                    PLAYED_ACTION_TAG,
                    exposure(this.actions[slot_idx]),
                    { class: 'interaction-played-action' }
                );
                this.html.appendChild(this.played_action);
            } else {
                throw new Error("Unable to set `Interaction` played: The played slot doesn't exist: ", slot_idx);
            }
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
            // ... and remove the element for the emphasized played action
            if ( this.played_action ){
                this.played_action.remove();
                this.played_action = null;
            }
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else if ( AUTO_PLAY_SLOT >= 0 ) {
                    this.play_forward_from(AUTO_PLAY_SLOT);
                }
            }
        };

        this.create_action_elements = function(actions_array, actions_holder, listen){
            if ( ("appendChild" in actions_holder) == false ) actions_holder = null;
            var action_elements = [];
            for ( var idx = 0; idx < actions_array.length; idx++ ) {
                var action_element = create_element(
                    ACTION_ELEMENT_TAG,
                    exposure(actions_array[idx])
                );
                if ( listen ){
                    // Each action has its own slot in the same order, so...
                    action_element.addEventListener(_CLICK, this.play_forward_from.bind(_self, idx));
                }
                if ( actions_holder ) actions_holder.appendChild(action_element);
                action_elements.push(action_element);
            }
            return action_elements;
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    var error = null;
                    if ( node_resource.hasOwnProperty('data') ){
                        // Actions:
                        if ( node_resource.data.hasOwnProperty('actions') && Array.isArray(node_resource.data.actions) && node_resource.data.actions.length > 0 ){
                            // + holder
                            this.actions_holder = create_element(ACTIONS_HOLDER_TAG, null, { class: 'interaction-actions' });
                                // + actions
                                this.actions = node_resource.data.actions;
                                this.action_elements = this.create_action_elements(node_resource.data.actions, this.actions_holder, true);
                            this.html.appendChild(this.actions_holder);
                        } else {
                            error = "No `actions` exist!";
                        }
                    } else {
                        error = "The resource doesn't own the required `data`.";
                    }
                    if (error)  throw new Error("Unable to create `Interaction` node! " + error );

            }
            return this;
        }
        throw new Error("Unable to construct `Interaction`");
    }
    
}

</script>
        <script>
/*./modules/jump.js*/

// Arrow HTML-JS Runtime: Jump node module

class Jump {
    
    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_the_jump = function(){
            if (this.node_resource.hasOwnProperty("data") && this.node_resource.data.hasOwnProperty("target") && Number.isInteger(this.node_resource.data.target) && this.node_resource.data.target >= 0 ){
                play_node(this.node_resource.data.target, 0);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played();
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // `jump`s have no default action when they are skipped
            handle_status(_CONSOLE_STATUS_CODE.NO_DEFAULT, _self);
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else {
                    this.play_forward_the_jump();
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                this.html.setAttribute('data-target',  node_resource.data.target);
                    // ... and the children
                    // Reason or a mark:
                    if (
                        node_resource.hasOwnProperty("data") && node_resource.data.hasOwnProperty("reason") &&
                        typeof node_resource.data.reason == 'string' && node_resource.data.reason.length > 0
                    ) {
                        this.reason = create_element("em", node_resource.data.reason, {'class': 'reason'});
                        this.html.appendChild(this.reason);
                    } else {
                        this.jump_mark = create_element("span", "[Jump]");
                        this.html.appendChild(this.jump_mark);
                    }
                    // Manual play button:
                    this.jump_button = create_element("button", `${node_resource.name} > ${node_resource.data.target}`);
                    this.jump_button.addEventListener( _CLICK, this.play_forward_the_jump.bind(_self) );
                    this.html.appendChild(this.jump_button);
            }
            return this;
        }
        throw new Error("Unable to construct `Jump`");
    }

}

</script>
        <script>
/*./modules/macro_use.js*/

// Arrow HTML-JS Runtime: Macro-Use node module

class MacroUse {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        this.holder = null;
        this.nodes_list = null;
        this.entry = null;

        const PLAY_FORWARD_SELF_SLOT =  0;
        
        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = PLAY_FORWARD_SELF_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            this.play_self_forward();
        };

        this.play_self_forward = function() {
            this.play_forward_from(PLAY_FORWARD_SELF_SLOT);
        };

        this.owns_node = function(node_id) {
            if ( this.nodes_list ){
                node_id = safeInt(node_id);
                return ( 
                    this.nodes_list.includes(node_id)
                );
            } else{
                if (_VERBOSE) console.warn("Unexpected Behavior! The `macro_use` instance has no valid `nodes_list`.");
            }
            return false;
        };

        this.append_instance = function(node_instance) {
            if (this.holder && 'appendChild' in this.holder){
                if ( 'get_element' in node_instance ){
                    this.holder.appendChild( node_instance.get_element() );
                    this.reset_replay(false); // we do not allow replaying macro in the midst (out of order)
                } else {
                    throw new Error("Invalid Instance! Unable to get_element from the inputted instance.");
                }
            } else {
                throw new Error("Unexpected Behavior! The holder element of the macro is not ready.");
            }
        };
        
        this.reset_replay = function(force) {
            if (this.replay) {
                var is_at_initial_state = (
                    typeof force == 'boolean' ? force :
                    this.holder.childElementCount == 0 && Number.isInteger(this.entry) && this.entry >= 0
                );
                this.replay.disabled = (! is_at_initial_state);
            } else {
                console.warn("Macro-use has no replay button!")
            }
        };

        this.set_view_played = function(slot_idx){
            this.html.setAttribute('data-played', true);
        };
        
        // IMPORTANT!
        // Unlike `step_back` which is called only when the node itself is the last step back,
        // this method could be called by the main runtime module whenever a wrapped node
        // (i.e. one inside the macro) is the last node (subject of backing;)
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        // This method is called when we `step_back` on a node that is wrapped by this macro_use
        this.step_into = function() {
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed()
        };

        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
            this.reset_replay();
        };

        this.replay_macro = function(){
            if ( Number.isInteger(this.entry) && this.entry >= 0 ){
                play_node(this.entry);
            } else {
                console.error(`Node ${this.node_id} using macro ${this.macro_id} has no valid entry: ${this.entry}`);
                this.skip_play();
            }
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                // handle skip in case,
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                // otherwise run the macro (i.e. scoped nodes starting with entry):
                } else {
                    this.replay_macro();
                }
            } else {
                this.reset_replay();
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // fetch the target macro and its map
                if ( node_resource.hasOwnProperty('data') && node_resource.data.hasOwnProperty('macro') ){
                    this.macro_id = safeInt( node_resource.data.macro );
                    if ( this.macro_id >= 0 ){
                        this.macro = get_resource_by_id(this.macro_id, 'scenes');
                        if ( this.macro ){
                            if ( this.macro.hasOwnProperty('map') && typeof this.macro.map == 'object' ){
                                this.nodes_list = Object.keys( this.macro.map ).map( safeInt );
                            }
                            if ( this.macro.hasOwnProperty("entry") ){
                                this.entry = safeInt(this.macro.entry);
                            }
                        } else {
                            throw new Error(`Corrupt Project Data! Node ${node_resource.name} (macro_use) links to no valid macro (scene) resource.`);
                        }
                    }
                }
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    this.html.setAttribute('data-macro',  node_resource.data.macro);
                    // holder element to capsulate sub-nodes
                    this.holder = create_element("div");
                    this.html.appendChild(this.holder);
                    // the identity label,
                    var macro_label = `${node_id}: ${node_resource.data.macro} - ${this.macro.name}`;
                    this.label = create_element("span", macro_label);
                    this.html.appendChild(this.label);
                    // a replay button
                    this.replay = create_element("button", macro_label);
                    this.replay.addEventListener( _CLICK, this.replay_macro.bind(_self) );
                    this.html.appendChild(this.replay);
                    // and skip button (used in manual play and step-backs)
                    this.skip_button = create_element("button", i18n("skip"));
                    this.skip_button.addEventListener( _CLICK, this.skip_play.bind(_self) );
                    this.html.appendChild(this.skip_button);
                // ...
                if ( Array.isArray(this.nodes_list) == false || this.nodes_list.length == 0 || this.nodes_list.includes(this.entry) == false ){
                    console.warn("Unset or invalid macro_use: ", node_id, node_resource, " -> Set to be skipped.");
                    this.node_map.skip = true;
                }
            }
            return this;
        }
        throw new Error("Unable to construct `MacroUse`");
    }
    
}

</script>
        <script>
/*./modules/marker.js*/

// Arrow HTML-JS Runtime: Marker node module

class Marker {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        // super();

        const AUTO_PLAY_SLOT = 0;
        
        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = AUTO_PLAY_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // continue the only and natural path even if the node is skipped
            this.play_forward_from(AUTO_PLAY_SLOT);
        };
        
        this.set_view_played = function(slot_idx){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play(); // ... also auto-plays forward
                } else if ( AUTO_PLAY_SLOT >= 0 ) {
                    this.play_forward_from(AUTO_PLAY_SLOT);
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    // Label
                    var label_text = (
                        node_resource.hasOwnProperty("data") && node_resource.data.hasOwnProperty("label") &&
                        typeof node_resource.data.label == 'string' && node_resource.data.label.length > 0
                    ) ? node_resource.data.label : "...";
                    var attributes = ( node_resource.data.hasOwnProperty("color") ? { style: `--marker-color: #${node_resource.data.color}; ` } :  undefined );
                    this.label = create_element("p", label_text, attributes);
                    this.html.appendChild(this.label);
                    // Manual play button
                    this.marker_button = create_element("button", node_resource.name);
                    this.marker_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, AUTO_PLAY_SLOT) );
                    this.html.appendChild(this.marker_button);
            }
            return this;
        }
        throw new Error("Unable to construct `Marker`");
    }

}

</script>
        <script>
/*./modules/monolog.js*/

// Arrow HTML-JS Runtime: Monolog node module

class Monolog {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {
        
        const _self = this;
        
        const DEFAULT_NODE_DATA = {
            "character": -1,
            "monolog": "",
            "brief": 0,
            "auto": false,
            "clear": false,
        }

        // Forces auto-play regardless of the `auto` property
        const AUTO_PLAY_SLOT = -1;
        
        const CONTINUE_PLAY_SLOT = 0;
        
        const MONOLOG_TAG = "pre";

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 ){
                slot_idx = AUTO_PLAY_SLOT;
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {
            // a skipped monolog node is not displayed ...
            this.html.setAttribute('data-skipped', true);
            // ...  so there is no continue button and we shall play forward anyway
            this.play_forward_from((AUTO_PLAY_SLOT >= 0 ? AUTO_PLAY_SLOT : CONTINUE_PLAY_SLOT));
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.string_data_or_default = function(parameter) {
            var text = DEFAULT_NODE_DATA[parameter];
            if (
                this.node_resource.data.hasOwnProperty(parameter) &&
                (typeof this.node_resource.data[parameter] == 'string')
            ){
                text = this.node_resource.data[parameter]
            }
            return text;
        };
        
        this.bool_data_or_default = function(parameter) {
            var intended = DEFAULT_NODE_DATA[parameter];
            if (
                this.node_resource.data.hasOwnProperty(parameter) &&
                (typeof this.node_resource.data[parameter] == 'boolean')
            ){
                intended = this.node_resource.data[parameter]
            }
            return intended;
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {   
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else if (AUTO_PLAY_SLOT >= 0) {
                    this.play_forward_from(AUTO_PLAY_SLOT);
                } else {
                    if ( this.bool_data_or_default("auto") ) {
                        this.play_forward_from(CONTINUE_PLAY_SLOT);
                    }
                }
            }
            // View Clearance ?
            if (_ALLOW_CLEARANCE) {
                // `monolog` nodes can force the page to get cleaned before they step in
                if ( this.bool_data_or_default("clear") ) {
                    clear_up(this.node_id);
                }
            }
        };

        this.update_character_profile = function(character_id, character){
            if ( typeof character == 'object' && character.hasOwnProperty("color") && character.hasOwnProperty("name") ){
                if ( this.character_profile_element == null ){
                    this.character_name_element = create_element( "div", character.name, { class: 'character-name' } );
                    var data_attributes = {
                        class: 'character-profile',
                        style: `--character-color: #${character.color};`,
                        "data-id": character_id,
                        "data-name": character.name,
                    };
                    for (const key in character.tags){
                        data_attributes[`data-tag-${key}`] = character.tags[key];
                    };
                    this.character_profile_element = create_element( "div",
                        this.character_name_element,
                        data_attributes
                    );
                    this.html.appendChild(this.character_profile_element);
                } else {
                    this.character_profile_element.setAttribute('style', `--character-color: #${character.color};`);
                    this.character_name_element.innerHTML = character.name;
                }
            } else {
                if (_VERBOSE) console.error(character);
                throw new Error("Unable to Update Character Profile: Lack of required object keys, `name` and/or `color`.");
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // Character
                    var character_id = safeInt(node_resource.data.character);
                    this.update_character_profile(
                        character_id,
                        CHARS.hasOwnProperty(character_id) ? CHARS[character_id] : ANONYMOUS_CHARACTER,
                    );
                    // Monolog
                    if ( node_resource.hasOwnProperty("data") ){
                        var monolog_string = this.string_data_or_default("monolog")
                        if (monolog_string.length > 0 ){
                            this.monolog = create_element(MONOLOG_TAG, parse_bbcode( exposure( monolog_string ) ) );
                            this.html.appendChild(this.monolog);
                        }
                        if ( this.bool_data_or_default("auto") ) { this.html.setAttribute('data-auto', 'true'); }
                        if ( this.bool_data_or_default("clear") ) { this.html.setAttribute('data-clear', 'true'); }
                    }
                    // ...
                    this.continue_button = create_element("button", i18n("continue"));
                    this.continue_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, CONTINUE_PLAY_SLOT) );
                    this.html.appendChild(this.continue_button);
                    // ...
                    if (node_map.hasOwnProperty("skip") && node_map.skip === true) {
                        this.skip_button = create_element("button", i18n("skip"));
                        this.skip_button.addEventListener( _CLICK, this.skip_play.bind(_self) );
                        this.html.appendChild(this.skip_button);
                    }
            }
            return this;
        }
        throw new Error("Unable to construct `Monolog`");
    }
    
}

</script>
        <script>
/*./modules/randomizer.js*/

// Arrow HTML-JS Runtime: Randomizer node module

class Randomizer {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;

        const AUTO_PLAY = true;
        const ONLY_USE_CONNECTED_SLOTS = false;
        
        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };

        this.play_forward_randomly = function(){
            var slots_count = -1;
            if ( ONLY_USE_CONNECTED_SLOTS !== true && this.node_resource.hasOwnProperty("data") && this.node_resource.data.hasOwnProperty("slots") ){
                slots_count = safeInt( this.node_resource.data.slots );
            }
            if ( slots_count < 0 ){
                slots_count = Object.keys(this.slots_map).length;
            }
            var random_out_slot_idx = inclusiveRandInt(0, (slots_count - 1) );
            this.play_forward_from(random_out_slot_idx);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // Randomizes anyway
            this.play_forward_randomly();
        };
        
        this.set_view_played = function(slot_idx){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                // Randomly play one of the outgoing slots
                // whether we are handling skip,
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                // or auto-playing
                } else if ( AUTO_PLAY ) {
                    this.play_forward_randomly();
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    this.rnd_mark = create_element("span", "[Randomizer]");
                    this.html.appendChild(this.rnd_mark);
                    this.randomizer_button = create_element("button", node_resource.name);
                    this.randomizer_button.addEventListener( _CLICK, this.play_forward_randomly.bind(_self) );
                    this.html.appendChild( this.randomizer_button );
            }
            return this;
        }
        throw new Error("Unable to construct `Randomizer`");
    }
    
}

</script>
        <script>
/*./modules/sequencer.js*/

// Arrow HTML-JS Runtime: Sequencer node module

class Sequencer {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;

        const AUTO_PLAY = true;
        
        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.count_slots = function() {
            var slots_count = -1;
            if (this.node_resource.hasOwnProperty("data") && this.node_resource.data.hasOwnProperty("slots") ){
                slots_count = safeInt( this.node_resource.data.slots );
            }
            if ( slots_count < 0 && typeof this.slots_map == 'object'){
                var connected_slot_keys_int = Object.keys(this.slots_map).map((x) => { return parseInt(x); }).sort((a, b) => { return a <= b; });
                slots_count = (connected_slot_keys_int ? connected_slot_keys_int.length > 0 : [-1])[0] + 1;
            }
            if (slots_count < 0) slots_count = 0;
            return slots_count;
        };

        this.request_play_forward = function(slot_idx){
            slot_idx = safeInt(slot_idx);
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            }
        };

        this.play_sequence_forward = function(){
            var nothing = true
            for (var slot_idx = 0; slot_idx < this.slots_count; slot_idx++){
                if ( this.slots_map.hasOwnProperty(slot_idx) ) { // (is connected)
                    nothing = false;
                    this.request_play_forward(slot_idx);
                }
            }
            if (nothing) {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played();
        };

        this.play_last_connected_slot = function(){
            var nothing = true
            for (var last_idx = (this.slots_count - 1); last_idx >= 0; last_idx--){
                if ( this.slots_map.hasOwnProperty(last_idx) ) { // (is connected)
                    nothing = false;
                    this.request_play_forward(last_idx);
                    break;
                }
            }
            if (nothing) {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played();
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            this.play_last_connected_slot();
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                // Play last connected slot if skipped
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                // or auto-playing all the sequence
                } else if ( AUTO_PLAY ) {
                    this.play_sequence_forward();
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                this.slots_count = this.count_slots();
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children including
                    // a marker
                    this.seq_mark = create_element("span", "[Sequencer]");
                    this.html.appendChild(this.seq_mark);
                    // play button
                    this.sequencer_button = create_element("button", node_resource.name);
                    this.sequencer_button.addEventListener( _CLICK, this.play_sequence_forward.bind(_self) );
                    this.html.appendChild( this.sequencer_button );
                    // and skip button (used in manual play and step-backs)
                    this.skip_button = create_element("button", i18n("skip"));
                    this.skip_button.addEventListener( _CLICK, this.skip_play.bind(_self) );
                    this.html.appendChild(this.skip_button);
                    // ...
                    this.set_view_unplayed()
            }
            return this;
        }
        throw new Error("Unable to construct `Sequencer`");
    }
    
}

</script>
        <script>
/*./modules/tag_edit.js*/

// Arrow HTML-JS Runtime: Tag-Edit node module

class TagEdit {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        const ONLY_PLAY_SLOT = 0;
        
        const METHODS = {
            0: "Inset",
            1: "Reset",
            2: "Overset",
            3: "Outset",
            4: "Unset",
        }

        this.the_character = null;
        this.the_character_id = null;
        this.the_character_tags_revert = null;

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward = function(){
            if ( this.slots_map.hasOwnProperty(ONLY_PLAY_SLOT) ) {
                var next = this.slots_map[ONLY_PLAY_SLOT];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(ONLY_PLAY_SLOT);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // when skipped it *doesn't modify* the character
            this.play_forward();
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            // reverse any character tag update
            if ( this.the_character && this.the_character_tags_revert !== null ){
                update_global_characters_tags(this.the_character_tags_revert);
                this.the_character_tags_revert = null;
            }
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };

        this.process_tag_edit_forward = function(){
            if ( this.the_character != null ){ // (~ means validity checks are passed)
		        var update_instruction = {};
                var revert_instruction = {};
                var current_tags = (
                    (this.the_character.hasOwnProperty("tags") && (typeof this.the_character.tags == 'object'))
                    ? this.the_character.tags : {}
                );
                var edit_key = this.node_resource.data.edit[1];
                var edit_value = this.node_resource.data.edit[2];
                switch (this.node_resource.data.edit[0]) {
                    case 0: // Inset: Adds a key:value tag, only if the key does not exist
                        if ( current_tags.hasOwnProperty(edit_key) == false ){
                            update_instruction[edit_key] = edit_value;
                            revert_instruction[edit_key] = null;
                        }
                        break;
                    case 1: // Reset: Updates value of a tag, only if the key exists
                        if (current_tags.hasOwnProperty(edit_key) == true){
                            update_instruction[edit_key] = edit_value;
                            revert_instruction[edit_key] = current_tags[edit_key];
                        }
                        break;
                    case 2: // Overset: Overwrites or adds a key:value tag, whether the key exists or not
                        update_instruction[edit_key] = edit_value;
                        revert_instruction[edit_key] = (
                            current_tags.hasOwnProperty(edit_key) ? current_tags[edit_key] : null
                        );
                        break;
                    case 3: // Outset: Removes a tag if both key & value match
                        if ( current_tags.hasOwnProperty(edit_key) == true ){
                            if (current_tags[edit_key] == edit_value) {
                                update_instruction[edit_key] = null;
                                revert_instruction[edit_key] = current_tags[edit_key];
                            }
                        }
                        break;
                    case 4: // Unset: Removes a tag if just the key matches
                        if (current_tags.hasOwnProperty(edit_key) == true){
                            update_instruction[edit_key] = null;
                            revert_instruction[edit_key] = current_tags[edit_key];
                        }
                        break;
                }
                // ...
                this.the_character_tags_revert = {}
                this.the_character_tags_revert[this.the_character_id] = revert_instruction;
                // ...
                var application = {};
                application[this.the_character_id] = update_instruction;
                update_global_characters_tags(application);
                // ...
                this.play_forward();
            } else {
                console.error(`Unable to process the tag-edit (${this.node_resource.name}.) Skipped forward.`);
                this.skip_play();
            }
        };

        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else {
                    this.process_tag_edit_forward();
                }
            }
        };
        
        this.data_is_valid = function(data){
            return (
                data != null && (typeof data == 'object') &&
                data.hasOwnProperty("character") && (Number.isInteger( safeInt(data.character) ) && safeInt(data.character) >= 0) &&
                data.hasOwnProperty("edit") && Array.isArray(data.edit) && data.edit.length >= 3 &&
                Number.isInteger(data.edit[0]) && METHODS.hasOwnProperty(data.edit[0]) &&
                (typeof data.edit[1] == 'string') && data.edit[1].length > 0 && (typeof data.edit[2] == 'string')
            )
        }
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // ...
                var is_valid = this.node_resource.hasOwnProperty("data") && this.data_is_valid(this.node_resource.data);
                if ( is_valid ){
                    this.the_character_id = safeInt(this.node_resource.data.character);
                    if ( CHARS.hasOwnProperty(this.the_character_id) ) {
                        this.the_character = CHARS[ this.the_character_id ];
                    } else {
                        is_valid = false
                        if (_VERBOSE) console.warn(
                            "Invalid Tag-Edit Node! The node has non-existent UID as the target character:",
                            this.the_character_id,
                            this.node_resource
                        );
                    }
                } else {
                    if (_VERBOSE) console.warn(
                        "Invalid Tag-Edit Node! The node has no valid data set or target character.",
                        this.node_resource
                    );
                }
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    if (is_valid) {
                        var edition = this.node_resource.data.edit
                        this.tag_edition = create_element("code",
                            `${this.the_character.name}.${edition[1]} << [${METHODS[edition[0]]}] '${edition[2]}'`,
                            {
                                style: `--character-color: #${this.the_character.color};`,
                                "data-character-id": this.the_character_id,
                                "data-character-name": this.the_character.name,
                            }
                        );
                        this.html.appendChild(this.tag_edition);
                    } else {
                        this.invalid_tag_edit = create_element("span", `[Tag-Edit] ${this.node_resource.name} : ${ i18n("invalid") }`);
                        this.html.appendChild(this.invalid_tag_edit);
                    }
                    // manual application button,
                    if (is_valid){
                        this.apply_button = create_element("button", i18n("apply"));
                        this.apply_button.addEventListener( _CLICK, this.process_tag_edit_forward.bind(_self) );
                        this.html.appendChild(this.apply_button);
                    }
                    // and skip button (used in manual play and step-backs)
                    this.skip_button = create_element("button", i18n("skip"));
                    this.skip_button.addEventListener( _CLICK, this.skip_play.bind(_self) );
                    this.html.appendChild(this.skip_button);
            }
            return this;
        }
        throw new Error("Unable to construct `VariableUpdate`");
    }

}

</script>
        <script>
/*./modules/tag_pass.js*/

// Arrow HTML-JS Runtime: TagPass node module

class TagPass {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        const FALSE_SLOT = 0;
        const TRUE_SLOT  = 1;
        
        const METHODS = {
            0: "Any (OR)", // If at least one of the tags matches, it short-circuits and passes.
            1: "All (AND)", // All tags shall match for the node to pass.
        }

        this.the_character = null;
        this.the_character_id = null;

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward_from = function(slot_idx){
            slot_idx = parseInt(slot_idx);
            if ( Number.isFinite(slot_idx) == false || slot_idx < 0 || slot_idx > 1 ){
                // We default to `false` anytime something is wrong but we can continue
                slot_idx = FALSE_SLOT; 
            }
            if ( this.slots_map.hasOwnProperty(slot_idx) ) {
                var next = this.slots_map[slot_idx];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(slot_idx);
        };
        
        this.skip_play = function() {            
            // Skipped? The convention is to ...
            this.html.setAttribute('data-skipped', true);
            // ... react by playing the *False Slot First*
            if ( this.slots_map.hasOwnProperty(FALSE_SLOT) ){ // if false slot is connected
                this.play_forward_from(FALSE_SLOT);
            } else { // otherwise playing the *Only Remained [Possibly Connected] True Slot*
                this.play_forward_from(TRUE_SLOT); // which ...
            } // ... will naturally end the plot line if the true slot is not connected
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.tag_is_checkable = function(entity){
            return (
                Array.isArray(entity) && entity.length >= 1 && // at least a key
                (typeof entity[0] == 'string') && entity[0].length > 0 && // valid key
                (entity.length == 1 || entity[1] === null || (typeof entity[1] == 'string')) // valid value (including unchecked)
            )
        };

        this.process_tag_pass_forward = function(){
            var shall_pass = false;
            if ( this.the_character != null ){ // (~ means validity checks are passed)
                var current_tags = (
                    (this.the_character.hasOwnProperty("tags") && (typeof this.the_character.tags == 'object'))
                    ? this.the_character.tags : {}
                );
                var method = this.node_resource.data.pass[0];
                var checks = this.node_resource.data.pass[1];
                for (var i = 0; i < checks.length; i++){
                    var entity = checks[i];
                    if ( this.tag_is_checkable(entity) ){
                        shall_pass = (
                            current_tags.hasOwnProperty( entity[0] ) &&
                            ( entity.length == 1 || entity[1] == null || entity[1] == current_tags[entity[0]] )
                        );
                        if (method == 0 && shall_pass == true) break; // Any (OR) : short-circuits when reaches the first true
                        if (method == 1 && shall_pass == false) break; // All (AND) : breaks false if any one false is reached
                    }
                }
            }
            this.play_forward_from(
                (shall_pass == true) ? TRUE_SLOT : FALSE_SLOT
            );
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else {
                    this.process_tag_pass_forward();
                }
            }
        };
        
        this.data_is_valid = function(data){
            return (
                data != null && (typeof data == 'object') &&
                data.hasOwnProperty("character") && (Number.isInteger( safeInt(data.character) ) && safeInt(data.character) >= 0) &&
                data.hasOwnProperty("pass") && Array.isArray(data.pass) && data.pass.length >= 2 &&
                Number.isInteger(data.pass[0]) && METHODS.hasOwnProperty(data.pass[0]) && Array.isArray(data.pass[1])
		        // && Invalid tags are dropped/ignored, so we don't need to check deeper
            )
        }
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // ...
                var is_valid = this.node_resource.hasOwnProperty("data") && this.data_is_valid(this.node_resource.data);
                if ( is_valid ){
                    this.the_character_id = safeInt(this.node_resource.data.character);
                    if ( CHARS.hasOwnProperty(this.the_character_id) ) {
                        this.the_character = CHARS[ this.the_character_id ];
                    } else {
                        is_valid = false
                        if (_VERBOSE) console.warn(
                            "Invalid Tag-Pass Node! The node has non-existent UID as the target character:",
                            this.the_character_id,
                            this.node_resource
                        );
                    }
                } else {
                    if (_VERBOSE) console.warn(
                        "Invalid Tag-Pass Node! The node has no valid data set or target character.",
                        this.node_resource
                    );
                }
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    // Tags:
                    if (is_valid) {
                        var method = this.node_resource.data.pass[0];
                        var checks = this.node_resource.data.pass[1];
                        var checkable = 0;
                        var checkable_tags = create_element("div", `${this.the_character.name}: ${METHODS[method]}`);
                        for (var i = 0; i < checks.length; i++){
                            var entity = checks[i];
                            if (this.tag_is_checkable(entity)){
                                checkable += 1;
                                var checked_value = (entity.length >= 1 && (typeof entity[1] == 'string')) ? `'${entity[1]}'` : null;
                                checkable_tags.appendChild(
                                    create_element("span", `${ entity[0] }: ${ checked_value || "*" }`)
                                )
                            }
                        }
                        this.tag_passage = create_element("code",
                            ( checkable > 0 ? checkable_tags : `No Tags To Check` ),
                            {
                                style: `--character-color: #${this.the_character.color};`,
                                "data-character-id": this.the_character_id,
                                "data-character-name": this.the_character.name,
                            }
                        );
                        this.html.appendChild(this.tag_passage);
                    } else {
                        this.invalid_tag_pass = create_element("span", `[Tag-Pass] ${this.node_resource.name} : ${ i18n("invalid") }`);
                        this.html.appendChild(this.invalid_tag_pass);
                    }
                    // False:
                    this.false_button = create_element("button", i18n("false"), { "value": "false" });
                    this.false_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, FALSE_SLOT) );
                    this.html.appendChild(this.false_button);
                    // True:
                    this.true_button = create_element("button", i18n("true"), { "value": "true" });
                    this.true_button.addEventListener( _CLICK, this.play_forward_from.bind(_self, TRUE_SLOT) );
                    this.html.appendChild(this.true_button);
            }
            return this;
        }
        throw new Error("Unable to construct `TagPass`");
    }

}

</script>
        <script>
/*./modules/user_input.js*/

// Arrow
// HTML-JS Runtime
// Mor. H. Golkar

class UserInput {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        this.the_variable_id = null;
        this.the_variable = null;
        this.previous_variable_value = null;

        const ONLY_PLAY_SLOT = 0;
        const INVALIDATE_EMPTY_STRING = false;

        const INPUT_LISTENER_EVENT  = 'input';

        const INPUT_PER_VARIABLE_TYPE = {
            'str': 'text',
            'num': 'number',
            'bool': 'checkbox'
        };

        const DEFAULT_INPUT_PROPERTIES = {
            "str": [undefined, "", ""],
            "num": [undefined, undefined, 1, 0],
            "bool": [ i18n('user_input_default_bool_negative'), i18n('user_input_default_bool_positive'), true],
        };

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };

        this.get_input_custom_properties = function() {
            return (
                (
                    this.node_resource.hasOwnProperty("data") &&
                    this.node_resource.data.hasOwnProperty("custom") &&
                    Array.isArray(this.node_resource.data.custom)
                ) ? this.node_resource.data.custom : []
            );
        };

        this.read_and_parse_value = function(){
            if (this.the_variable && this.input_element){
                switch ( this.the_variable.type ){
                    case 'str':
                        return this.input_element.value;
                    case 'num':
                        return safeInt(this.input_element.value, Number.NEGATIVE_INFINITY, true);
                    case 'bool':
                        return this.input_element.checked;
                }
            } else {
                throw new Error("Invalid Call! There is no variable or input element!");
            }
        };

        this.str_validator = function(){
            var is_valid = true;
            var value = this.read_and_parse_value();
            if ( INVALIDATE_EMPTY_STRING === true && value.length == 0 ){
                is_valid = false;
            } else {
                var custom = this.get_input_custom_properties();
                if (custom.length >= 1){
                    var pattern = custom[0];
                    if ( typeof pattern == 'string' ) {
                        if (pattern.length > 0){ // Blank patterns are ignored (pass everything)
                            var matches = value.match( new RegExp( pattern, "g" ) )
                            if (
                                Array.isArray(matches) == false || matches.length == 0 ||
                                matches[0] != value
                            ){
                                is_valid = false;
                            }
                        }
                    } else {
                        console.error(
                            this.node_id, "We can only accept RegExp strings as pattern.", this.node_resource
                        );
                        is_valid = false;
                    }
                }
            }
            return is_valid;
        };

        this.num_validator = function(){
            var is_valid = true;
            var value = this.read_and_parse_value();
            var error = undefined;
            if ( value == Number.NEGATIVE_INFINITY ){
                is_valid = false;
            } else {
                var custom = this.get_input_custom_properties();
                if (custom.length >= 3) {
                    for (var req = 0; req < 3; req++){
                        if (Number.isInteger(custom[req]) != true){
                            error = "All required values in custom for `num` [min, max, step, ...] shall be integers.";
                            is_valid = false;
                            break;
                        }
                    }
                    if (is_valid) { // (all integers, we can still proceed)
                        var min = custom[0], max = custom[1], step = custom[2];
                        if (min <= max) {
                            if (min == max) {
                                if (value != min) {
                                    is_valid = false;
                                }
                            } else { // ( min < max)
                                if (value < min || value > max) {
                                    is_valid = false;
                                } else { // is in range but is it stepped properly?
                                    if (step != 0 && ((value - min) % step) != 0) { // (zero step is ignored)
                                        is_valid = false;
                                    }
                                }
                            }
                        } else {
                            is_valid = false;
                            error = "`min` custom property shall be less or equal to `max`!";
                        }
                    }
                } else {
                    error = "We expect at least 3 numeral values [min, max, step, ...] to validate input.";
                    is_valid = false;
                }
            }
            if (error) { console.error(this.node_id, error, this.node_resource); };
            return is_valid;
        };

        this.bool_validator = function(){
            return ( typeof this.read_and_parse_value() == 'boolean' );
        };

        this.is_input_valid = function(){
            if (this.the_variable) {
                switch (this.the_variable.type) {
                    case 'str':
                        return this.str_validator();
                    case 'num':
                        return this.num_validator();
                    case 'bool':
                        return this.bool_validator();
                    default:
                        console.error(this.the_variable_id, this.the_variable)
                        throw new Error('Unsupported variable type!');
                }
            } else {
                // No variable (-1) can not be validated (strictly) and passes only on skip
                return false
            }
        };

        this.set_input_view = function() {
            if (this.the_variable) {
                var custom = this.get_input_custom_properties()
                var length = custom.length
                switch (this.the_variable.type) {
                    case 'str': // [pattern, default, extra]
                        const _STR_FIELDS = ["pattern", "value", "placeholder"]
                        for (var i = 0; i < _STR_FIELDS.length; i++) {
                            if (_STR_FIELDS[i] == "pattern" && custom[i].length == 0) {
                                // unlike html text input we consider blank string no enforced pattern,
                                // so we do not set the property; otherwise it would only accept blank strings.
                                continue;
                            };
                            if (_STR_FIELDS[i] != undefined) {
                                this.input_element[_STR_FIELDS[i]] = (
                                    length >= (i+1) && (typeof custom[i] == 'string')
                                    ? custom[i] : DEFAULT_INPUT_PROPERTIES["str"][i]
                                );
                            }
                        }
                        break;
                    case 'num': // [min, max, step, value]
                        const _NUM_FIELDS = ["min", "max", "step", "value"]
                        for (var i = 0; i < _NUM_FIELDS.length; i++) {
                            if (_NUM_FIELDS[i] != undefined) {
                                this.input_element[_NUM_FIELDS[i]] = (
                                    length >= (i+1) && Number.isInteger(custom[i]) ? custom[i] : DEFAULT_INPUT_PROPERTIES["num"][i]
                                );
                            }
                        }
                        break;
                    case 'bool': // [negative, positive, default-state]
                        this.input_element.checked = (length >= 3 ? custom[2] : DEFAULT_INPUT_PROPERTIES["bool"][2])
                        break;
                    default:
                        console.error(this.the_variable_id, this.the_variable)
                        throw new Error('Unsupported variable type!');
                }
                // and to apply:
                this.on_input_modification()
            } else {
                console.warn(`No variable is set for node ${this.node_id}`)
            }
        };

        this.reset_validity_state = function(force) {
            var validity = ((typeof force == 'boolean') ? force : this.is_input_valid());
            this.html.setAttribute('data-valid', validity);
            this.continue_button.disabled = (!validity)
        };

        this.on_input_modification = function() {
            this.reset_validity_state()
            // Switch boolean check-box label to current state as well:
            if (this.input_checkbox_label){
                var custom = this.get_input_custom_properties()
                var state_idx = (this.input_element.checked ? 1 : 0);
                this.input_checkbox_label.innerText = (
                    custom.length >= (state_idx + 1) && typeof custom[state_idx] == 'string'
                    ? custom[state_idx] : DEFAULT_INPUT_PROPERTIES["bool"][state_idx]
                )
            }
        };
        
        this.play_forward_from = function(_, skip){
            var valid = this.is_input_valid()
            if ( skip === true || valid == true ){
                if ( this.slots_map.hasOwnProperty( ONLY_PLAY_SLOT ) ) {
                    // update variable
                    if ( this.the_variable && valid && skip != true ){
                        update_global_variable_by_id( this.the_variable_id, this.read_and_parse_value() );
                    }
                    // then go for the next node
                    var next = this.slots_map[ONLY_PLAY_SLOT];
                    play_node(next.id, next.slot);
                } else {
                    handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
                }
                this.set_view_played(ONLY_PLAY_SLOT);
            } else {
                this.reset_validity_state(false)
            }
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            this.play_forward_from(ONLY_PLAY_SLOT, true);
        };
        
        this.set_view_played = function(slot_idx){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.set_input_view()
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            // reverse any variable update
            if ( this.the_variable && this.previous_variable_value !== null ){
                update_global_variable_by_id( this.the_variable_id, this.previous_variable_value );
            }
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                // `user_input` node type is pure interactive (there is no auto-play or default behavior,)
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    // if skipped, it means we just go to the next node as if this node didn't exist
                    this.skip_play();
                } // otherwise we shall wait for user interaction
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                // Sort stuff
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    var error = null;
                    if ( node_resource.hasOwnProperty('data') ){
                        // Prompt Message:
                        if ( node_resource.data.hasOwnProperty('prompt') ){
                            this.prompt_element = create_element("p", exposure(node_resource.data.prompt));
                            this.html.appendChild(this.prompt_element);
                        }
                        // Input
                        if ( node_resource.data.hasOwnProperty('variable') ){
                            this.the_variable_id = safeInt( node_resource.data.variable );
                            if ( VARS.hasOwnProperty( this.the_variable_id ) ){
                                this.the_variable = VARS[ this.the_variable_id ];
                                this.previous_variable_value = this.the_variable.value;
                                var input_html_type = INPUT_PER_VARIABLE_TYPE[ this.the_variable.type ];
                                var input_element_id = `${node_id}_input`;
                                this.input_element = create_element("input", null, {
                                    id: input_element_id,
                                    type: input_html_type
                                });
                                this.input_element.addEventListener( INPUT_LISTENER_EVENT, this.on_input_modification.bind(_self) );
                                this.html.appendChild(this.input_element);
                                if ( input_html_type == 'checkbox'){
                                    this.input_checkbox_label = create_element('label', null, {
                                        for: input_element_id
                                    });
                                    this.html.appendChild(this.input_checkbox_label);
                                }
                            } else {
                                error = "Invalid target variable id.";
                            }
                        }
                        // Continue Button
                        this.continue_button = create_element("button", i18n('continue'));
                        this.continue_button.addEventListener( _CLICK, this.play_forward_from.bind(_self) );
                        this.html.appendChild(this.continue_button);
                        // and skip button (used in manual play and step-backs)
                        this.skip_button = create_element("button", i18n("skip"));
                        this.skip_button.addEventListener( _CLICK, this.skip_play.bind(_self) );
                        this.html.appendChild(this.skip_button);
                        // ...
                        this.set_view_unplayed()
                    }
                    if ( error ) {
                        console.error(`Corrupt user_input node (${node_resource.name}) resource data: `, error, '\nNode set to be skipped.');
                        this.node_map.skip = true;
                    }
            }
            return this;
        }
        throw new Error("Unable to construct `UserInput`");
    }

}

</script>
        <script>
/*./modules/variable_update.js*/

// Arrow
// HTML-JS Runtime
// Mor. H. Golkar

class VariableUpdate {

    constructor(node_id, node_resource, node_map, _playing_in_slot) {

        const _self = this;
        
        const ONLY_PLAY_SLOT = 0;
        
        const UNSET_EXPRESSION_MESSAGE = "Parameters unset or invalid!";

        this.the_variable = null;
        this.the_variable_id = null;
        this.previous_variable_value = null;

        this.get_element = function () {
            return this.html;
        };
        
        this.remove_element = function() {
            this.html.remove();
        };
        
        this.play_forward = function(){
            if ( this.slots_map.hasOwnProperty(ONLY_PLAY_SLOT) ) {
                var next = this.slots_map[ONLY_PLAY_SLOT];
                play_node(next.id, next.slot);
            } else {
                handle_status(_CONSOLE_STATUS_CODE.END_EDGE, _self);
            }
            this.set_view_played(ONLY_PLAY_SLOT);
        };
        
        this.skip_play = function() {
            this.html.setAttribute('data-skipped', true);
            // when skipped it *doesn't modify* the variable
            this.play_forward();
        };
        
        this.set_view_played = function(){
            this.html.setAttribute('data-played', true);
        };
        
        this.set_view_unplayed = function(){
            this.html.setAttribute('data-played', false);
        };
        
        this.step_back = function(){
            // reverse any variable update
            if ( this.the_variable && this.previous_variable_value !== null ){
                update_global_variable_by_id(this.the_variable_id, this.previous_variable_value);
            }
            this.html.setAttribute('data-skipped', false);
            this.set_view_unplayed();
        };

        this.evaluation_and_play = function(){
            var new_value = null;
            if ( this.update_expression ) {
                new_value = this.update_expression.evaluate();
                // ... It may result in `null` (e.g. if the expression is unset.)
            }
            if ( new_value !== null && this.the_variable ){
                update_global_variable_by_id(this.the_variable_id, new_value);
                this.play_forward();
            } else {
                console.error(`Unable to evaluate the variable_update (${this.node_resource.name}) expression. Skipped forward.`);
                this.skip_play();
            }
        };
        
        this.proceed = function(){
            if (_ALLOW_AUTO_PLAY) {
                if (this.node_map.hasOwnProperty("skip") && this.node_map.skip == true){
                    this.skip_play();
                } else {
                    this.evaluation_and_play();
                }
            }
        };
        
        if ( node_id >= 0 ){
            if ( typeof node_resource == 'object' && typeof node_map == 'object' ){
                this.node_id = node_id;
                this.node_resource = node_resource;
                this.node_map = node_map;
                this.slots_map = remap_connections_for_slots( (node_map || {}), node_id );
                // Expression
                this.update_expression = null;
                if ( this.node_resource.hasOwnProperty("data") && this.node_resource.data.hasOwnProperty("variable") ){
                    this.the_variable_id = safeInt(this.node_resource.data.variable);
                    try {
                        this.update_expression = new VariableUpdateExpression(this.node_resource.data, VARS);
                        this.the_variable = this.update_expression.variable;
                        this.previous_variable_value = this.the_variable.value;
                    } catch(err){
                        if (_VERBOSE) console.warn('Invalid Variable_Update Expression. Error:' + err);
                    }
                }
                // Create the node html element
                this.html = create_node_base_html(node_id, node_resource);
                    // ... and the children
                    // Parsed VariableUpdate Expression:
                    if ( this.update_expression ){
                        var parsed_update_expression = (this.update_expression.parse() || UNSET_EXPRESSION_MESSAGE);
                        this.parsed_expression = create_element("code", parsed_update_expression, {"class": "expression"});
                        this.html.appendChild(this.parsed_expression);
                    }
                    // Manual Evaluation Button:
                    this.eval_button = create_element("button", i18n("evaluate"));
                    this.eval_button.addEventListener( _CLICK, this.evaluation_and_play.bind(_self) );
                    this.html.appendChild(this.eval_button);
                    // and skip button (used in manual play and step-backs)
                    this.skip_button = create_element("button", i18n("skip"));
                    this.skip_button.addEventListener( _CLICK, this.skip_play.bind(_self) );
                    this.html.appendChild(this.skip_button);
                    // ...
            }
            return this;
        }
        throw new Error("Unable to construct `VariableUpdate`");
    }
}


class VariableUpdateExpression {
    
    constructor(data, variables){

        const _self = this;

        this.data = null;
        this.variable = null;

        const PARAMETER_MODES_ENUM = {
            0: "value",
            1: "variable"
        };
        const PARAMETER_MODES_ENUM_CODE = {
            "value": 0,
            "variable": 1
        };

        const UPDATE_OPERATORS = {
            "num": {
                "set": { "text": "Set Equal", "sign": "=" },
                "add": { "text": "Addition", "sign": "+=" },
                "sub": { "text": "Subtraction", "sign": "-=" },
                "div": { "text": "Division", "sign": "/=" },
                "rem": { "text": "Remainder", "sign": "%=" },
                "mul": { "text": "Multiplication", "sign": "*=" },
                "exp": { "text": "Exponentiation", "sign": "^=" },
                "abs": { "text": "Absolute", "sign": "=||" },
            },
            "str": {
                "set": { "text": "Set", "sign": "=" },
                "stc": { "text": "Set Capitalized", "sign": "C=" },
                "stl": { "text": "Set Lowercased", "sign": "l=" },
                "stu": { "text": "Set Uppercased", "sign": "U=" },
                "ins": { "text": "Insert Right", "sign": "=+" },
                "inb": { "text": "Insert Left", "sign": "+=" },
                "rmc": { "text": "Remove Left", "sign": "-=" },
                "rml": { "text": "Remove Left (Case Insensitive)", "sign": "-~" },
                "rmr": { "text": "Remove Right", "sign": "=-" },
                "rmi": { "text": "Remove Right (Case Insensitive)", "sign": "~-" },
                "rpl": { "text": "Replace", "sign": "=*" },
                "rpi": { "text": "Replace (Case Insensitive)", "sign": "~*" },
            },
            "bool": {
                "set": { "text": "Set", "sign": "=" },
                "neg": { "text": "Set Negative", "sign": "=!" },
            },
        };

        const KEYS_NEEDED_TO_PARSE = ["variable", "operator", "with"];
        
        const EXPRESSION_TEMPLATE = "{ident} {operator_sign} {parameter}";
        const UPDATED_WITH_SELF_INITIAL_RIGHT_SIDE = "Self (Intial Value)";
        
        const STRING_VALUE_FORMATING_TEMPLATE = "`%s`";
    
        this.parse = function(){
            var parsed = null;
            if ( this.variable && this.data ) {
                this.expression = { "ident": null, "operator_sign": null, "parameter": null };
                this.expression.ident = this.variable.name;
                if ( UPDATE_OPERATORS[this.variable.type].hasOwnProperty(this.data.operator) ){
                    this.expression.operator_sign = UPDATE_OPERATORS[this.variable.type][this.data.operator].sign;
                }
                switch ( this.data.with[0] ){
                    case PARAMETER_MODES_ENUM_CODE.value:
                        if (this.variable.type == "str"){
                            this.expression.parameter = STRING_VALUE_FORMATING_TEMPLATE.replace("%s", this.data.with[1]);
                        } else {
                            this.expression.parameter = this.data.with[1];
                        }
                        break;
                    case PARAMETER_MODES_ENUM_CODE.variable:
                        if ( this.data.with[1] == this.data.variable) { // the variable is compared to self (initial value)
                            this.expression.parameter = UPDATED_WITH_SELF_INITIAL_RIGHT_SIDE;
                        } else { // or another variable
                            if ( VARS.hasOwnProperty(this.data.with[1]) ) {
                                var parameter_var = VARS[ this.data.with[1] ];
                                this.expression.parameter = parameter_var.name;
                            }
                        }
                        break;
                }
                for (const key in this.expression) {
                    if ( this.expression.hasOwnProperty(key) ) {
                        if ( this.expression[key] === null ){
                            this.expression = null;
                            break;
                        }
                    }
                }
                parsed = (this.expression ? format(EXPRESSION_TEMPLATE, this.expression) : null );
            }
            return parsed;
        };
            
        this.evaluators = {
            "str": function(left, operation, right){ 
                var result = null;
                switch (operation) {
                    case "set": // Set (=)
                        result = right;
                        break;
                    case "stc": // Set Capitalized (C=)
                        result = capitalize(right);
                        break;
                    case "stl": // Set Lowercased (l=)
                        result = right.toLowerCase();
                        break;
                    case "stu": // Set Uppercased (u=)
                        result = right.toUpperCase();
                        break;
                    case "ins": // Insert Right (=+)
                        result = ( left + right );
                        break;
                    case "inb": // Insert Left (+=)
                        result = ( right + left );
                        break;
                    case "rmc": // Remove Left (-=)
                        var rem_idx = left.indexOf(right);
                        if (rem_idx >= 0){
                            result = left.substring(0, rem_idx) + left.substring(rem_idx + right.length);
                        } else {
                            result = left;
                        }
                        break;
                    case "rml": // Remove Left _Case Insensitive_ (-~)
                        var rem_idx = left.toLowerCase().indexOf(right.toLowerCase());
                        if (rem_idx >= 0){
                            result = left.substring(0, rem_idx) + left.substring(rem_idx + right.length);
                        } else {
                            result = left;
                        }
                        break;
                    case "rmr": // Remove Right (=-)
                        var rem_idx = left.lastIndexOf(right);
                        if (rem_idx >= 0){
                            result = left.substring(0, rem_idx) + left.substring(rem_idx + right.length);
                        } else {
                            result = left;
                        }
                        break;
                    case "rmi": // Remove Right _Case Insensitive_ (~-)
                        var rem_idx = left.toLowerCase().lastIndexOf(right.toLowerCase());
                        if (rem_idx >= 0){
                            result = left.substring(0, rem_idx) + left.substring(rem_idx + right.length);
                        } else {
                            result = left;
                        }
                        break;
                    case "rpl": // Replace (=*)	
                        var replacement = right.split("|");
                        if (replacement.length == 1){ replacement.push(""); }
                        result = left.replaceAll(replacement[0], replacement[1]);
                        break;
                    case "rpi": // Replace _Case Insensitive_ (~*)
                        var replacement = right.split("|");
                        if (replacement.length == 1){ replacement.push(""); }
                        var escaped_replacement = replacement[0].replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                        replacement[0] = new RegExp(escaped_replacement, 'ig');
                        result = left.replace(replacement[0], replacement[1]);
                        break;
                }
                return result;
            },
            "num": function(left, operation, right){
                var result = null;
                switch (operation) {
                    case "set": // Set Equal (=)
                        result = right;
                        break;
                    case "add": // Addition (+=)
                        result = (left + right);
                        break;
                    case "sub": // Subtraction (-=)
                        result = (left - right);
                        break;
                    case "div": // Division (/=)
                        result = Math.floor(left / right);
                        break;
                    case "rem": // Remainder (%=)
                        result = (left % right);
                        break;
                    case "mul": // Multiplication (*=)
                        result = (left * right);
                        break;
                    case "exp": // Exponentiation (^=)
                        result = Math.pow(left, right);
                        break;
                    case "abs": // Absolute (=||)
                        result = Math.abs(right);
                        break;
                }
                return ( Number.isFinite(result) ? Math.round(result) : null );
            },
            "bool": function(left, operation, right){
                var result = null;
                switch (operation){
                    case "set": // Set (=)
                        result = right;
                        break;
                    case "neg": // Set Negative (=!)
                        result = ( ! right );
                        break;
                }
                return result;
            }
        };

        this.evaluate = function(){
            var result = null;
            if ( this.variable ){
                var type  = this.variable.type;
                var value = this.variable.value;
                var with_value;
                switch ( this.data.with[0] ) {
                    case PARAMETER_MODES_ENUM_CODE.value:
                        with_value = this.data.with[1];
                        break;
                    case PARAMETER_MODES_ENUM_CODE.variable:
                        var the_second_variable_id = this.data.with[1];
                        if ( VARS.hasOwnProperty(the_second_variable_id) ){
                            if (the_second_variable_id == this.data.variable){
                                // with its own initial value
                                with_value = VARS[the_second_variable_id].init;
                            } else {
                                with_value = VARS[the_second_variable_id].value;
                            }
                        }
                        break;
                }
                if ( with_value !== null ) {
                    if ( type == "str" && ( typeof with_value != 'string') ){
                        with_value = with_value.toString();
                    } else if ( type == "num" && (typeof with_value != 'number') ){
                        with_value= safeInt(with_value, 0);
                    } else if ( type == "bool" && (typeof with_value != 'boolean') ){
                        with_value= safeBool(with_value);
                    }
                    if ( UPDATE_OPERATORS[type].hasOwnProperty(this.data.operator) ){
                        result = this.evaluators[type]( value, this.data.operator, with_value );
                    }
                }
            }
            return result;
        };

        if (
            object_has_keys_all(data, KEYS_NEEDED_TO_PARSE) && 
            Array.isArray(data.with) && data.with.length == 2  // with<array>[parameter_mode, parameter_value]
        ){
            this.data = data;
            var target_variable_id = safeInt(data.variable);
            if ( VARS.hasOwnProperty(target_variable_id) ){
                this.variable = VARS[data.variable];
            }
        } else {
            throw new Error( "Invalid VariableUpdate! Some of the required data is missing: " + KEYS_NEEDED_TO_PARSE.join(", ") );
        }
        
    }
    
}
</script>
        <script>
/*arrow.js*/

// Arrow HTML-JS Runtime: Main interpreter script

// Preferences
//
// NOTE: Respecting following preferences depends on each node module.
//

const _VERBOSE = true;    // console logging verbosity
const _CLICK   = 'click'; // default event to be listened for user interactions
const _LOCALE  = 'en';    // runtime's UI locale (used by `i18n`)

// This runtime allows nodes (such as hubs, generators, etc.)
// to auto-play (or skip) in case no user interaction is normally needed.
// You can force a fully manual play by disabling following constant.
// This constant controls auto-skipping as well.
const _ALLOW_AUTO_PLAY = true;

// Nodes (e.g. `Content`s) can clear up the view from all other nodes before them if allowed:
const _ALLOW_CLEARANCE = true;

const DO_NOT_PRINT_EOL_MESSAGE = true;

// Referencing to frequently used DOM Elements
var DOME = {};

// Global Variables
var VARS = {};

// Characters List
var CHARS = {};

var OPEN_NODES_BY_ORDER = [];
var OPEN_NODES_REFORMATTED_NAMES = []; // names-lowercased-with-whitespaces-replaced-by-dashes

if (typeof PROJECT != "object" || PROJECT.hasOwnProperty("entry") == false) {
    throw new Error("Invalid document data (i.e. `PROJECT` constant.)")
}

// Adjusting document to the project settings
const ROOT = document.getElementsByTagName('html')[0];

// Greeting
console.log(
    "Hello and welcome to \n\t" +
    PROJECT.title + "\n" +
    "Made with Arrow 2.0.0 \n" +
    "https://mhgolkar.github.io/Arrow/"
);

const NODE_CLASSES_BY_TYPE = {
    // jshint ignore:start
    "condition": Condition,
    "content": Content,
    "dialog": Dialog,
    "entry": Entry,
    "frame": Frame,
    "generator": Generator,
    "hub": Hub,
    "interaction": Interaction,
    "jump": Jump,
    "macro_use": MacroUse,
    "marker": Marker,
    "monolog": Monolog,
    "randomizer": Randomizer,
    "sequencer": Sequencer,
    "tag_edit": TagEdit,
    "tag_pass": TagPass,
    "user_input": UserInput,
    "variable_update": VariableUpdate,
    // jshint ignore:end
};

const _CHARS_REQUIRED_KEYS = ["name", "color"];
function sort_characters(){
    var characters = PROJECT.resources.characters;
    for (const char_id in characters) {
        if ( characters.hasOwnProperty(char_id) ) {
            if ( object_has_keys_all( characters[char_id], _CHARS_REQUIRED_KEYS ) ){
                CHARS[char_id] = characters[char_id];
                if ( CHARS[char_id].hasOwnProperty("tags") == false ) {
                    CHARS[char_id].tags = {}
                }
            } else {
                throw new Error(`Unable to sort characters! The character '${char_id}' resource doesn't include required data! ${ _CHARS_REQUIRED_KEYS.join(", ") }`);
            }
        }
    }
}

function update_global_characters_tags(update_list) {
    for (char_id in update_list) {
        if ( CHARS.hasOwnProperty(char_id) ) {
            for (tag_key in update_list[char_id]) {
                if (tag_key.length > 0) {
                    var new_value = update_list[char_id][tag_key];
                    if (typeof new_value == 'string'){
                        console.log(`updating character tag '${tag_key} : ${CHARS[char_id].tags[tag_key]}' with '${new_value}' for '${CHARS[char_id].name}'`);
                        CHARS[char_id].tags[tag_key] = new_value;
                    } else if (new_value === null) {
                        if (CHARS[char_id].tags.hasOwnProperty(tag_key)) {
                            console.log(`removing character tag '${tag_key} : ${CHARS[char_id].tags[tag_key]}' for '${CHARS[char_id].name}'`);
                            delete CHARS[char_id].tags[tag_key];
                        }
                    } else {
                        console.warn(`Trying to update character tag '${tag_key}' with unexpected value: ${new_value}`, arguments);
                    }
                } else {
                    console.warn(`Trying to update character tag with blank key: ${tag_key}`, arguments);
                }
            }
        } else {
            console.warn(`Trying to update non-existent character ID: ${char_id}`, arguments);
        }
    }
}

const _GLOBAL_VARS_REQUIRED_KEYS = ["name", "type", "init"];
const _SUPPORTED_VARIABLE_TYPES  = ["num", "str", "bool"]; 
function sort_global_variables(){
    var variables = PROJECT.resources.variables;
    for (const var_id in variables) {
        if ( variables.hasOwnProperty(var_id) ) {
            if (
                object_has_keys_all( variables[var_id], _GLOBAL_VARS_REQUIRED_KEYS ) &&
                _SUPPORTED_VARIABLE_TYPES.includes( variables[var_id].type )
            ){
                VARS[var_id] = variables[var_id];
                VARS[var_id].value = variables[var_id].init; // Make it ready to change
                refresh_console_attribute_of(variables[var_id].name, VARS[var_id].value);
            } else {
                throw new Error(`Unable to sort global variables! The variable '${var_id}' resource doesn't include required data! ${ _GLOBAL_VARS_REQUIRED_KEYS.join(", ") }`);
            }
        }
    }
}

function update_global_variable_by_id(var_id, new_value){
    if ( VARS.hasOwnProperty(var_id) ){
        // Type checking...
        var var_type = VARS[var_id].type;
        if (
            ( var_type == 'str'  && typeof new_value == 'string'  ) ||
            ( var_type == 'num'  && Number.isInteger(new_value)   ) ||
            ( var_type == 'bool' && typeof new_value == 'boolean' )
        ) {
            // ... then updating
            var var_name = VARS[var_id].name;
            VARS[var_id].value = new_value;
            refresh_console_attribute_of(var_name, new_value);
            if (_VERBOSE) console.log("Variable Updated: ", var_name, "=", new_value);
        } else {
            throw new Error(`Unable to Update Global Variable! Type Inconsistency: new value ${new_value}<${typeof new_value}> for ${var_id}<${var_type}>`);
        }
    } else {
        throw new Error(`Unable to Update Global Variable by ID: No variable with ID '${var_id}'`);
    }
}

function update_global_variable_by_name(var_name, new_value){
    var var_uid = null
    for (const uid in VARS) {
        if ( VARS[uid].name === var_name ) {
            var_uid = uid;
            break;
        }
    }
    if ( var_uid !== null ){
        update_global_variable_by_id(var_uid, new_value);
    } else {
        throw new Error(`Unable to Update Global Variable by Name: No variable with name '${var_name}'`);
    }
}

function exposure(text){
    if ( typeof text == 'string' ){
        for (const var_id in VARS) {
            text = text.replaceAll(`{${VARS[var_id].name}}`, VARS[var_id].value);
        }
        for (const char_id in CHARS) {
            var char_name = CHARS[char_id].name;
            for (const tag_key in CHARS[char_id].tags){
                text = text.replaceAll(`{${char_name}.${tag_key}}`, CHARS[char_id].tags[tag_key]);
            }
        }
        return text;
    } else {
        throw new Error("Unable to process exposure: the text shall be of type string.");
    }
}

function refresh_console_attribute_of(var_name, new_value){
    DOME.CONSOLE.setAttribute( `data-${ escape_name(var_name) }`, ( typeof new_value == 'string' ? new_value : new_value.toString() ) );
}

// Project Validation
const PROJECT_DATA_MANDATORY_FIELDS = [ "title", "entry", "meta", "resources" ];
const PROJECT_DATA_RESOURCES_MANDATORY_SETS = [ "scenes", "nodes", "variables", "characters" ];
const DATASET_ITEM_MANDATORY_FIELDS_FOR_SET = {
    "scenes": [ "name", "entry", "map" ],
    "nodes": [ "type", "name", "data" ],
    "variables": [ "name", "type", "init" ],
    "characters": [ "name", "color" ]
};
function validate_project_data(project){
    if ( !project ) project = PROJECT;
    // Note: only essential validation (node type related checks shall be done by the respective module)
    if ( typeof project == 'object' ){
        if ( object_has_keys_all(project, PROJECT_DATA_MANDATORY_FIELDS ) ) {
            if ( object_has_keys_all(project.resources, PROJECT_DATA_RESOURCES_MANDATORY_SETS ) ){
                if (
                    Number.isInteger(project.entry) && project.resources.nodes.hasOwnProperty(project.entry)
                ){
                    for ( const set in project.resources ){
                        if ( project.resources.hasOwnProperty(set) ) {
                            for ( const uid in project.resources[set] ){
                                if ( project.resources[set].hasOwnProperty(uid) ){
                                    if (
                                        ( safeInt(uid, -1) < 0 ) ||
                                        ( typeof project.resources[set][uid] != 'object' ) ||
                                        ( object_has_keys_all( project.resources[set][uid], DATASET_ITEM_MANDATORY_FIELDS_FOR_SET[set] ) != true )
                                    ){
                                        // Doesn't pass general dataset checks
                                        return false;
                                    } else {
                                        // Passes? What about dataset special checks?
                                        switch (set){
                                            case "scenes":
                                                for ( const map_uid in project.resources[set][uid].map ){
                                                    if (
                                                        ( safeInt(map_uid, -1) < 0 ) ||
                                                        ( typeof project.resources[set][uid].map[map_uid] != 'object' ) /* ||
                                                        (
                                                            // A valid project requires valid offsets but,
                                                            // offsets are not required for this runtime to work. We can safely ignore them ...
                                                            project.resources[set][uid].map[map_uid].hasOwnProperty("offset") != true ||
                                                            Array.isArray(project.resources[set][uid].map[map_uid].offset) != true ||
                                                            project.resources[set][uid].map[map_uid].offset.length != 2 // [x, y]
                                                            )
                                                        */
                                                    ){
                                                        return false;
                                                    }
                                                }
                                                break;
                                            case "nodes":
                                                if ( typeof project.resources[set][uid].data != 'object'){
                                                    return false;
                                                }
                                                break;
                                            case "variables":
                                                // Nothing special at the time
                                                break;
                                            case "characters":
                                                // Ditto
                                                break;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    // Passes all
                    return true;
                }
            }
        }
    }
    // Passes none!
    return false;
}

function get_resource_by_id(res_id, priority_field) {
    var resource = null;
    // Optimization: Search in the priority_field first, where the resource most likely is
    // (defaults to `nodes`.)
    if ( typeof priority_field != "string" || priority_field.length == 0 || PROJECT.resources.hasOwnProperty(priority_field) == false ) priority_field = "nodes";
    if ( PROJECT.resources[priority_field].hasOwnProperty(res_id) ) {
        resource = PROJECT.resources[priority_field][res_id];
    } else {
        for (const field in PROJECT.resources) {
            if (PROJECT.resources.hasOwnProperty(field)) {
                if ( PROJECT.resources[field].hasOwnProperty(res_id) ){
                    resource = PROJECT.resources[field][res_id];
                }
            }
        }
    }
    return resource;
}

function get_owner_scene_of(node_id, only_return_scene_id){
    var scenes = PROJECT.resources.scenes;
    for (const scene_id in scenes) {
        if (scenes.hasOwnProperty(scene_id)) {
            if ( scenes[scene_id].map.hasOwnProperty(node_id) ){
                if ( only_return_scene_id === true ){
                    return scene_id;
                }
                return scenes[scene_id];
            }
        }
    }
    return null;
}

function get_node_map_by_id(node_id){
    var owner_scene = get_owner_scene_of(node_id);
    if (owner_scene){
        if ( owner_scene.hasOwnProperty("map") && owner_scene.map.hasOwnProperty(node_id) ){
         return owner_scene.map[node_id];   
        } else {
            return null;
        }
    } else {
        throw new Error(`Unable to get node (${node_id}) map: It belongs to no scene!`);
    }
}

function escape_name(name){
    if ( typeof name == 'string' && name.length > 0 ){
        return name.toLowerCase().replace(/\W/gi, "-");
    } else {
        throw new Error("Unable to scape the name. It must be a string longer than 0 chars.");
    }
}

function update_ui_open_nodes_list(new_child_name, clean_previous_ones){
    if (clean_previous_ones === true){
        OPEN_NODES_REFORMATTED_NAMES = [];
    }
    if (new_child_name && typeof new_child_name == 'string'){
        OPEN_NODES_REFORMATTED_NAMES.push( escape_name(new_child_name) );
    }
    DOME.CONTENT.setAttribute("data-open-nodes", OPEN_NODES_REFORMATTED_NAMES.join(' '));
}

// Clears view by removing all the appended nodes before the one with resource-uid passed as `the_last_one_id`.
function clear_up(the_last_one_id){
    var last_idx = 0;
    for(var l = OPEN_NODES_BY_ORDER.length - 1; l >= 0; l--){
        if ( OPEN_NODES_BY_ORDER[l].id == the_last_one_id ){
            last_idx = l;
            break;
        }
    }
    if ( last_idx > 0 ){
        OPEN_NODES_REFORMATTED_NAMES.splice(0, last_idx);
        var removed_ones = OPEN_NODES_BY_ORDER.splice(0, last_idx);
        for (var node of removed_ones) {
            node.instance.remove_element();
        }
        update_ui_open_nodes_list();
        if ( OPEN_NODES_BY_ORDER.length == 1){ // there is only one remained node!
            // make sure it's playable (Note: currently only content nodes clear up)
            OPEN_NODES_BY_ORDER[0].instance.step_back();
        }
    } else {
        throw new Error(`The annotated node (${the_last_one_id}) is not open or is the first one. We can only clean view from a node backward.`);
    }
}

function scroll_into_view(element){
    ( element || document.activeElement ).scrollIntoView({
        behavior: 'smooth',
        block: 'center',
        inline: 'center'
    });
}

var OPEN_MACRO = null;

function play_node(node_id, _playing_in_slot){
    var error, node_resource, node_map, instance;
    node_id = safeInt(node_id);
    _playing_in_slot = safeInt(_playing_in_slot);
    node_resource = get_resource_by_id(node_id);
    node_map = get_node_map_by_id(node_id);
    if ( node_id >= 0 ){
        if ( NODE_CLASSES_BY_TYPE.hasOwnProperty(node_resource.type) ){
            instance = new NODE_CLASSES_BY_TYPE[node_resource.type](
                node_id, node_resource, node_map, _playing_in_slot
            );
            // Macros need special treatments
            var handled_by_macro = false;
            if ( OPEN_MACRO ){
                if ( OPEN_MACRO.owns_node(node_id) ){
                    OPEN_MACRO.append_instance(instance);
                    handled_by_macro = true;
                } else { // We must have left the macro by jumping to a node outside, so ...
                    OPEN_MACRO.set_view_played();
                    OPEN_MACRO = null;
                }
            }
            OPEN_NODES_BY_ORDER.push({
                id: node_id,
                resource: node_resource,
                instance: instance,
                wrapper: OPEN_MACRO,
            });
            update_ui_open_nodes_list(node_resource.name);
            var new_node_element = instance.get_element();
            if (handled_by_macro == false) {
                DOME.CONTENT.appendChild( new_node_element );
            }
            // Is the new node itself a macro ?
            if ( node_resource.type == 'macro_use' ) OPEN_MACRO = instance;
            // Finally, proceed the node to auto-play, skip, etc.
            instance.proceed();
            scroll_into_view(new_node_element);
        } else {
            error = "Node Instancing Failed! The node type might be invalid.";
        }
    } else {
        error = "Invalid Node Resource!";
    }
    if (error){
        if (_VERBOSE) console.error(node_id, node_resource);
        throw new Error(error + ` Unable to play the node (${node_id}.)`);
    }
}

// More global constants
const _CONSOLE_STATUS_CODE = {
    "END_EDGE" : 0, // disconnected outgoing slot
	"NO_DEFAULT" : 1 // no default action is taken (e.g. due to being skipped)
};
function handle_status(status_code, the_player_node_instance){
    switch (status_code) {
        case _CONSOLE_STATUS_CODE.END_EDGE:
            if ( OPEN_MACRO && OPEN_MACRO != the_player_node_instance ){
                // This is most likely the end of a `macro_use` in a scene,
                // so there might be still more to play on the parent scene:
                OPEN_MACRO.play_self_forward();
            } else {
                var node_name = the_player_node_instance.node_resource.name;
                console.log(`EOL: ${node_name}`);
                if ( DO_NOT_PRINT_EOL_MESSAGE !== true ){
                    DOME.CONTENT.appendChild(
                        create_element(
                            'div',
                            format( i18n('eol'), { "node_name": node_name } ),
                            { class: 'eol' }
                        )
                    );
                }
            }
            break;
        case _CONSOLE_STATUS_CODE.NO_DEFAULT:
            if (_VERBOSE) {
                console.log(
                    `Node '${the_player_node_instance.node_resource.name}' has no action and no default!\n`+
                    'The node may be skipped or has unset/invalid parameters.'
                );
            }
            break;
    }
}

function play_back(steps, default_throw_error){
    var error = null;
    var open_nodes_count = OPEN_NODES_BY_ORDER.length;
    if ( open_nodes_count > 1 ){
        if ( Number.isInteger(steps) == false || steps < 1 || steps >= open_nodes_count ){
            steps = 1;
            if (_VERBOSE) console.warn("Unset or too many steps back. Reset to 1.");
        }
        // Now we step back
        var remove_threshold = ( open_nodes_count - steps );
        OPEN_NODES_REFORMATTED_NAMES.splice(remove_threshold);
        var removed_ones = OPEN_NODES_BY_ORDER.splice(remove_threshold);
        for (var node of removed_ones) {
            node.instance.remove_element();
        }
        update_ui_open_nodes_list();
        // we also need to make the last open node manually playable,
        var last = OPEN_NODES_BY_ORDER[ remove_threshold - 1 ];
        if ( last.wrapper != null ) {
            OPEN_MACRO = last.wrapper; // (with special cares)
            OPEN_MACRO.step_into();
        } else if (OPEN_MACRO != null && OPEN_MACRO.node_id != last.id){
            OPEN_MACRO.set_view_played();
            OPEN_MACRO = null;
        } else if ( last.resource.type == 'macro_use' ) {
            OPEN_MACRO = last.instance;
        }
        last.instance.step_back();
    } else {
        error = "There is only one remained open node! We can't step back anymore.";
    }
    if (error && default_throw_error != false) throw new Error(error);
}

var DARKMODE = false;
function switch_dark_mode(force){
    DARKMODE = ( typeof force === 'boolean' ? force : ( ! DARKMODE ) );
    ROOT.setAttribute( 'data-theme', ( DARKMODE ? 'dark' : 'light' ) );
    window.localStorage['_arrow_runtime_darkmode'] = DARKMODE; // jshint ignore: line
}

// Runtime
const runtime = function(){

    // Preparation
        // Making references for dry access
    DOME.CONSOLE = document.getElementById("console");
    DOME.CONTENT = document.getElementById("content");
        // Make sure _LOCALE is supported, otherwise stop running the project with an error
    if ( _SUPPORTED_LOCALES.includes(_LOCALE) == false ){
        throw new Error (`The set _LOCALE (${_LOCALE}) is not supported! To add a new one, edit i18n module.`);
    }
    // Then trying to run the project from its entry node
    var error_running = null;
    if ( typeof PROJECT == "object" && validate_project_data() === true ){
        sort_global_variables();
        sort_characters();
        play_node( PROJECT.entry );
        if (_VERBOSE) console.log(`Project Validation [OK]. Running from the project's entry node (${PROJECT.entry}) ...`);
    } else {
        error_running = "Project Data seems Corrupt !!";
    }
    if (error_running) throw new Error("Unable to Run the Project: " + error_running);

    // Control Buttons
    // Dark-mode
    try {
        const DARK_MODE_SWITCH = document.getElementById('switch-dark-mode');
        if ( DARK_MODE_SWITCH ) {
            DARK_MODE_SWITCH.addEventListener(_CLICK, switch_dark_mode);
            if ( window.localStorage && '_arrow_runtime_darkmode' in window.localStorage ){
                switch_dark_mode(
                    ( window.localStorage._arrow_runtime_darkmode === 'true' ||
                      window.localStorage._arrow_runtime_darkmode === true // really ?!
                    ) ? true : false
                );
            }
        }
    } catch (error){
        if (_VERBOSE) console.warn("Dark-mode is Not Available! The `#switch-dark-mode` button is missing.");
    }
    // Back
    try {
        const PLAY_BACK_BUTTON = document.getElementById('play-back');
        if ( PLAY_BACK_BUTTON ) {
            PLAY_BACK_BUTTON.addEventListener( _CLICK, play_back.bind(null, 1, false) );
        }
    } catch (error){
        if (_VERBOSE) console.warn("Play-Back is Not Available! The `#play-back` button is missing.");
    }

};

// Run the `runtime` function when the page is loaded
window.addEventListener("load", runtime);

</script>
        <style>
/*./arrow.css*/

/* Arrow HTML-JS Runtime: Main style sheet */

/* General */

/* General: Theme Color Schemes */
:root { /* light theme */
    --color-0: rgb(255, 255, 255);
    --color-1: rgb(249, 249, 250);
    --color-2: rgb(26, 0, 52);
    --color-3: rgb(0, 21, 41);
    --color-4: rgb(230, 230, 230);
    --color-5: rgb(0, 98, 128);
    --color-6: rgb(90, 90, 90);
    --color-7: rgb(170, 170, 170);
    --color-e: rgb(255, 0, 0);
}
:root[data-theme^='dark'] { /* dark theme */
    --color-0: rgb(0, 0, 0);
    --color-1: rgb(30, 30, 30);
    --color-2: rgb(255, 252, 222);
    --color-3: rgb(255, 206, 97);
    --color-4: rgb(49, 49, 49);
    --color-5: rgb(18, 226, 176);
    --color-6: rgb(181, 181, 181);
    --color-7: rgb(142, 117, 64);
    --color-e: rgb(255, 0, 0);
}

/* General: Normals */
:root {
    --font: monospace, sans-serif;
    font-family: var(--font);
    background-color: var(--color-1);
    color: var(--color-2);
    font-size: 16px;
    font-weight: 400;
    --font-weight-emphasis: 500;
    --font-weight-buttons: 700;
    --font-weight-buttons-secondary: 400;
    width: 100vw;
    line-height: 1.15; /* Correct the line height in all browsers */
    /* To prevent adjustments of font size after orientation changes in iOS : */
    /* -webkit-text-size-adjust: 100%; */
    --transition-time-medium: 0.5s;
    --border-width-normal: 1px;
    --border-color-normal: var(--color-4);
}
/* scrollbar */
:root{ /* firefox */
    scrollbar-color: var(--color-7) var(--color-4);
    scrollbar-width: auto; /* or `thin` ? */
}
/* chrome */
:root::-webkit-scrollbar {
    height: 100%;
    width: 0.75rem;
}
:root::-webkit-scrollbar-track-piece {
    background-color: var(--color-4);
}
:root::-webkit-scrollbar-thumb {
    background-color: var(--color-7);
}
body {
    padding: 0; margin: 0; /* reset */
    font-family: var(--font);
    width: 95vw;
    margin: 0 2.5vw;
    overflow-x: hidden;
    box-sizing: border-box;
    border: none; outline: none;
    padding: 0.25rem 1rem;
}
body > :first-child {
    margin-top: 1rem !important;
}
p, pre {
    overflow: visible;
    white-space: pre-wrap;
    overflow-wrap: break-word;
    font-size: 1.124rem;
    line-height: 1.5em;
}
h1, h2, h3, h4, h5, h6 {
    font-weight: normal;
    margin: 1em 0 0.1em 0;
}
h1 { font-size: 1.5em; }
h2 { font-size: 1.4em; }
h3 { font-size: 1.3em; }
h4 { font-size: 1.2em; }
h5 { font-size: 1.1em; }
h6 { font-size: 1.0em; }
a {
    color: var(--color-2);
    background-color: transparent;
    text-decoration: underline;
    cursor: pointer;
}
form, fieldset, div {
    width: 100%;
    box-sizing: border-box;
    border-color: var(--color-6);
    border-width: 1px;
    margin: 0.5rem 0;
}
input, button { /* normalize */
    overflow: visible;
    text-transform: none;
    font-family: inherit;
    font-size: 100%;
    line-height: 1.15;
    margin: 0;
}
input, button {
    margin: 0.25rem 0;
    box-sizing: content-box;
}
input, input::placeholder {
    font-family: var(--font);
}
input[type='text']::placeholder {
    color: var(--color-7);
}
input[type='text'], input[type='number'] {
    border: solid 2px var(--color-6);
    padding: 0.25rem 0.5rem;
    letter-spacing: 0.125rem;
    vertical-align: middle;
    border-radius: 0.25rem;
    text-align: center;
}
input[type='text'], input[type='number'], input[type='text']::placeholder {
    height: 2rem;
    font-size: 1rem;
}
input[type='text'], input[type='number'] {
    border-color: var(--color-4);
    background-color: var(--color-0);
    color: var(--color-3);
}
button, input[type='button'], input[type='submit'] {
    font-size: 1rem;
    font-weight: var(--font-weight-buttons);
    height: 1.75rem;
    padding: 0.25rem 0.75rem;
    border-radius: 0.25rem;
    border: none;
    background-color: var(--color-4);
    color: var(--color-5);
    cursor: pointer;
    outline: none;
}
button::-moz-focus-inner, button:active,
input[type='button']::-moz-focus-inner, input[type='button']:active,
input[type='submit']::-moz-focus-inner, input[type='submit']:active { /* reset */
    border-style: none;
    border: none;
    padding: 0.25rem 0.75rem;
    outline: none;
}
button:hover, input[type='button']:hover, input[type='submit']:hover {
    color: var(--color-3);
}
button:active, input[type='button']:active, input[type='submit']:active {
    color: var(--color-0);
    background-color: var(--color-5);
}
button:disabled {
    filter: grayscale(1) opacity(0.5);
}
textarea {
    display: block;
    width: 100%;
    height: 16vh;
    font-family: inherit;
    line-height: 1.15;
    font-size: 0.9rem;
    margin: 0.25rem 0;
    padding: 1rem;
    box-sizing: border-box;
    border: solid 1px var(--color-6);
    background-color: var(--color-0);
    color: var(--color-3);
    resize: vertical;
    margin-bottom: 0.75rem;
    overflow: auto; /* remove the default vertical scrollbar in IE 10+ */
}
fieldset {
    display: block;
    box-sizing: border-box;
    margin-top: 0.75rem;
    border-color: var(--color-6);
    padding: 0.35em 0.75em 0.625em; /* normalize */
}
legend {
    text-align: left;
    color: var(--color-6);
    box-sizing: border-box;
    display: table;
    max-width: 100%;
    font-size: 0.9em;
    padding: 0 0.25em;
    white-space: normal;
}
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
input[type="number"] {
    /* text-align: center; */
    -moz-appearance: textfield;
}
em {
    font-style: italic;
}
u {
    text-decoration: underline;
}
strong {
    font-weight: bolder;
}

/* Header */

header {
    padding-bottom: 1rem;
    margin-bottom: 1rem;
    border-bottom: solid var(--border-width-normal) var(--border-color-normal);
}
header > h1 {
    font-size: 2.5rem;
    font-weight: 300;
    margin: 2rem 0;
}
header > h2 {
    font-size: 1.5rem;
    margin: 1.5rem 0;
    font-weight: 300;
}
header > h2 span {
    font-size: 0.75em;
    vertical-align: top;
}

/* Main */

main {}

#console { /* body > main > #console */
    /*
    You can style the content in the #console 
    based on the play's variables, i.e. `#console[data-<variable-name>] {}`
    e.g.
    `#console[data-health_state='critical'] { color: red; }`
    */
}

#content { /* body > main > #console > #content */
    /*
    Nodes are appended in this element with selectors resembling:
    `#content .node[data-name][data-type][data-uid]`
    with a `[data-played='true|false']` to indicate if they are played (automatically or by user interaction.)
    `#content` itself comes with `[data-open-nodes]`
    which is set to a list of space-separated node names (lowercased with whitespaces replaced by dashes.)
    */
}

/*
End-of-line (`.eol`) element is added automatically by the runtime (if `DO_NOT_PRINT_EOL_MESSAGE !== true`,)
whenever a sub-plot-line can not progress any further (i.e. no more nodes forward in that branch.)
*/
#content .eol {
    margin-top: 2rem;
    color: var(--color-7);
    /*
    On top of `DO_NOT_PRINT_EOL_MESSAGE` constant in `arrow.js` file,
    you can uncomment following line if you don't want any end message.
    */
    /* display: none; */
}

/* Footer */

footer {
    border-top: solid var(--border-width-normal) var(--border-color-normal);
    font-size: 0.8rem;
    margin-top: 5rem;
    margin-bottom:5rem;
    padding-top: 0.25em;
    /* text-align: center; */
}
footer a {
    color: var(--color-3);
    text-decoration: none;
}
footer a:hover {
    color: var(--color-5);
}
footer a:active{
    color: var(--color-3);
}
footer p {
    font-size: 0.9rem;
    padding: 0.25em 0;
    margin: 0;
}
footer p:first-of-type {
    margin-top: 1rem;
}
footer button:not(:first-of-type) {
    margin: 0 0.5rem;
}

/* ---------- */
/* Node Types */
/* ---------- */

.node {
    --shown-skipped-node-opacity: 0.7;
    /* General node transition */
    transition: filter var(--transition-time-medium) ease-in-out;
}

.node[data-skipped='true'] > *:not(button) {
    filter: opacity( var(--shown-skipped-node-opacity) );
}

/* HINT: You can remove this block if you want to display skipped nodes anyway */
.node[data-played='true'][data-skipped='true'] {
    display: none;
}

/* content */
.node[data-type='content'] {
    /* It may come with [data-auto='true'] or [data-clear='true'] */
}
.node[data-type='content'] button { /* both buttons */
    margin: 0.25rem;
}
.node[data-type='content'][data-played='true'] button {
    display: none;
}

/* condition */
.node[data-type='condition'] {}
.node[data-type='condition'][data-played='true'] {
    display: none;
}
.node[data-type='condition'] /*code*/.statement {}
.node[data-type='condition'] button {
    margin: 0.5rem;
}

/* dialog */
.node[data-type='dialog'] {
    /* It may come with [data-playable='true'] when it's intended to be manually playable by user */
}
.node[data-type='dialog'] /*div*/.character-profile {
    /*
    It comes with `[data-name]` and `[data-id]`, set to the character's name (unescaped) and UID,
    and `--character-color: #<character-hex-color>;` css variable set inline.
    It can also have `[data-tag-<key>='<value>']` attribute for each existent tag.
    */
}
.node[data-type='dialog'] /*div.character-profile*/.character-name {
    word-break: break-all;
}
.node[data-type='dialog'] /*div.character-profile*/.character-name::before {
    content: "";
    display: inline-block;
    width: 0.75rem;
    height: 0.75rem;
    vertical-align: middle;
    margin: 0.5rem;
    border: solid 0.125rem var(--color-7);
    transform: translateY( calc( -0.125rem / 2 ) );
    border-radius: 100%;
    background-color: var(--character-color);
}
.node[data-type='dialog'] /*div.character-profile*/.character-name::after {
    content: ":";
}
.node[data-type='dialog'] /*ol*/.dialog-lines {
    list-style: none;
    padding: 0;
    margin: 0;
}
.node[data-type='dialog'] /*ol*/.dialog-lines li { /* each line */
    margin: 0.5rem 2rem;
    border-left: dashed 0.125rem var(--color-5);
    padding-left: 1rem;
    cursor: pointer;
    font-weight: var(--font-weight-buttons);
    text-decoration: underline;
    font-size: 1.125em;
}
.node[data-type='dialog'] /*ol*/.dialog-lines li:hover {
    color: var(--color-5);
}
.node[data-type='dialog'] /*p*/.dialog-played-line {
    font-size: 1.1em;
    font-weight: var(--font-weight-emphasis);
    border-left: solid 0.125rem var(--color-6);
    padding: 0.75em;
    margin: 0.5rem 2rem;
}
.node[data-type='dialog'][data-played='true'] .dialog-lines {
    display: none;
}

/* entry */
.node[data-type='entry'] {}
.node[data-type='entry'][data-played='true'] {
    display: none;
}
.node[data-type='entry'] /*em*/.plaque {}
.node[data-type='entry'] span { /* (Entry mark if no plaque is set) */ }
.node[data-type='entry'] button {
    margin: 0.75rem;
}

/* frame */
.node[data-type='frame'] {}
.node[data-type='frame'] p {
    /* The frame label. `--frame-color` is set inline. */
    color: var(--frame-color);
    border: solid 0.125rem var(--frame-color);
    border-radius: 1rem;
    display: inline-block;
    padding: 0.25rem 0.5rem;

}
.node[data-type='frame'] button {
    margin: 0.5rem;
}
.node[data-type='frame'][data-played='true'] p {
    filter: opacity( 0.5 );
}
.node[data-type='frame'][data-played='true'] button {
    display: none;
}

/* generator */
.node[data-type='generator'] {}
.node[data-type='generator'][data-played='true'] {
    display: none;
}
.node[data-type='generator'] /*code*/.expression {}
.node[data-type='generator'] button {
    margin: 0.5rem;
}

/* hub */
.node[data-type='hub'] {}
.node[data-type='hub'][data-played='true'] {
    display: none;
}
.node[data-type='hub'] span { /* (Hub mark) */ }
.node[data-type='hub'] button {
    margin: 0.75rem;
}

/* interaction */
.node[data-type='interaction'] {}
.node[data-type='interaction'] /*ol*/.interaction-actions {
    list-style: none;
    padding: 0;
    margin: 0;
}
.node[data-type='interaction'] /*ol*/.interaction-actions li { /* each line */
    margin: 0.5rem 0;
    border-left: dashed 0.125rem var(--color-5);
    padding-left: 1rem;
    cursor: pointer;
    font-weight: var(--font-weight-buttons);
    text-decoration: underline;
    font-size: 1.125em;
}
.node[data-type='interaction'] /*ol*/.interaction-actions li:hover {
    color: var(--color-5);
}
.node[data-type='interaction'] /*p*/.interaction-played-action {
    font-size: 1.1em;
    font-weight: var(--font-weight-emphasis);
    border-left: solid 0.125rem var(--color-6);
    padding: 0.75em;
    margin: 0.5rem 0;
}
.node[data-type='interaction'][data-played='true'] .interaction-actions {
    display: none;
}

/* jump */
.node[data-type='jump'] {
    /* It comes with `[data-target]` set to the destination node's UID. */
}
.node[data-type='jump'][data-played='true'] {
    display: none;
}
.node[data-type='jump'] /*em*/.reason {}
.node[data-type='jump'] span { /* (Jump mark if no reason is set) */ }
.node[data-type='jump'] button {
    margin: 0.75rem;
}

/* macro_use */
.node[data-type='macro_use'] {
    /* It also comes with `[data-macro]` set to the UID of the used macro */
    position: relative;
    border: dashed 0.125rem var(--color-4);
    padding: 2rem;
}
.node[data-type='macro_use'] > span { /* macro label */
    position: absolute;
    top: -0.125rem;
    right: -0.125rem;
    border-bottom-left-radius: 0.5rem;
    padding: 0.25rem 0.5rem;
    background: var(--color-4);
    color: var(--color-6);
    word-break: break-all;
}
.node[data-type='macro_use'] > button:nth-of-type(1) { /* replay */ }
.node[data-type='macro_use'] > button:nth-of-type(1):disabled {
    display: none;
}
.node[data-type='macro_use'] > button:nth-of-type(2) { /* skip */
    position: absolute;
    bottom: -0.125rem;
    right: -0.125rem;
    margin: 0;
}
.node[data-type='macro_use'][data-played='true'] > button {
    display: none;
}

/* marker */
.node[data-type='marker'] {}
.node[data-type='marker'] p { /* (The marker label) */
    /* `--marker-color` is set inline. */
    color: var(--marker-color);
    border: solid 0.125rem var(--marker-color);
    border-radius: 1rem;
    display: inline-block;
    padding: 0.25rem 1rem;
    
}
.node[data-type='marker'] button {
    margin: 0.5rem;
}
.node[data-type='marker'][data-played='true'] p {
    filter: opacity( 0.5 );
}
.node[data-type='marker'][data-played='true'] button {
    display: none;
}
/* [data-theme^='dark'] .node[data-type='marker'] { filter: invert(1); } */

/* monolog */
.node[data-type='monolog'] {
    /* It may come with [data-auto='true'] or [data-clear='true'] */
}
.node[data-type='monolog'] /*div*/.character-profile {
    /*
    It comes with `[data-name]` and `[data-id]`, set to the character's name (unescaped) and UID,
    and `--character-color: #<character-hex-color>;` css variable set inline.
    It can also have `[data-tag-<key>='<value>']` attribute for each existent tag.
    */
}
.node[data-type='monolog'] /*div.character-profile*/.character-name {
    word-break: break-all;
}
.node[data-type='monolog'] /*div.character-profile*/.character-name::before {
    content: "";
    display: inline-block;
    width: 0.75rem;
    height: 0.75rem;
    vertical-align: middle;
    margin: 0.5rem;
    border: solid 0.125rem var(--color-7);
    transform: translateY( calc( -0.125rem / 2 ) );
    border-radius: 100%;
    background-color: var(--character-color);
}
.node[data-type='monolog'] /*div.character-profile*/.character-name::after {
    content: ":";
}
.node[data-type='monolog'] pre { /* (the monolog) */
    font-size: 1.1em;
    font-weight: var(--font-weight-emphasis);
    border-left: solid 0.125rem var(--color-6);
    padding: 0.75em;
    margin: 0.5rem 2rem;
}
.node[data-type='monolog'] button { /* both buttons */
    margin: 0.25rem;
}
.node[data-type='monolog'][data-played='true'] button {
    display: none;
}

/* randomizer */
.node[data-type='randomizer'] {}
.node[data-type='randomizer'][data-played='true'] {
    display: none;
}
.node[data-type='randomizer'] span { /* (Randomizer mark) */ }
.node[data-type='randomizer'] button {
    margin: 0.75rem;
}

/* sequencer */
.node[data-type='sequencer'] {}
.node[data-type='sequencer'][data-played='true'] {
    display: none;
}
.node[data-type='sequencer'] span { /* (Sequencer mark) */ }
.node[data-type='sequencer'] button { /* both skip and play buttons */
    margin: 0.75rem;
}

/* tag_edit */
.node[data-type='tag_edit'] {}
.node[data-type='tag_edit'][data-played='true'] {
    display: none;
}
.node[data-type='tag_edit'] > code { /* (valid) */
    /* The target character color `--character-color` is set inline. */
    /* It also comes with `[data-character-id]` and `[data-character-name]` as well */
    display: inline-block;
    padding: 0.5rem 1rem;
    margin-bottom: 0.5rem;
    border: solid 0.125rem var(--character-color);
    border-left-width: 1.5rem;
    border-top-right-radius: 0.125rem;
    border-bottom-right-radius: 0.125rem;
    /* color: var(--character-color); */
    margin-inline-end: 0.75rem;
    word-break: break-all;
}
.node[data-type='tag_edit'] > span { /* (invalid) */
    display: inline-block;
    margin-inline-end: 0.75rem;
    margin-bottom: 0.5rem;
}
.node[data-type='tag_edit'] button { /* both skip and apply */
    margin: 0.25rem;
}

/* tag_pass */
.node[data-type='tag_pass'] {}
.node[data-type='tag_pass'][data-played='true'] {
    display: none;
}
.node[data-type='tag_pass'] > code { /* (valid) */
    /* The target character color `--character-color` is set inline. */
    /* It also comes with `[data-character-id]` and `[data-character-name]` as well */
    display: inline-block;
    padding: 0.5rem 1rem;
    margin-bottom: 0.5rem;
    border: dashed 0.125rem var(--character-color);
    border-left-width: 1.5rem;
    border-left-style: solid;
    margin-inline-end: 0.75rem;
    word-break: break-all;
}
.node[data-type='tag_pass'] > code > div { /* (tag group) */
    margin: 0;
}
.node[data-type='tag_pass'] > code > div > span { /* (checkable) */
    display: inline-block;
    padding: 0.5rem 1rem;
    margin: 0.25rem 0.5rem;
    border: solid 0.125rem var(--character-color);
    border-radius: 1rem;
    word-break: break-all;
}
.node[data-type='tag_pass'] > span { /* (invalid) */
    display: inline-block;
    margin-bottom: 0.5rem;
    margin-inline-end: 0.75rem;
}
.node[data-type='tag_pass'] button { /* both skip and apply */
    margin: 0.25rem;
}

/* user_input */
.node[data-type='user_input'] {}
.node[data-type='user_input'] input {
    margin-right: 1rem;
}
.node[data-type='user_input'][data-valid='false'] input {
    border-color: var(--color-e);
}
.node[data-type='user_input'] p {}
.node[data-type='user_input'] label {
    margin-right: 1rem;
    cursor: pointer;
    font-weight: var(--font-weight-buttons);
}
.node[data-type='user_input']:not([data-played='true']) label:hover {
    color: var(--color-5);
}
.node[data-type='user_input'][data-played='true'] input,
.node[data-type='user_input'][data-played='true'] label {
    pointer-events: none;
}
.node[data-type='user_input'] button { /* both buttons */
    margin: 0.25rem;
}
.node[data-type='user_input'][data-played='true'] button {
    display: none;
}
.node[data-type='user_input'][data-valid='false'] button:nth-of-type(1) { /* apply/continue */
    filter: grayscale(1) opacity(0.5);
}
.node[data-type='user_input'][data-valid='false'] button:nth-of-type(2) { /* skip */ }

/* variable_update */
.node[data-type='variable_update'] {}
.node[data-type='variable_update'][data-played='true'] {
    display: none;
}
.node[data-type='variable_update'] /*code*/.expression {
    word-break: break-all;
}
.node[data-type='variable_update'] button {
    margin: 0.5rem;
}

</style>
        <!-- @inline-end -->
    </head>
    <body>
        <header>
            <h1>Espia</h1>
        </header>
        <main>
            <section id="console">
                <article id="content">
                    <!-- Here will be nodes! -->
                </article>
            </section>
        </main>
        <footer>
            <button id='switch-dark-mode'>Switch Dark Mode</button>
            <button id="play-back">Back</button>
            <p> <time>2022.12.3 8:13:5 UTC</time> </p>
            <p> Made with <a href="https://mhgolkar.github.io/Arrow/" target="_blank">Arrow v2.0.0</a> </p>
        </footer>
    </body>
</html>

